{
"version":3,
"file":"fluid.js",
"sourceRoot":"file:///",
"sources":["/usr/lib/haxe/std/js/_std/EReg.hx","/haxe/fluid/src/fluid/core/renderers/SystemRenderer.hx","/haxe/fluid/src/fluid/core/renderers/webgl/WebGLRenderer.hx","/haxe/fluid/src/fluid/core/utils/Utils.hx","/haxe/fluid/src/Fluid.hx","/usr/lib/haxe/std/js/_std/HxOverrides.hx","/usr/lib/haxe/std/js/_std/Reflect.hx","/usr/lib/haxe/std/js/_std/Std.hx","/usr/lib/haxe/std/js/_std/Type.hx","/haxe/fluid/src/fluid/core/display/DisplayObject.hx","/haxe/fluid/src/fluid/core/display/Container.hx","/haxe/fluid/src/fluid/core/math/Matrix.hx","/haxe/fluid/src/fluid/core/math/Point.hx","/haxe/fluid/src/fluid/core/math/shapes/Circle.hx","/haxe/fluid/src/fluid/core/math/shapes/Ellipse.hx","/haxe/fluid/src/fluid/core/math/shapes/Polygon.hx","/haxe/fluid/src/fluid/core/math/shapes/Rectangle.hx","/haxe/fluid/src/fluid/core/renderers/webgl/managers/WebGLManager.hx","/haxe/fluid/src/fluid/core/renderers/webgl/managers/BlendModeManager.hx","/haxe/fluid/src/fluid/core/renderers/webgl/managers/FilterManager.hx","/haxe/fluid/src/fluid/core/renderers/webgl/managers/MaskManager.hx","/haxe/fluid/src/fluid/core/renderers/webgl/managers/ShaderManager.hx","/haxe/fluid/src/fluid/core/renderers/webgl/managers/StencilManager.hx","/haxe/fluid/src/fluid/core/renderers/webgl/shaders/Shader.hx","/haxe/fluid/src/fluid/core/renderers/webgl/shaders/ComplexPrimitiveShader.hx","/haxe/fluid/src/fluid/core/renderers/webgl/shaders/PrimitiveShader.hx","/haxe/fluid/src/fluid/core/renderers/webgl/shaders/TextureShader.hx","/haxe/fluid/src/fluid/core/renderers/webgl/utils/ObjectRenderer.hx","/haxe/fluid/src/fluid/core/renderers/webgl/utils/Quad.hx","/haxe/fluid/src/fluid/core/renderers/webgl/utils/RenderTarget.hx","/haxe/fluid/src/fluid/core/renderers/webgl/utils/StencilMaskStack.hx","/haxe/fluid/src/fluid/core/sprites/Sprite.hx","/haxe/fluid/src/fluid/core/sprites/webgl/SpriteRenderer.hx","/haxe/fluid/src/fluid/core/textures/BaseTexture.hx","/haxe/fluid/.haxelib/msignal/1,2,2/msignal/Signal.hx","/haxe/fluid/.haxelib/msignal/1,2,2/msignal/SlotList.hx","/haxe/fluid/src/fluid/core/textures/Texture.hx","/haxe/fluid/src/fluid/core/textures/TextureUvs.hx","/haxe/fluid/src/fluid/core/utils/PluginTarget.hx","/usr/lib/haxe/std/haxe/Timer.hx","/usr/lib/haxe/std/js/_std/haxe/ds/StringMap.hx","/usr/lib/haxe/std/js/Boot.hx","/usr/lib/haxe/std/js/html/CanvasElement.hx","/haxe/fluid/.haxelib/msignal/1,2,2/msignal/Slot.hx"],
"sourcesContent":["/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class EReg {\n\n\tvar r : HaxeRegExp;\n\n\tpublic function new( r : String, opt : String ) : Void {\n\t\topt = opt.split(\"u\").join(\"\"); // 'u' (utf8) depends on page encoding\n\t\tthis.r = new HaxeRegExp(r, opt);\n\t}\n\n\tpublic function match( s : String ) : Bool {\n\t\tif( r.global ) r.lastIndex = 0;\n\t\tr.m = r.exec(s);\n\t\tr.s = s;\n\t\treturn (r.m != null);\n\t}\n\n\tpublic function matched( n : Int ) : String {\n\t\treturn if( r.m != null && n >= 0 && n < r.m.length ) r.m[n] else throw \"EReg::matched\";\n\t}\n\n\tpublic function matchedLeft() : String {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\treturn r.s.substr(0,r.m.index);\n\t}\n\n\tpublic function matchedRight() : String {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\tvar sz = r.m.index+r.m[0].length;\n\t\treturn r.s.substr(sz,r.s.length-sz);\n\t}\n\n\tpublic function matchedPos() : { pos : Int, len : Int } {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\treturn { pos : r.m.index, len : r.m[0].length };\n\t}\n\n\tpublic function matchSub( s : String, pos : Int, len : Int = -1):Bool {\n\t\treturn if (r.global) {\n\t\t\tr.lastIndex = pos;\n\t\t\tr.m = r.exec(len < 0 ? s : s.substr(0, pos + len));\n\t\t\tvar b = r.m != null;\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t}\n\t\t\tb;\n\t\t} else {\n\t\t\t// TODO: check some ^/$ related corner cases\n\t\t\tvar b = match( len < 0 ? s.substr(pos) : s.substr(pos,len) );\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t\tr.m.index += pos;\n\t\t\t}\n\t\t\tb;\n\t\t}\n\t}\n\n\tpublic function split( s : String ) : Array<String> {\n\t\t// we can't use directly s.split because it's ignoring the 'g' flag\n\t\tvar d = \"#__delim__#\";\n\t\treturn untyped s.replace(r,d).split(d);\n\t}\n\n\tpublic function replace( s : String, by : String ) : String {\n\t\treturn untyped s.replace(r,by);\n\t}\n\n\tpublic function map( s : String, f : EReg -> String ) : String {\n\t\tvar offset = 0;\n\t\tvar buf = new StringBuf();\n\t\tdo {\n\t\t\tif (offset >= s.length)\n\t\t\t\tbreak;\n\t\t\telse if (!matchSub(s, offset)) {\n\t\t\t\tbuf.add(s.substr(offset));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvar p = matchedPos();\n\t\t\tbuf.add(s.substr(offset, p.pos - offset));\n\t\t\tbuf.add(f(this));\n\t\t\tif (p.len == 0) {\n\t\t\t\tbuf.add(s.substr(p.pos, 1));\n\t\t\t\toffset = p.pos + 1;\n\t\t\t}\n\t\t\telse\n\t\t\t\toffset = p.pos + p.len;\n\t\t} while (r.global);\n\t\tif (!r.global && offset > 0 && offset < s.length)\n\t\t\tbuf.add(s.substr(offset));\n\t\treturn buf.toString();\n\t}\n}\n\n@:native(\"RegExp\")\nprivate extern class HaxeRegExp extends js.RegExp {\n\tvar m:js.RegExp.RegExpMatch;\n\tvar s:String;\n}\n","package fluid.core.renderers;\n\nimport fluid.core.math.Matrix;\nimport js.Browser;\nimport Fluid.RenderOptions;\nimport fluid.core.utils.Utils;\nimport js.html.CanvasElement;\n\nclass SystemRenderer {\n\n\tpublic var type:Int;\n\tpublic var width:Int;\n\tpublic var height:Int;\n\tpublic var view:CanvasElement;\n\tpublic var resolution:Float;\n\tpublic var transparent:Bool;\n\tpublic var roundPixels:Bool;\n\tpublic var autoResize:Bool;\n\tpublic var blendModes:Dynamic;\n\tpublic var preserveDrawingBuffer:Bool;\n\tpublic var clearBeforeRender:Bool;\n\tpublic var backgroundColor(default, set):Int;\n\tpublic var plugins:Map<String, Dynamic>;\n\n\tvar _backgroundColor:Int;\n\tvar _backgroundColorRgb:Array<Float>;\n\tvar _backgroundColorString:String;\n\tvar _tempDisplayObjectParent:Dynamic;\n\tvar _lastObjectRendered:Dynamic;\n\n\tpublic function new(system:String, ?width:Int = 1024, ?height:Int = 728, ?options:RenderOptions) {\n\t\tUtils.init();\n\t\tUtils.sayHello(system);\n\t\tif (options != null) {\n\t\t\tif (options.antialias == null) options.antialias = Fluid.DEFAULT_RENDER_OPTIONS.antialias;\n\t\t\tif (options.autoResize == null) options.autoResize = Fluid.DEFAULT_RENDER_OPTIONS.autoResize;\n\t\t\tif (options.backgroundColor == null) options.backgroundColor = Fluid.DEFAULT_RENDER_OPTIONS.backgroundColor;\n\t\t\tif (options.clearBeforeRender == null) options.clearBeforeRender = Fluid.DEFAULT_RENDER_OPTIONS.clearBeforeRender;\n\t\t\tif (options.forceFXAA == null) options.forceFXAA = Fluid.DEFAULT_RENDER_OPTIONS.forceFXAA;\n\t\t\tif (options.preserveDrawingBuffer == null) options.preserveDrawingBuffer = Fluid.DEFAULT_RENDER_OPTIONS.preserveDrawingBuffer;\n\t\t\tif (options.resolution == null) options.resolution = Fluid.DEFAULT_RENDER_OPTIONS.resolution;\n\t\t\tif (options.roundPixels == null) options.roundPixels = Fluid.DEFAULT_RENDER_OPTIONS.roundPixels;\n\t\t\tif (options.transparent == null) options.transparent = Fluid.DEFAULT_RENDER_OPTIONS.transparent;\n\t\t\tif (options.view == null) options.view = Fluid.DEFAULT_RENDER_OPTIONS.view;\n\t\t}\n\t\telse options = Fluid.DEFAULT_RENDER_OPTIONS;\n\n\t\tthis.type = Fluid.RENDERER_TYPE.UNKNOWN;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.view = (options.view == null) ? Browser.document.createCanvasElement() : options.view;\n\t\tthis.resolution = options.resolution;\n\t\tthis.transparent = options.transparent;\n\t\tthis.autoResize = options.autoResize;\n\t\tthis.blendModes = null;\n\t\tthis.preserveDrawingBuffer = options.preserveDrawingBuffer;\n\t\tthis.clearBeforeRender = options.clearBeforeRender;\n\t\tthis.roundPixels = options.roundPixels;\n\t\tthis._backgroundColor = 0x000000;\n\t\tthis._backgroundColorRgb = [0, 0, 0];\n\t\tthis._backgroundColorString = \"#000000\";\n\t\tthis.backgroundColor = options.backgroundColor;\n\t\tthis._tempDisplayObjectParent = { worldTransform:new Matrix(), worldAlpha:1, children:[] };\n\t\tthis._lastObjectRendered = this._tempDisplayObjectParent;\n\n\t\tplugins = new Map();\n\t}\n\n\tpublic function set_backgroundColor(val:Int):Int {\n\t\tthis._backgroundColor = val;\n\t\tthis._backgroundColorString = Utils.hex2string(val);\n\t\tUtils.hex2rgb(val, this._backgroundColorRgb);\n\t\treturn backgroundColor = val;\n\t}\n\n\tpublic function resize(width:Int, height:Int):Void {\n\t\tthis.width = Std.int(width * this.resolution);\n\t\tthis.height = Std.int(height * this.resolution);\n\n\t\tthis.view.width = Std.int(this.width);\n\t\tthis.view.height = Std.int(this.height);\n\n\t\tif (this.autoResize) {\n\t\t\tthis.view.style.width = this.width / this.resolution + 'px';\n\t\t\tthis.view.style.height = this.height / this.resolution + 'px';\n\t\t}\n\t}\n\n\tpublic function destroy(?removeView:Bool = false):Void {\n\t\tif (removeView && this.view.parentNode != null) this.view.parentNode.removeChild(this.view);\n\t\tthis.type = Fluid.RENDERER_TYPE.UNKNOWN;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.view = null;\n\t\tthis.resolution = 0;\n\t\tthis.transparent = false;\n\t\tthis.autoResize = false;\n\t\tthis.blendModes = null;\n\t\tthis.preserveDrawingBuffer = false;\n\t\tthis.clearBeforeRender = false;\n\t\tthis.roundPixels = false;\n\t\tthis._backgroundColor = 0;\n\t\tthis._backgroundColorRgb = null;\n\t\tthis._backgroundColorString = null;\n\t}\n}","package fluid.core.renderers.webgl;\n\nimport fluid.core.sprites.webgl.SpriteRenderer;\nimport fluid.core.utils.PluginTarget;\nimport fluid.core.display.DisplayObject;\nimport fluid.core.renderers.webgl.utils.RenderTarget;\nimport fluid.core.renderers.webgl.utils.ObjectRenderer;\nimport fluid.core.renderers.webgl.managers.StencilManager;\nimport msignal.Signal.Signal0;\nimport msignal.Signal.Signal1;\nimport fluid.core.textures.BaseTexture;\nimport js.html.Event;\nimport js.Browser;\nimport js.html.webgl.RenderingContext;\nimport Fluid.RenderOptions;\nimport fluid.core.renderers.webgl.managers.ShaderManager;\nimport fluid.core.renderers.webgl.managers.BlendModeManager;\nimport fluid.core.renderers.webgl.managers.FilterManager;\nimport fluid.core.renderers.webgl.managers.MaskManager;\n\nusing fluid.core.utils.PluginTarget;\n\nclass WebGLRenderer extends SystemRenderer {\n\n\tpublic static var glContextId:Int = 0;\n\n\tpublic var context:Signal1<RenderingContext>;\n\tpublic var prerender:Signal0;\n\tpublic var postrender:Signal0;\n\n\tpublic var drawModes:Dynamic;\n\tpublic var drawCount:Int;\n\tpublic var shaderManager:ShaderManager;\n\tpublic var maskManager:MaskManager;\n\tpublic var stencilManager:StencilManager;\n\tpublic var filterManager:FilterManager;\n\tpublic var blendModeManager:BlendModeManager;\n\tpublic var currentRenderTarget:RenderTarget;\n\tpublic var currentRenderer:ObjectRenderer;\n\tpublic var gl:RenderingContext;\n\tpublic var renderTarget:RenderTarget;\n\n\tpublic var __plugins:Map<String, Dynamic>;\n\n\tvar _contextOptions:Dynamic;\n\tvar _useFXAA:Bool;\n\tvar _FXAAFilter:Dynamic;\n\tvar _managedTextures:Array<BaseTexture>;\n\tvar _renderTargetStack:Array<Dynamic>;\n\n\tpublic function new(width:Int, height:Int, ?options:RenderOptions) {\n\t\tprerender = new Signal0();\n\t\tpostrender = new Signal0();\n\t\tcontext = new Signal1(RenderingContext);\n\n\t\tif (options == null) options = {};\n\t\tsuper(\"WebGL\", width, height, options);\n\n\t\t__plugins = new Map();\n\t\tregisterPlugin(\"sprite\", fluid.core.sprites.webgl.SpriteRenderer);\n\n\t\tthis.type = Fluid.RENDERER_TYPE.WEBGL;\n\t\tthis.view.addEventListener('webglcontextlost', _handleContextLost, false);\n\t\tthis.view.addEventListener('webglcontextrestored', _handleContextRestored, false);\n\n\t\tthis._useFXAA = !!options.forceFXAA && options.antialias;\n\n\t\tthis._FXAAFilter = null;\n\n\t\tthis._contextOptions = {\n\t\t\talpha: this.transparent,\n\t\t\tantialias: options.antialias,\n\t\t\tpremultipliedAlpha: this.transparent,\n\t\t\tstencil: true,\n\t\t\tpreserveDrawingBuffer: options.preserveDrawingBuffer\n\t\t};\n\n\t\tinitPlugins();\n\n\t\tthis.drawCount = 0;\n\t\tthis.shaderManager = new ShaderManager(this);\n\t\tthis.maskManager = new MaskManager(this);\n\t\tthis.stencilManager = new StencilManager(this);\n\t\tthis.filterManager = new FilterManager(this);\n\t\tthis.blendModeManager = new BlendModeManager(this);\n\t\tthis.currentRenderTarget = null;\n\t\tthis.currentRenderer = new ObjectRenderer(this);\n\n\t\tthis._createContext();\n\t\tthis._initContext();\n\t\tthis._mapGlModes();\n\n\t\tthis._managedTextures = [];\n\t\tthis._renderTargetStack = [];\n\t}\n\n\tpublic function render(object:DisplayObject) {\n\t\tprerender.dispatch();\n\t\tif (this.gl.isContextLost()) return;\n\n\t\tthis.drawCount = 0;\n\t\tthis._lastObjectRendered = object;\n\n\t\tif (this._useFXAA) {\n\t\t\tthis._FXAAFilter[0].uniforms.resolution.value.x = this.width;\n\t\t\tthis._FXAAFilter[0].uniforms.resolution.value.y = this.height;\n\t\t\tobject.filterArea = this.renderTarget.size;\n\t\t\tobject.filters = this._FXAAFilter;\n\t\t}\n\n\t\tvar cacheParent = object.parent;\n\t\tobject.parent = this._tempDisplayObjectParent;\n\t\tobject.updateTransform();\n\t\tobject.parent = cacheParent;\n\n\t\tvar gl = this.gl;\n\t\tthis.setRenderTarget(this.renderTarget);\n\n\t\tif (this.clearBeforeRender) {\n\t\t\tif (this.transparent) gl.clearColor(0, 0, 0, 0);\n\t\t\telse gl.clearColor(this._backgroundColorRgb[0], this._backgroundColorRgb[1], this._backgroundColorRgb[2], 1);\n\t\t\tgl.clear(RenderingContext.COLOR_BUFFER_BIT);\n\t\t}\n\n\t\thaxe.Timer.delay(function() {\n\t\t\tthis.renderDisplayObject(object, this.renderTarget);\n\t\t\tpostrender.dispatch();\n\t\t}, 2000);\n\n\t}\n\n\tpublic function renderDisplayObject(displayObject:DisplayObject, renderTarget:RenderTarget, ?clear:Bool = false) {\n\t\tthis.setRenderTarget(renderTarget);\n\t\tif (clear) renderTarget.clear();\n\t\tthis.filterManager.setFilterStack(renderTarget.filterStack);\n\t\tdisplayObject.renderWebGL(this);\n\t\tthis.currentRenderer.flush();\n\t}\n\n\tpublic function setObjectRenderer(objectRenderer:ObjectRenderer) {\n\t\tif (this.currentRenderer == objectRenderer) return;\n\t\tthis.currentRenderer.stop();\n\t\tthis.currentRenderer = objectRenderer;\n\t\tthis.currentRenderer.start();\n\t}\n\n\tpublic function setRenderTarget(renderTarget:RenderTarget) {\n\t\tif (this.currentRenderTarget == renderTarget) return;\n\t\tthis.currentRenderTarget = renderTarget;\n\t\tthis.currentRenderTarget.activate();\n\t\tthis.stencilManager.setMaskStack(renderTarget.stencilMaskStack);\n\t}\n\n\toverride public function resize(width:Int, height:Int) {\n\t\tsuper.resize(width, height);\n\t\tthis.filterManager.resize(width, height);\n\t\tthis.renderTarget.resize(width, height);\n\n\t\tif (this.currentRenderTarget == this.renderTarget) {\n\t\t\tthis.renderTarget.activate();\n\t\t\tthis.gl.viewport(0, 0, this.width, this.height);\n\t\t}\n\t}\n\n\tpublic function updateTexture(txt:Dynamic):js.html.webgl.Texture {\n\t\tvar texture:BaseTexture = (txt.baseTexture != null) ? txt.baseTexture : txt;\n\t\tif (!texture.hasLoaded) return null;\n\n\t\tvar gl = this.gl;\n\n\t\tif (texture._glTextures[Reflect.field(gl, \"id\")] == null) {\n\t\t\ttexture._glTextures[Reflect.field(gl, \"id\")] = gl.createTexture();\n\t\t\ttexture.updated.add(this.updateTexture);\n\t\t\ttexture.disposed.add(this.destroyTexture);\n\t\t\tthis._managedTextures.push(texture);\n\t\t}\n\n\t\tgl.bindTexture(RenderingContext.TEXTURE_2D, texture._glTextures[Reflect.field(gl, \"id\")]);\n\t\tgl.pixelStorei(RenderingContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultipliedAlpha ? 1 : 0);\n\t\tgl.texImage2D(RenderingContext.TEXTURE_2D, 0, RenderingContext.RGBA, RenderingContext.RGBA, RenderingContext.UNSIGNED_BYTE, texture.source);\n\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_MAG_FILTER, texture.scaleMode == Fluid.SCALE_MODES.LINEAR ? RenderingContext.LINEAR : RenderingContext.NEAREST);\n\n\t\tif (texture.mipmap && texture.isPowerOfTwo) {\n\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_MIN_FILTER, texture.scaleMode == Fluid.SCALE_MODES.LINEAR ? RenderingContext.LINEAR_MIPMAP_LINEAR : RenderingContext.NEAREST_MIPMAP_NEAREST);\n\t\t\tgl.generateMipmap(RenderingContext.TEXTURE_2D);\n\t\t}\n\t\telse gl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_MIN_FILTER, texture.scaleMode == Fluid.SCALE_MODES.LINEAR ? RenderingContext.LINEAR : RenderingContext.NEAREST);\n\n\t\tif (!texture.isPowerOfTwo) {\n\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_WRAP_S, RenderingContext.CLAMP_TO_EDGE);\n\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_WRAP_T, RenderingContext.CLAMP_TO_EDGE);\n\t\t}\n\t\telse {\n\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_WRAP_S, RenderingContext.REPEAT);\n\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_WRAP_T, RenderingContext.REPEAT);\n\t\t}\n\n\t\treturn texture._glTextures[(Reflect.field(gl, \"id\"))];\n\t}\n\n\tpublic function destroyTexture(txt:Dynamic) {\n\t\tvar texture:BaseTexture = (txt.baseTexture != null) ? txt.baseTexture : txt;\n\t\tif (!texture.hasLoaded) return;\n\n\t\tif (texture._glTextures[Reflect.field(gl, \"id\")] != null) {\n\t\t\tthis.gl.deleteTexture(texture._glTextures[Reflect.field(gl, \"id\")]);\n\t\t\ttexture._glTextures[Reflect.field(gl, \"id\")] = null;\n\t\t}\n\t}\n\n\tfunction _handleContextLost(event:Event) {\n\t\tevent.preventDefault();\n\t}\n\n\tfunction _handleContextRestored(event:Event) {\n\t\t_initContext();\n\t\tfor (i in 0 ... this._managedTextures.length) {\n\t\t\tvar texture = this._managedTextures[i];\n\t\t\tif (texture._glTextures[Reflect.field(this.gl, \"id\")] != null) texture._glTextures[Reflect.field(this.gl, \"id\")] = null;\n\t\t}\n\t}\n\n\tfunction _createContext() {\n\t\tvar gl:RenderingContext = this.view.getContextWebGL(this._contextOptions);\n\t\tthis.gl = gl;\n\t\tglContextId = glContextId++;\n\t\tReflect.setField(this.gl, \"id\", glContextId);\n\t\tReflect.setField(this.gl, \"renderer\", this);\n\t}\n\n\tfunction _initContext() {\n\t\tvar gl = this.gl;\n\t\tgl.disable(RenderingContext.DEPTH_TEST);\n\t\tgl.disable(RenderingContext.CULL_FACE);\n\t\tgl.enable(RenderingContext.BLEND);\n\n\t\tthis.renderTarget = new RenderTarget(gl, this.width, this.height, null, this.resolution, true);\n\t\tthis.setRenderTarget(this.renderTarget);\n\t\tcontext.dispatch(gl);\n\n\t\tthis.resize(this.width, this.height);\n\n\t\tif (!this._useFXAA) {\n\t\t\tthis._useFXAA = (this._contextOptions.antialias && !gl.getContextAttributes().antialias);\n\t\t}\n\n\t\tif (this._useFXAA) {\n\t\t\tBrowser.console.warn('FXAA antialiasing being used instead of native antialiasing');\n\t\t\t//this._FXAAFilter = [new FXAAFilter()];\n\t\t}\n\t}\n\n\toverride public function destroy(?removeView:Bool = false) {\n\t\tdestroyPlugins();\n\n\t\tthis.view.removeEventListener('webglcontextlost', _handleContextLost);\n\t\tthis.view.removeEventListener('webglcontextrestored', _handleContextRestored);\n\n\t\tfor (i in 0 ... this._managedTextures.length) {\n\t\t\tvar texture = this._managedTextures[i];\n\t\t\tthis.destroyTexture(texture);\n\t\t\ttexture.updated.remove(this.updateTexture);\n\t\t\ttexture.disposed.remove(this.destroyTexture);\n\t\t}\n\n\t\tsuper.destroy(removeView);\n\n\t\tthis.shaderManager.destroy();\n\t\tthis.maskManager.destroy();\n\t\tthis.stencilManager.destroy();\n\t\tthis.filterManager.destroy();\n\t\tthis.blendModeManager.destroy();\n\t\tthis.shaderManager = null;\n\t\tthis.maskManager = null;\n\t\tthis.filterManager = null;\n\t\tthis.blendModeManager = null;\n\t\tthis.currentRenderer = null;\n\t\tthis._contextOptions = null;\n\t\tthis._managedTextures = null;\n\t\tthis.drawCount = 0;\n\t\tthis.gl.useProgram(null);\n\t\tthis.gl = null;\n\t}\n\n\tfunction _mapGlModes() {\n\t\tvar gl = this.gl;\n\n\t\tif (this.blendModes == null) {\n\t\t\tthis.blendModes = {};\n\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.NORMAL] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.ADD] = [RenderingContext.SRC_ALPHA, RenderingContext.DST_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.MULTIPLY] = [RenderingContext.DST_COLOR, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.SCREEN] = [RenderingContext.SRC_ALPHA, RenderingContext.ONE];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.OVERLAY] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.DARKEN] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.LIGHTEN] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.COLOR_DODGE] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.COLOR_BURN] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.HARD_LIGHT] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.SOFT_LIGHT] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.DIFFERENCE] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.EXCLUSION] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.HUE] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.SATURATION] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.COLOR] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t\tthis.blendModes[Fluid.BLEND_MODES.LUMINOSITY] = [RenderingContext.ONE, RenderingContext.ONE_MINUS_SRC_ALPHA];\n\t\t}\n\n\t\tif (this.drawModes == null) {\n\t\t\tthis.drawModes = {};\n\n\t\t\tthis.drawModes[Fluid.DRAW_MODES.POINTS] = RenderingContext.POINTS;\n\t\t\tthis.drawModes[Fluid.DRAW_MODES.LINES] = RenderingContext.LINES;\n\t\t\tthis.drawModes[Fluid.DRAW_MODES.LINE_LOOP] = RenderingContext.LINE_LOOP;\n\t\t\tthis.drawModes[Fluid.DRAW_MODES.LINE_STRIP] = RenderingContext.LINE_STRIP;\n\t\t\tthis.drawModes[Fluid.DRAW_MODES.TRIANGLES] = RenderingContext.TRIANGLES;\n\t\t\tthis.drawModes[Fluid.DRAW_MODES.TRIANGLE_STRIP] = RenderingContext.TRIANGLE_STRIP;\n\t\t\tthis.drawModes[Fluid.DRAW_MODES.TRIANGLE_FAN] = RenderingContext.TRIANGLE_FAN;\n\t\t}\n\t}\n}","package fluid.core.utils;\n\nimport fluid.core.renderers.webgl.WebGLRenderer;\nimport fluid.core.sprites.webgl.SpriteRenderer;\nimport fluid.core.renderers.webgl.WebGLRenderer;\nimport fluid.core.textures.Texture;\nimport fluid.core.textures.BaseTexture;\nimport js.html.webgl.RenderingContext;\nimport js.html.CanvasElement;\nimport js.html.Image;\nimport js.Browser;\n\nclass Utils {\n\n\tstatic var _uid:Int = 0;\n\tstatic var _saidHello:Bool = false;\n\n\tpublic static var TextureCache:Map<String, Texture>;\n\tpublic static var BaseTextureCache:Map<String, BaseTexture>;\n\n\tpublic static function uid():Int {\n\t\treturn ++_uid;\n\t}\n\n\tpublic static function hex2rgb(hex:Int, ?out:Array<Float>):Array<Float> {\n\t\tif (out == null) out = [];\n\t\tout[0] = (hex >> 16 & 0xFF) / 255;\n\t\tout[1] = (hex >> 8 & 0xFF) / 255;\n\t\tout[2] = (hex & 0xFF) / 255;\n\t\treturn out;\n\t}\n\n\tpublic static function hex2string(hex:Int):String {\n\t\tvar h = Std.string(hex);\n\t\th = '000000'.substr(0, 6 - h.length) + h;\n\t\treturn '#' + h;\n\t}\n\n\tpublic static function rgb2hex(rgb:Array<Int>):Int {\n\t\treturn ((rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255);\n\t}\n\n\tpublic static function canUseNewCanvasBlendModes():Bool {\n\t\tif (Browser.document == null) return false;\n\n\t\tvar pngHead = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/';\n\t\tvar pngEnd = 'AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==';\n\n\t\tvar magenta = new Image();\n\t\tmagenta.src = pngHead + 'AP804Oa6' + pngEnd;\n\n\t\tvar yellow = new Image();\n\t\tyellow.src = pngHead + '/wCKxvRF' + pngEnd;\n\n\t\tvar canvas:CanvasElement = Browser.document.createCanvasElement();\n\t\tcanvas.width = 6;\n\t\tcanvas.height = 1;\n\n\t\tvar context = canvas.getContext2d();\n\t\tcontext.globalCompositeOperation = 'multiply';\n\t\tcontext.drawImage(magenta, 0, 0);\n\t\tcontext.drawImage(yellow, 2, 0);\n\n\t\tvar data = context.getImageData(2, 0, 1, 1).data;\n\n\t\treturn (data[0] == 255 && data[1] == 0 && data[2] == 0);\n\t}\n\n\tpublic static function getNextPowerOfTwo(number:Int):Int {\n\t\tif (number > 0 && (number & (number - 1)) == 0) return number;\n\t\telse {\n\t\t\tvar result = 1;\n\t\t\twhile (result < number) {\n\t\t\t\tresult <<= 1;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tpublic static function isPowerOfTwo(width:Int, height:Int):Bool {\n\t\treturn (width > 0 && (width & (width - 1)) == 0 && height > 0 && (height & (height - 1)) == 0);\n\t}\n\n\tpublic static function getResolutionOfUrl(url:String):Float {\n\t\tvar resolution = Fluid.RETINA_PREFIX.match(url);\n\t\tif (resolution) return Std.parseFloat(Fluid.RETINA_PREFIX.matched(1));\n\t\treturn 1;\n\t}\n\n\tpublic static function sayHello(type:String):Void {\n\t\tif (_saidHello) return;\n\t\ttrace(\"Fluid \" + Fluid.VERSION + ' - ' + type);\n\t\t_saidHello = true;\n\t}\n\n\tpublic static function init() {\n\t\tBaseTextureCache = new Map();\n\t\tTextureCache = new Map();\n\t}\n\n\tpublic static function isWebGLSupported():Bool {\n\t\ttry {\n\t\t\tvar can:CanvasElement = Browser.document.createCanvasElement();\n\t\t\tvar contextOptions = { stencil: true };\n\t\t\tvar gl:RenderingContext = can.getContextWebGL(contextOptions);\n\n\t\t\treturn !!(gl != null && gl.getContextAttributes().stencil);\n\t\t}\n\t\tcatch (e:Dynamic) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tpublic static function sign(n:Float):Int {\n\t\treturn n != null ? (n < 0 ? -1 : 1) : 0;\n\t}\n\n\tpublic static function removeItems(arr:Dynamic, ?index:Int = 0, ?count:Int = 1):Dynamic {\n\t\treturn arr.splice(index, count);\n\t}\n}","import fluid.core.utils.Utils;\nimport haxe.extern.EitherType;\nimport fluid.core.renderers.canvas.CanvasRenderer;\nimport fluid.core.renderers.webgl.WebGLRenderer;\n\n@:expose class Fluid {\n\n\tpublic static var utils = fluid.core.utils.Utils;\n\tpublic static var WebGLRenderer = fluid.core.renderers.webgl.WebGLRenderer;\n\n\tpublic static var VERSION:String = \"0.0.1\";\n\tpublic static var PI_2:Float = Math.PI * 2;\n\tpublic static var RAD_TO_DEG:Float = 180 / Math.PI;\n\tpublic static var DEG_TO_RAD:Float = Math.PI / 180;\n\tpublic static var TARGET_FPMS:Float = 0.06;\n\tpublic static var RENDERER_TYPE:RendererType = { UNKNOWN: 0, WEBGL: 1, CANVAS: 2 };\n\n\tpublic static var BLEND_MODES:BlendModes = {\n\t\tNORMAL: 0,\n\t\tADD: 1,\n\t\tMULTIPLY: 2,\n\t\tSCREEN: 3,\n\t\tOVERLAY: 4,\n\t\tDARKEN: 5,\n\t\tLIGHTEN: 6,\n\t\tCOLOR_DODGE: 7,\n\t\tCOLOR_BURN: 8,\n\t\tHARD_LIGHT: 9,\n\t\tSOFT_LIGHT: 10,\n\t\tDIFFERENCE: 11,\n\t\tEXCLUSION: 12,\n\t\tHUE: 13,\n\t\tSATURATION: 14,\n\t\tCOLOR: 15,\n\t\tLUMINOSITY: 16\n\t};\n\n\tpublic static var DRAW_MODES:DrawModes = {POINTS: 0, LINES: 1, LINE_LOOP: 2, LINE_STRIP: 3, TRIANGLES: 4, TRIANGLE_STRIP: 5, TRIANGLE_FAN: 6 };\n\n\tpublic static var SCALE_MODES:ScaleModes = { DEFAULT: 0, LINEAR: 0, NEAREST: 1 };\n\n\tpublic static var RETINA_PREFIX:EReg = ~/@(.+)x/;\n\n\tpublic static var RESOLUTION:Float = 1;\n\n\tpublic static var FILTER_RESOLUTION:Float = 1;\n\n\tpublic static var DEFAULT_RENDER_OPTIONS:RenderOptions = {\n\t\tview: null,\n\t\tresolution: 1,\n\t\tantialias: false,\n\t\tforceFXAA: false,\n\t\tautoResize: false,\n\t\ttransparent: false,\n\t\tbackgroundColor: 0x000000,\n\t\tclearBeforeRender: true,\n\t\tpreserveDrawingBuffer: false,\n\t\troundPixels: false\n\t};\n\n\tpublic static var SHAPES:Shapes = { POLY: 0, RECT: 1, CIRC: 2, ELIP: 3, RREC: 4 };\n\n\tpublic static var SPRITE_BATCH_SIZE:Int = 2000;\n\n\tpublic static function autoDetectRenderer(?width:Int = 1024, ?height:Int = 728, ?options:RenderOptions, ?noWebGL:Bool = false):EitherType<WebGLRenderer, CanvasRenderer> {\n\t\tif (!noWebGL && Utils.isWebGLSupported()) return new WebGLRenderer(width, height, options);\n\t\treturn new CanvasRenderer(width, height, options);\n\t}\n}\n\ntypedef RendererType = {\n\tvar UNKNOWN:Int;\n\tvar WEBGL:Int;\n\tvar CANVAS:Int;\n}\n\ntypedef RenderOptions = {\n\t@:optional var view:Dynamic;\n\t@:optional var resolution:Float;\n\t@:optional var antialias:Bool;\n\t@:optional var forceFXAA:Bool;\n\t@:optional var autoResize:Bool;\n\t@:optional var transparent:Bool;\n\t@:optional var backgroundColor:Int;\n\t@:optional var clearBeforeRender:Bool;\n\t@:optional var preserveDrawingBuffer:Bool;\n\t@:optional var roundPixels:Bool;\n}\n\ntypedef DrawModes = {\n\tvar POINTS:Int;\n\tvar LINES:Int;\n\tvar LINE_LOOP:Int;\n\tvar LINE_STRIP:Int;\n\tvar TRIANGLES:Int;\n\tvar TRIANGLE_STRIP:Int;\n\tvar TRIANGLE_FAN:Int;\n}\n\ntypedef ScaleModes = {\n\tvar DEFAULT:Int;\n\tvar LINEAR:Int;\n\tvar NEAREST:Int;\n}\n\ntypedef BlendModes = {\n\tvar NORMAL:Int;\n\tvar ADD:Int;\n\tvar MULTIPLY:Int;\n\tvar SCREEN:Int;\n\tvar OVERLAY:Int;\n\tvar DARKEN:Int;\n\tvar LIGHTEN:Int;\n\tvar COLOR_DODGE:Int;\n\tvar COLOR_BURN:Int;\n\tvar HARD_LIGHT:Int;\n\tvar SOFT_LIGHT:Int;\n\tvar DIFFERENCE:Int;\n\tvar EXCLUSION:Int;\n\tvar HUE:Int;\n\tvar SATURATION:Int;\n\tvar COLOR:Int;\n\tvar LUMINOSITY:Int;\n}\n\ntypedef Shapes = {\n\tvar POLY:Int;\n\tvar RECT:Int;\n\tvar CIRC:Int;\n\tvar ELIP:Int;\n\tvar RREC:Int;\n}","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:noDoc\nclass HxOverrides {\n\n\tstatic function dateStr( date :Date ) : String {\n\t\tvar m = date.getMonth() + 1;\n\t\tvar d = date.getDate();\n\t\tvar h = date.getHours();\n\t\tvar mi = date.getMinutes();\n\t\tvar s = date.getSeconds();\n\t\treturn date.getFullYear()\n\t\t\t+\"-\"+(if( m < 10 ) \"0\"+m else \"\"+m)\n\t\t\t+\"-\"+(if( d < 10 ) \"0\"+d else \"\"+d)\n\t\t\t+\" \"+(if( h < 10 ) \"0\"+h else \"\"+h)\n\t\t\t+\":\"+(if( mi < 10 ) \"0\"+mi else \"\"+mi)\n\t\t\t+\":\"+(if( s < 10 ) \"0\"+s else \"\"+s);\n\t}\n\n\tstatic function strDate( s : String ) : Date {\n\t\tswitch( s.length ) {\n\t\tcase 8: // hh:mm:ss\n\t\t\tvar k = s.split(\":\");\n\t\t\tvar d : Date = untyped __new__(Date);\n\t\t\tuntyped d[\"setTime\"](0);\n\t\t\tuntyped d[\"setUTCHours\"](k[0]);\n\t\t\tuntyped d[\"setUTCMinutes\"](k[1]);\n\t\t\tuntyped d[\"setUTCSeconds\"](k[2]);\n\t\t\treturn d;\n\t\tcase 10: // YYYY-MM-DD\n\t\t\tvar k = s.split(\"-\");\n\t\t\treturn new Date(cast k[0],cast untyped k[1] - 1,cast k[2],0,0,0);\n\t\tcase 19: // YYYY-MM-DD hh:mm:ss\n\t\t\tvar k = s.split(\" \");\n\t\t\tvar y = k[0].split(\"-\");\n\t\t\tvar t = k[1].split(\":\");\n\t\t\treturn new Date(cast y[0],cast untyped y[1] - 1,cast y[2],cast t[0],cast t[1],cast t[2]);\n\t\tdefault:\n\t\t\tthrow \"Invalid date format : \" + s;\n\t\t}\n\t}\n\n\tstatic function cca( s : String, index : Int ) : Null<Int> {\n\t\tvar x = (cast s).charCodeAt(index);\n\t\tif( x != x ) // fast isNaN\n\t\t\treturn untyped undefined; // isNaN will still return true\n\t\treturn x;\n\t}\n\n\tstatic function substr( s : String, pos : Int, ?len : Int ) : String {\n\t\tif( pos != null && pos != 0 && len != null && len < 0 ) return \"\";\n\t\tif( len == null ) len = s.length;\n\t\tif( pos < 0 ){\n\t\t\tpos = s.length + pos;\n\t\t\tif( pos < 0 ) pos = 0;\n\t\t}else if( len < 0 ){\n\t\t\tlen = s.length + len - pos;\n\t\t}\n\n\t\treturn (untyped s).substr(pos, len);\n\t}\n\n\tstatic function indexOf<T>( a : Array<T>, obj : T, i : Int) {\n\t\tvar len = a.length;\n\t\tif (i < 0) {\n\t\t\ti += len;\n\t\t\tif (i < 0) i = 0;\n\t\t}\n\t\twhile (i < len)\n\t\t{\n\t\t\tif (untyped __js__(\"a[i] === obj\"))\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function lastIndexOf<T>( a : Array<T>, obj : T, i : Int) {\n\t\tvar len = a.length;\n\t\tif (i >= len)\n\t\t\ti = len - 1;\n\t\telse if (i < 0)\n\t\t\ti += len;\n\t\twhile (i >= 0)\n\t\t{\n\t\t\tif (untyped __js__(\"a[i] === obj\"))\n\t\t\t\treturn i;\n\t\t\ti--;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function remove<T>( a : Array<T>, obj : T ) {\n\t\tvar i = a.indexOf(obj);\n\t\tif( i == -1 ) return false;\n\t\ta.splice(i,1);\n\t\treturn true;\n\t}\n\n\tstatic function iter<T>( a : Array<T> ) : Iterator<T> untyped {\n\t\treturn {\n\t\t\tcur : 0,\n\t\t\tarr : a,\n\t\t\thasNext : function() {\n\t\t\t\treturn __this__.cur < __this__.arr.length;\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\treturn __this__.arr[__this__.cur++];\n\t\t\t}\n\t\t};\n\t}\n\n\tstatic function __init__() untyped {\n#if !js_es5\n\t\t__feature__('HxOverrides.indexOf', if( Array.prototype.indexOf ) __js__(\"HxOverrides\").indexOf = function(a,o,i) return Array.prototype.indexOf.call(a, o, i));\n\t\t__feature__('HxOverrides.lastIndexOf', if( Array.prototype.lastIndexOf ) __js__(\"HxOverrides\").lastIndexOf = function(a,o,i) return Array.prototype.lastIndexOf.call(a, o, i));\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class Reflect {\n\n\tpublic inline static function hasField( o : Dynamic, field : String ) : Bool {\n\t\treturn untyped __js__('Object').prototype.hasOwnProperty.call(o, field);\n\t}\n\n\tpublic static function field( o : Dynamic, field : String ) : Dynamic {\n\t\ttry return untyped o[field] catch( e : Dynamic ) return null;\n\t}\n\n\tpublic inline static function setField( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\to[field] = value;\n\t}\n\n\tpublic static inline function getProperty( o : Dynamic, field : String ) : Dynamic untyped {\n\t\tvar tmp;\n\t\treturn if( o == null ) __define_feature__(\"Reflect.getProperty\",null) else if( o.__properties__ && (tmp=o.__properties__[\"get_\"+field]) ) o[tmp]() else o[field];\n\t}\n\n\tpublic static inline function setProperty( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\tvar tmp;\n\t\tif( o.__properties__ && (tmp=o.__properties__[\"set_\"+field]) ) o[tmp](value) else o[field] = __define_feature__(\"Reflect.setProperty\",value);\n\t}\n\n\tpublic inline static function callMethod( o : Dynamic, func : haxe.Constraints.Function, args : Array<Dynamic> ) : Dynamic untyped {\n\t\treturn func.apply(o,args);\n\t}\n\n\tpublic static function fields( o : Dynamic ) : Array<String> {\n\t\tvar a = [];\n\t\tif (o != null) untyped {\n\t\t\tvar hasOwnProperty = __js__('Object').prototype.hasOwnProperty;\n\t\t\t__js__(\"for( var f in o ) {\");\n\t\t\tif( f != \"__id__\" && f != \"hx__closures__\" && hasOwnProperty.call(o, f) ) a.push(f);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a;\n\t}\n\n\tpublic static function isFunction( f : Dynamic ) : Bool untyped {\n\t\treturn __js__(\"typeof(f)\") == \"function\" && !(js.Boot.isClass(f) || js.Boot.isEnum(f));\n\t}\n\n\tpublic static function compare<T>( a : T, b : T ) : Int {\n\t\treturn ( a == b ) ? 0 : (((cast a) > (cast b)) ? 1 : -1);\n\t}\n\n\tpublic static function compareMethods( f1 : Dynamic, f2 : Dynamic ) : Bool {\n\t\tif( f1 == f2 )\n\t\t\treturn true;\n\t\tif( !isFunction(f1) || !isFunction(f2) )\n\t\t\treturn false;\n\t\treturn f1.scope == f2.scope && f1.method == f2.method && f1.method != null;\n\t}\n\n\tpublic static function isObject( v : Dynamic ) : Bool untyped {\n\t\tif( v == null )\n\t\t\treturn false;\n\t\tvar t = __js__(\"typeof(v)\");\n\t\treturn (t == \"string\" || (t == \"object\" && v.__enum__ == null)) || (t == \"function\" && (js.Boot.isClass(v) || js.Boot.isEnum(v)) != null);\n\t}\n\n\tpublic static function isEnumValue( v : Dynamic ) : Bool {\n\t\treturn v != null && v.__enum__ != null;\n\t}\n\n\tpublic static function deleteField( o : Dynamic, field : String ) : Bool untyped {\n\t\tif( !hasField(o,field) ) return false;\n\t\t__js__(\"delete\")(o[field]);\n\t\treturn true;\n\t}\n\n\tpublic static function copy<T>( o : T ) : T {\n\t\tvar o2 : Dynamic = {};\n\t\tfor( f in Reflect.fields(o) )\n\t\t\tReflect.setField(o2,f,Reflect.field(o,f));\n\t\treturn o2;\n\t}\n\n\t@:overload(function( f : Array<Dynamic> -> Void ) : Dynamic {})\n\tpublic static function makeVarArgs( f : Array<Dynamic> -> Dynamic ) : Dynamic {\n\t\treturn function() {\n\t\t\tvar a = untyped Array.prototype.slice.call(__js__(\"arguments\"));\n\t\t\treturn f(a);\n\t\t};\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport js.Boot;\n\n@:keepInit\n@:coreApi class Std {\n\n\tpublic static inline function is( v : Dynamic, t : Dynamic ) : Bool {\n\t\treturn untyped js.Boot.__instanceof(v,t);\n\t}\n\n\tpublic static inline function instance<T:{},S:T>( value : T, c : Class<S> ) : S {\n\t\treturn untyped __instanceof__(value, c) ? cast value : null;\n\t}\n\n\tpublic static function string( s : Dynamic ) : String {\n\t\treturn untyped js.Boot.__string_rec(s,\"\");\n\t}\n\n\tpublic static inline function int( x : Float ) : Int {\n\t\treturn (cast x) | 0;\n\t}\n\n\tpublic static function parseInt( x : String ) : Null<Int> {\n\t\tvar v = untyped __js__(\"parseInt\")(x, 10);\n\t\t// parse again if hexadecimal\n\t\tif( v == 0 && (x.charCodeAt(1) == 'x'.code || x.charCodeAt(1) == 'X'.code) )\n\t\t\tv = untyped __js__(\"parseInt\")(x);\n\t\tif( untyped __js__(\"isNaN\")(v) )\n\t\t\treturn null;\n\t\treturn cast v;\n\t}\n\n\tpublic static inline function parseFloat( x : String ) : Float {\n\t\treturn untyped __js__(\"parseFloat\")(x);\n\t}\n\n\tpublic static function random( x : Int ) : Int {\n\t\treturn untyped x <= 0 ? 0 : Math.floor(Math.random()*x);\n\t}\n\n\tstatic function __init__() : Void untyped {\n\t\t__feature__(\"js.Boot.getClass\",String.prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"String\"] = String,String));\n\t\t__feature__(\"js.Boot.isClass\",String.__name__ = __feature__(\"Type.getClassName\",[\"String\"],true));\n\t\t__feature__(\"Type.resolveClass\",$hxClasses[\"Array\"] = Array);\n\t\t__feature__(\"js.Boot.isClass\",Array.__name__ = __feature__(\"Type.getClassName\",[\"Array\"],true));\n\t\t__feature__(\"Date.*\", {\n\t\t\t__feature__(\"js.Boot.getClass\",__js__('Date').prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"Date\"] = __js__('Date'),__js__('Date')));\n\t\t\t__feature__(\"js.Boot.isClass\",__js__('Date').__name__ = [\"Date\"]);\n\t\t});\n\t\t__feature__(\"Int.*\",{\n\t\t\tvar Int = __feature__(\"Type.resolveClass\", $hxClasses[\"Int\"] = { __name__ : [\"Int\"] }, { __name__ : [\"Int\"] });\n\t\t});\n\t\t__feature__(\"Dynamic.*\",{\n\t\t\tvar Dynamic = __feature__(\"Type.resolveClass\", $hxClasses[\"Dynamic\"] = { __name__ : [\"Dynamic\"] }, { __name__ : [\"Dynamic\"] });\n\t\t});\n\t\t__feature__(\"Float.*\",{\n\t\t\tvar Float = __feature__(\"Type.resolveClass\", $hxClasses[\"Float\"] = __js__(\"Number\"), __js__(\"Number\"));\n\t\t\tFloat.__name__ = [\"Float\"];\n\t\t});\n\t\t__feature__(\"Bool.*\",{\n\t\t\tvar Bool = __feature__(\"Type.resolveEnum\",$hxClasses[\"Bool\"] = __js__(\"Boolean\"), __js__(\"Boolean\"));\n\t\t\tBool.__ename__ = [\"Bool\"];\n\t\t});\n\t\t__feature__(\"Class.*\",{\n\t\t\tvar Class = __feature__(\"Type.resolveClass\", $hxClasses[\"Class\"] = { __name__ : [\"Class\"] }, { __name__ : [\"Class\"] });\n\t\t});\n\t\t__feature__(\"Enum.*\",{\n\t\t\tvar Enum = {};\n\t\t});\n\t\t__feature__(\"Void.*\",{\n\t\t\tvar Void = __feature__(\"Type.resolveEnum\", $hxClasses[\"Void\"] = { __ename__ : [\"Void\"] }, { __ename__ : [\"Void\"] });\n\t\t});\n\n#if !js_es5\n\t\t__feature__(\"Array.map\",\n\t\t\tif( Array.prototype.map == null )\n\t\t\t\tArray.prototype.map = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length )\n\t\t\t\t\t\ta[i] = f(__this__[i]);\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n\t\t__feature__(\"Array.filter\",\n\t\t\tif( Array.prototype.filter == null )\n\t\t\t\tArray.prototype.filter = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length ) {\n\t\t\t\t\t\tvar e = __this__[i];\n\t\t\t\t\t\tif( f(e) ) a.push(e);\n\t\t\t\t\t}\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nenum ValueType {\n\tTNull;\n\tTInt;\n\tTFloat;\n\tTBool;\n\tTObject;\n\tTFunction;\n\tTClass( c : Class<Dynamic> );\n\tTEnum( e : Enum<Dynamic> );\n\tTUnknown;\n}\n\n@:coreApi class Type {\n\n\tpublic static inline function getClass<T>( o : T ) : Class<T> {\n\t\treturn if (o == null) null else @:privateAccess js.Boot.getClass(o);\n\t}\n\n\tpublic static function getEnum( o : EnumValue ) : Enum<Dynamic> untyped {\n\t\tif( o == null )\n\t\t\treturn null;\n\t\treturn o.__enum__;\n\t}\n\n\tpublic static function getSuperClass( c : Class<Dynamic> ) : Class<Dynamic> untyped {\n\t\treturn c.__super__;\n\t}\n\n\n\tpublic static function getClassName( c : Class<Dynamic> ) : String {\n\t\tvar a : Array<String> = untyped c.__name__;\n\t\tif (a == null)\n\t\t\treturn null;\n\t\treturn a.join(\".\");\n\t}\n\n\tpublic static function getEnumName( e : Enum<Dynamic> ) : String {\n\t\tvar a : Array<String> = untyped e.__ename__;\n\t\treturn a.join(\".\");\n\t}\n\n\tpublic static function resolveClass( name : String ) : Class<Dynamic> untyped {\n\t\tvar cl : Class<Dynamic> = $hxClasses[name];\n\t\t// ensure that this is a class\n\t\tif( cl == null || !js.Boot.isClass(cl) )\n\t\t\treturn null;\n\t\treturn cl;\n\t}\n\n\tpublic static function resolveEnum( name : String ) : Enum<Dynamic> untyped {\n\t\tvar e : Dynamic = $hxClasses[name];\n\t\t// ensure that this is an enum\n\t\tif( e == null || !js.Boot.isEnum(e) )\n\t\t\treturn null;\n\t\treturn e;\n\t}\n\n\tpublic static function createInstance<T>( cl : Class<T>, args : Array<Dynamic> ) : T untyped {\n\t\tswitch( args.length ) {\n\t\tcase 0:\n\t\t\treturn __new__(cl);\n\t\tcase 1:\n\t\t\treturn __new__(cl,args[0]);\n\t\tcase 2:\n\t\t\treturn __new__(cl,args[0],args[1]);\n\t\tcase 3:\n\t\t\treturn __new__(cl,args[0],args[1],args[2]);\n\t\tcase 4:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3]);\n\t\tcase 5:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4]);\n\t\tcase 6:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5]);\n\t\tcase 7:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6]);\n\t\tcase 8:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7]);\n\t\tdefault:\n\t\t\tthrow \"Too many arguments\";\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic static function createEmptyInstance<T>( cl : Class<T> ) : T untyped {\n\t\t__js__(\"function empty() {}; empty.prototype = cl.prototype\");\n\t\treturn __js__(\"new empty()\");\n\t}\n\n\tpublic static function createEnum<T>( e : Enum<T>, constr : String, ?params : Array<Dynamic> ) : T {\n\t\tvar f:Dynamic = Reflect.field(e,constr);\n\t\tif( f == null ) throw \"No such constructor \"+constr;\n\t\tif( Reflect.isFunction(f) ) {\n\t\t\tif( params == null ) throw \"Constructor \"+constr+\" need parameters\";\n\t\t\treturn Reflect.callMethod(e,f,params);\n\t\t}\n\t\tif( params != null && params.length != 0 )\n\t\t\tthrow \"Constructor \"+constr+\" does not need parameters\";\n\t\treturn f;\n\t}\n\n\tpublic static function createEnumIndex<T>( e : Enum<T>, index : Int, ?params : Array<Dynamic> ) : T {\n\t\tvar c : String = (untyped e.__constructs__)[index];\n\t\tif( c == null ) throw index+\" is not a valid enum constructor index\";\n\t\treturn createEnum(e,c,params);\n\t}\n\n\tpublic static function getInstanceFields( c : Class<Dynamic> ) : Array<String> {\n\t\tvar a = [];\n\t\tuntyped __js__(\"for(var i in c.prototype) a.push(i)\");\n\t\ta.remove(\"__class__\");\n\t\ta.remove(\"__properties__\");\n\t\treturn a;\n\t}\n\n\tpublic static function getClassFields( c : Class<Dynamic> ) : Array<String> {\n\t\tvar a = Reflect.fields(c);\n\t\ta.remove(\"__name__\");\n\t\ta.remove(\"__interfaces__\");\n\t\ta.remove(\"__properties__\");\n\t\ta.remove(\"__super__\");\n\t\ta.remove(\"__meta__\");\n\t\ta.remove(\"prototype\");\n\t\treturn a;\n\t}\n\n\tpublic static function getEnumConstructs( e : Enum<Dynamic> ) : Array<String> {\n\t\tvar a : Array<String> = untyped e.__constructs__;\n\t\treturn a.copy();\n\t}\n\n\tpublic static function typeof( v : Dynamic ) : ValueType untyped {\n\t\tswitch( __js__(\"typeof\")(v) ) {\n\t\tcase \"boolean\": return TBool;\n\t\tcase \"string\": return TClass(String);\n\t\tcase \"number\":\n\t\t\t// this should handle all cases : NaN, +/-Inf and Floats outside range\n\t\t\tif( Math.ceil(v) == v%2147483648.0 )\n\t\t\t\treturn TInt;\n\t\t\treturn TFloat;\n\t\tcase \"object\":\n\t\t\tif( v == null )\n\t\t\t\treturn TNull;\n\t\t\tvar e = v.__enum__;\n\t\t\tif( e != null )\n\t\t\t\treturn TEnum(e);\n\t\t\tvar c = js.Boot.getClass(v);\n\t\t\tif( c != null )\n\t\t\t\treturn TClass(c);\n\t\t\treturn TObject;\n\t\tcase \"function\":\n\t\t\tif( js.Boot.isClass(v) || js.Boot.isEnum(v) )\n\t\t\t\treturn TObject;\n\t\t\treturn TFunction;\n\t\tcase \"undefined\":\n\t\t\treturn TNull;\n\t\tdefault:\n\t\t\treturn TUnknown;\n\t\t}\n\t}\n\n\tpublic static function enumEq<T>( a : T, b : T ) : Bool untyped {\n\t\tif( a == b )\n\t\t\treturn true;\n\t\ttry {\n\t\t\tif( a[0] != b[0] )\n\t\t\t\treturn false;\n\t\t\tfor( i in 2...a.length )\n\t\t\t\tif( !enumEq(a[i],b[i]) )\n\t\t\t\t\treturn false;\n\t\t\tvar e = a.__enum__;\n\t\t\tif( e != b.__enum__ || e == null )\n\t\t\t\treturn false;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic inline static function enumConstructor( e : EnumValue ) : String {\n\t\treturn untyped e[0];\n\t}\n\n\tpublic inline static function enumParameters( e : EnumValue ) : Array<Dynamic> {\n\t\treturn untyped e.slice(2);\n\t}\n\n\tpublic inline static function enumIndex( e : EnumValue ) : Int {\n\t\treturn untyped e[1];\n\t}\n\n\tpublic static function allEnums<T>( e : Enum<T> ) : Array<T> {\n\t\treturn untyped e.__empty_constructs__;\n\t}\n\n}\n\n","package fluid.core.display;\n\nimport msignal.Signal.Signal1;\nimport fluid.core.textures.RenderTexture;\nimport js.Error;\nimport fluid.core.renderers.webgl.WebGLRenderer;\nimport fluid.core.textures.Texture;\nimport fluid.core.math.Matrix;\nimport fluid.core.math.shapes.Rectangle;\nimport fluid.core.math.Point;\n\nclass DisplayObject {\n\n\tpublic var added:Signal1<DisplayObject>;\n\tpublic var removed:Signal1<DisplayObject>;\n\n\tpublic var name:String;\n\tpublic var cacheAsBitmap:Bool;\n\tpublic var position:Point;\n\tpublic var scale:Point;\n\tpublic var pivot:Point;\n\tpublic var skew:Point;\n\tpublic var rotation:Float;\n\tpublic var alpha:Float;\n\tpublic var visible:Bool;\n\tpublic var renderable:Bool;\n\tpublic var parent:Container;\n\tpublic var worldAlpha:Float;\n\tpublic var worldTransform:Matrix;\n\tpublic var filterArea:Rectangle;\n\tpublic var x:Float;\n\tpublic var y:Float;\n\tpublic var worldVisible:Bool;\n\tpublic var mask:Dynamic;\n\tpublic var filters(get, set):Array<Dynamic>;\n\tpublic var interactive:Bool;\n\tpublic var buttonMode:Bool;\n\tpublic var interactiveChildren:Bool;\n\tpublic var defaultCursor:String;\n\tpublic var hitArea:Dynamic;\n\n\tpublic var displayObjectUpdateTransform:Void -> Void;\n\tpublic var containerGetBounds:?Matrix -> Rectangle;\n\n\tvar _filters:Array<Dynamic>;\n\n\tvar _sr:Float;\n\tvar _cr:Float;\n\tvar _bounds:Rectangle;\n\tvar _currentBounds:Rectangle;\n\tvar _mask:Dynamic;\n\tvar _tempMatrix:Matrix;\n\tvar _tempDisplayObjectParent:Dynamic = { worldTransform:new Matrix(), worldAlpha:1, children:[] };\n\tvar rotationCache:Float;\n\n\tpublic function new() {\n\t\tadded = new Signal1(Container);\n\t\tremoved = new Signal1(Container);\n\n\t\tthis.position = new Point();\n\t\tthis.scale = new Point(1, 1);\n\t\tthis.pivot = new Point(0, 0);\n\t\tthis.skew = new Point(0, 0);\n\t\tthis.rotation = 0;\n\t\tthis.alpha = 1;\n\t\tthis.visible = true;\n\t\tthis.renderable = true;\n\t\tthis.parent = null;\n\t\tthis.worldAlpha = 1;\n\t\tthis.worldTransform = new Matrix();\n\t\tthis.filterArea = null;\n\t\tthis._sr = 0;\n\t\tthis._cr = 1;\n\t\tthis._bounds = new Rectangle(0, 0, 1, 1);\n\t\tthis._currentBounds = null;\n\t\tthis._mask = null;\n\t\t_tempMatrix = new Matrix();\n\n\t\tdisplayObjectUpdateTransform = updateTransform;\n\t\tcontainerGetBounds = getBounds;\n\t}\n\n\tfunction set_filters(value:Array<Dynamic>):Array<Dynamic> {\n\t\treturn this._filters = (value != null) ? value.slice(0) : null;\n\t}\n\n\tfunction get_filters():Array<Dynamic> {\n\t\treturn (this._filters != null) ? this._filters.slice(0) : null;\n\t}\n\n\tpublic function getBounds(?matrix:Matrix):Rectangle {\n\t\treturn Rectangle.EMPTY;\n\t}\n\n\tpublic function getLocalBounds():Rectangle {\n\t\treturn this.getBounds(Matrix.IDENTITY);\n\t}\n\n\tpublic function toGlobal(position:Point):Point {\n\t\tif (this.parent == null) {\n\t\t\tthis.parent = _tempDisplayObjectParent;\n\t\t\tthis.displayObjectUpdateTransform();\n\t\t\tthis.parent = null;\n\t\t}\n\t\telse this.displayObjectUpdateTransform();\n\t\treturn this.worldTransform.apply(position);\n\t}\n\n\tpublic function toLocal(position:Point, ?from:DisplayObject, ?point:Point):Point {\n\t\tif (from != null) position = from.toGlobal(position);\n\t\tif (this.parent == null) {\n\t\t\tthis.parent = _tempDisplayObjectParent;\n\t\t\tthis.displayObjectUpdateTransform();\n\t\t\tthis.parent = null;\n\t\t}\n\t\telse this.displayObjectUpdateTransform();\n\t\treturn this.worldTransform.applyInverse(position, point);\n\t}\n\n\tpublic function updateTransform():Void {\n\t\tvar pt = this.parent.worldTransform;\n\t\tvar wt = this.worldTransform;\n\t\tvar a, b, c, d, tx, ty;\n\n\t\tif (this.skew.x != null || this.skew.y != null) {\n\t\t\t_tempMatrix.setTransform(\n\t\t\t\tthis.position.x,\n\t\t\t\tthis.position.y,\n\t\t\t\tthis.pivot.x,\n\t\t\t\tthis.pivot.y,\n\t\t\t\tthis.scale.x,\n\t\t\t\tthis.scale.y,\n\t\t\t\tthis.rotation,\n\t\t\t\tthis.skew.x,\n\t\t\t\tthis.skew.y\n\t\t\t);\n\n\t\t\t// now concat the matrix (inlined so that we can avoid using copy)\n\t\t\twt.a = _tempMatrix.a * pt.a + _tempMatrix.b * pt.c;\n\t\t\twt.b = _tempMatrix.a * pt.b + _tempMatrix.b * pt.d;\n\t\t\twt.c = _tempMatrix.c * pt.a + _tempMatrix.d * pt.c;\n\t\t\twt.d = _tempMatrix.c * pt.b + _tempMatrix.d * pt.d;\n\t\t\twt.tx = _tempMatrix.tx * pt.a + _tempMatrix.ty * pt.c + pt.tx;\n\t\t\twt.ty = _tempMatrix.tx * pt.b + _tempMatrix.ty * pt.d + pt.ty;\n\t\t}\n\t\telse {\n\t\t\tif (this.rotation % Fluid.PI_2 != null) {\n\t\t\t\tif (this.rotation != this.rotationCache) {\n\t\t\t\t\tthis.rotationCache = this.rotation;\n\t\t\t\t\tthis._sr = Math.sin(this.rotation);\n\t\t\t\t\tthis._cr = Math.cos(this.rotation);\n\t\t\t\t}\n\n\t\t\t\ta = this._cr * this.scale.x;\n\t\t\t\tb = this._sr * this.scale.x;\n\t\t\t\tc = -this._sr * this.scale.y;\n\t\t\t\td = this._cr * this.scale.y;\n\t\t\t\ttx = this.position.x;\n\t\t\t\tty = this.position.y;\n\n\t\t\t\tif (this.pivot.x != null || this.pivot.y != null) {\n\t\t\t\t\ttx -= this.pivot.x * a + this.pivot.y * c;\n\t\t\t\t\tty -= this.pivot.x * b + this.pivot.y * d;\n\t\t\t\t}\n\n\t\t\t\twt.a = a * pt.a + b * pt.c;\n\t\t\t\twt.b = a * pt.b + b * pt.d;\n\t\t\t\twt.c = c * pt.a + d * pt.c;\n\t\t\t\twt.d = c * pt.b + d * pt.d;\n\t\t\t\twt.tx = tx * pt.a + ty * pt.c + pt.tx;\n\t\t\t\twt.ty = tx * pt.b + ty * pt.d + pt.ty;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ta = this.scale.x;\n\t\t\t\td = this.scale.y;\n\n\t\t\t\ttx = this.position.x - this.pivot.x * a;\n\t\t\t\tty = this.position.y - this.pivot.y * d;\n\n\t\t\t\twt.a = a * pt.a;\n\t\t\t\twt.b = a * pt.b;\n\t\t\t\twt.c = d * pt.c;\n\t\t\t\twt.d = d * pt.d;\n\t\t\t\twt.tx = tx * pt.a + ty * pt.c + pt.tx;\n\t\t\t\twt.ty = tx * pt.b + ty * pt.d + pt.ty;\n\t\t\t}\n\t\t}\n\n\t\tthis.worldAlpha = this.alpha * this.parent.worldAlpha;\n\t\tthis._currentBounds = null;\n\t}\n\n\tpublic function renderWebGL(renderer:WebGLRenderer):Void {}\n\n\tpublic function generateTexture(renderer:Dynamic, ?resolution:Float = 1, ?scaleMode:Int = 0):Texture {\n\t\tvar bounds = this.getLocalBounds();\n\t\tif (bounds.width == null) bounds.width = 0;\n\t\tif (bounds.height == null) bounds.height = 0;\n\n\t\tvar renderTexture = new RenderTexture(renderer, bounds.width, bounds.height, scaleMode, resolution);\n\n\t\t_tempMatrix.tx = -bounds.x;\n\t\t_tempMatrix.ty = -bounds.y;\n\n\t\trenderTexture.render(this, _tempMatrix);\n\n\t\treturn renderTexture;\n\t}\n\n\tpublic function setParent(container):Dynamic {\n\t\tif (container == null || container.addChild == null) {\n\t\t\tthrow new Error(\"setParent: Argument must be a Container\");\n\t\t}\n\t\tcontainer.addChild(this);\n\t\treturn container;\n\t}\n\n\tpublic function setTransform(?x:Int = 0, ?y:Int = 0, ?scaleX:Float = 1, ?scaleY:Float = 1, ?rotation:Float = 0, ?skewX:Float = 0, ?skewY:Float = 0, ?pivotX:Float = 0, ?pivotY:Float = 0):DisplayObject {\n\t\tthis.position.x = x;\n\t\tthis.position.y = y;\n\t\tthis.scale.x = scaleX;\n\t\tthis.scale.y = scaleY;\n\t\tthis.rotation = rotation;\n\t\tthis.skew.x = skewX;\n\t\tthis.skew.y = skewY;\n\t\tthis.pivot.x = pivotX;\n\t\tthis.pivot.y = pivotY;\n\t\treturn this;\n\t}\n\n\tpublic function destroy(?destroyTexture:Bool = false, ?destroyBaseTexture:Bool = false):Void {\n\t\tthis.position = null;\n\t\tthis.scale = null;\n\t\tthis.pivot = null;\n\t\tthis.skew = null;\n\n\t\tthis.parent = null;\n\n\t\tthis._bounds = null;\n\t\tthis._currentBounds = null;\n\t\tthis._mask = null;\n\n\t\tthis.worldTransform = null;\n\t\tthis.filterArea = null;\n\t}\n}","package fluid.core.display;\n\nimport fluid.core.renderers.webgl.WebGLRenderer;\nimport fluid.core.utils.Utils;\nimport js.Error;\nimport msignal.Signal.Signal1;\n\nclass Container extends DisplayObject {\n\n\tpublic var children:Array<DisplayObject>;\n\tpublic var width(get, set):Float;\n\tpublic var height(get, set):Float;\n\n\tvar _width:Float;\n\tvar _height:Float;\n\n\tpublic function new() {\n\t\tsuper();\n\t\tthis.children = [];\n\t}\n\n\tfunction set_width(value:Float):Float {\n\t\tvar width = this.getLocalBounds().width;\n\t\tif (width != 0) this.scale.x = value / width;\n\t\telse this.scale.x = 1;\n\t\treturn this._width = value;\n\t}\n\n\tfunction get_width():Float {\n\t\treturn this.scale.x * this.getLocalBounds().width;\n\t}\n\n\tfunction set_height(value:Float):Float {\n\t\tvar height = this.getLocalBounds().height;\n\t\tif (height != 0) this.scale.y = value / height;\n\t\telse this.scale.y = 1;\n\t\treturn this._height = value;\n\t}\n\n\tfunction get_height():Float {\n\t\treturn this.scale.y * this.getLocalBounds().height;\n\t}\n\n\toverride public function renderWebGL(renderer:WebGLRenderer):Void {\n\t\tif (!this.visible || this.worldAlpha <= 0 || !this.renderable) return;\n\n\t\tvar i, j;\n\n\t\tif (this._mask != null || this._filters != null) {\n\t\t\trenderer.currentRenderer.flush();\n\t\t\tif (this._filters != null && this._filters.length > 0) {\n\t\t\t\trenderer.filterManager.pushFilter(this, this._filters);\n\t\t\t}\n\n\t\t\tif (this._mask != null) {\n\t\t\t\trenderer.maskManager.pushMask(this, this._mask);\n\t\t\t}\n\n\t\t\trenderer.currentRenderer.start();\n\t\t\tthis._renderWebGL(renderer);\n\t\t\ti = 0;\n\t\t\tj = this.children.length;\n\t\t\twhile (i < j) {\n\t\t\t\tthis.children[i].renderWebGL(renderer);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\trenderer.currentRenderer.flush();\n\n\t\t\tif (this._mask) {\n\t\t\t\trenderer.maskManager.popMask(this, this._mask);\n\t\t\t}\n\n\t\t\tif (this._filters != null) {\n\t\t\t\trenderer.filterManager.popFilter();\n\n\t\t\t}\n\t\t\trenderer.currentRenderer.start();\n\t\t}\n\t\telse {\n\t\t\tthis._renderWebGL(renderer);\n\t\t\ti = 0;\n\t\t\tj = this.children.length;\n\t\t\twhile (i < j) {\n\t\t\t\tthis.children[i].renderWebGL(renderer);\n\t\t\t\ti++;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _renderWebGL(renderer:WebGLRenderer) {}\n\n\tpublic function addChild(child:DisplayObject):DisplayObject {\n\t\tif (child.parent != null) child.parent.removeChild(child);\n\t\tchild.parent = this;\n\t\tthis.children.push(child);\n\n\t\t//this.onChildrenChange(this.children.length-1);\n\t\tchild.added.dispatch(this);\n\t\treturn child;\n\t}\n\n\tpublic function addChildAt(child:DisplayObject, index:Int):DisplayObject {\n\t\tif (index >= 0 && index <= this.children.length) {\n\t\t\tif (child.parent != null) child.parent.removeChild(child);\n\t\t\tchild.parent = this;\n\t\t\tthis.children.insert(index, child);\n\t\t\t//this.onChildrenChange(index);\n\t\t\tchild.added.dispatch(this);\n\n\t\t\treturn child;\n\t\t}\n\t\telse throw new Error(child + 'addChildAt: The index ' + index + ' supplied is out of bounds ' + this.children.length);\n\t}\n\n\tpublic function swapChildren(child1:DisplayObject, child2:DisplayObject):Void {\n\n\t}\n\n\t//public function getChildIndex(child:DisplayObject):Int;\n\n\tpublic function setChildIndex(child:DisplayObject, index:Int):Void {\n\n\t}\n\n\t//public function getChildAt(index:Int):DisplayObject {}\n\n\tpublic function removeChild(child:DisplayObject):DisplayObject {\n\t\tvar index = this.children.indexOf(child);\n\t\tif (index == -1) return null;\n\n\t\tchild.parent = null;\n\t\tUtils.removeItems(this.children, index, 1);\n\t\t//this.onChildrenChange(index);\n\t\tchild.removed.dispatch(this);\n\n\t\treturn child;\n\t}\n\n\t//public function removeChildAt(index:Int):DisplayObject;\n\n\t//public function removeChildren(?beginIndex:Int, ?endIndex:Int):Void;\n\n\t//public function getChildByName(name:String):DisplayObject;\n}","package fluid.core.math;\n\nclass Matrix {\n\n\tpublic static var IDENTITY = new Matrix();\n\tpublic static var TEMP_MATRIX = new Matrix();\n\n\tpublic var a:Float;\n\tpublic var b:Float;\n\tpublic var c:Float;\n\tpublic var d:Float;\n\tpublic var tx:Float;\n\tpublic var ty:Float;\n\tpublic var array:Array<Float>;\n\n\tpublic function new():Void {\n\t\tthis.a = 1;\n\t\tthis.b = 0;\n\t\tthis.c = 0;\n\t\tthis.d = 1;\n\t\tthis.tx = 0;\n\t\tthis.ty = 0;\n\t}\n\n\tpublic function fromArray(array:Array<Float>):Void {\n\t\tthis.a = array[0];\n\t\tthis.b = array[1];\n\t\tthis.c = array[3];\n\t\tthis.d = array[4];\n\t\tthis.tx = array[2];\n\t\tthis.ty = array[5];\n\t}\n\n\tpublic function set(a:Float, b:Float, c:Float, d:Float, tx:Float, ty:Float):Matrix {\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t\tthis.c = c;\n\t\tthis.d = d;\n\t\tthis.tx = tx;\n\t\tthis.ty = ty;\n\n\t\treturn this;\n\t}\n\n\tpublic function toArray(transpose:Bool, out:Array<Float>):Array<Float> {\n\t\tif (this.array == null) this.array = [];\n\n\t\tvar array = (out == null) ? this.array : out;\n\n\t\tif (transpose) {\n\t\t\tarray[0] = this.a;\n\t\t\tarray[1] = this.b;\n\t\t\tarray[2] = 0;\n\t\t\tarray[3] = this.c;\n\t\t\tarray[4] = this.d;\n\t\t\tarray[5] = 0;\n\t\t\tarray[6] = this.tx;\n\t\t\tarray[7] = this.ty;\n\t\t\tarray[8] = 1;\n\t\t}\n\t\telse {\n\t\t\tarray[0] = this.a;\n\t\t\tarray[1] = this.c;\n\t\t\tarray[2] = this.tx;\n\t\t\tarray[3] = this.b;\n\t\t\tarray[4] = this.d;\n\t\t\tarray[5] = this.ty;\n\t\t\tarray[6] = 0;\n\t\t\tarray[7] = 0;\n\t\t\tarray[8] = 1;\n\t\t}\n\n\t\treturn array;\n\t}\n\n\tpublic function apply(pos:Point, ?newPos:Point):Point {\n\t\tif (newPos == null) newPos = new Point();\n\n\t\tvar x = pos.x;\n\t\tvar y = pos.y;\n\n\t\tnewPos.x = this.a * x + this.c * y + this.tx;\n\t\tnewPos.y = this.b * x + this.d * y + this.ty;\n\n\t\treturn newPos;\n\t}\n\n\tpublic function applyInverse(pos:Point, ?newPos:Point):Point {\n\t\tif (newPos == null) newPos = new Point();\n\n\t\tvar id = 1 / (this.a * this.d + this.c * -this.b);\n\n\t\tvar x = pos.x;\n\t\tvar y = pos.y;\n\n\t\tnewPos.x = this.d * id * x + -this.c * id * y + (this.ty * this.c - this.tx * this.d) * id;\n\t\tnewPos.y = this.a * id * y + -this.b * id * x + (-this.ty * this.a + this.tx * this.b) * id;\n\n\t\treturn newPos;\n\t}\n\n\tpublic function translate(x:Float, y:Float):Matrix {\n\t\tthis.tx += x;\n\t\tthis.ty += y;\n\n\t\treturn this;\n\t}\n\n\tpublic function scale(x:Float, y:Float):Matrix {\n\t\tthis.a *= x;\n\t\tthis.d *= y;\n\t\tthis.c *= x;\n\t\tthis.b *= y;\n\t\tthis.tx *= x;\n\t\tthis.ty *= y;\n\n\t\treturn this;\n\t}\n\n\tpublic function rotate(angle:Float):Matrix {\n\t\tvar cos = Math.cos(angle);\n\t\tvar sin = Math.sin(angle);\n\n\t\tvar a1 = this.a;\n\t\tvar c1 = this.c;\n\t\tvar tx1 = this.tx;\n\n\t\tthis.a = a1 * cos - this.b * sin;\n\t\tthis.b = a1 * sin + this.b * cos;\n\t\tthis.c = c1 * cos - this.d * sin;\n\t\tthis.d = c1 * sin + this.d * cos;\n\t\tthis.tx = tx1 * cos - this.ty * sin;\n\t\tthis.ty = tx1 * sin + this.ty * cos;\n\n\t\treturn this;\n\t}\n\n\tpublic function append(matrix:Matrix):Matrix {\n\t\tvar a1 = this.a;\n\t\tvar b1 = this.b;\n\t\tvar c1 = this.c;\n\t\tvar d1 = this.d;\n\n\t\tthis.a = matrix.a * a1 + matrix.b * c1;\n\t\tthis.b = matrix.a * b1 + matrix.b * d1;\n\t\tthis.c = matrix.c * a1 + matrix.d * c1;\n\t\tthis.d = matrix.c * b1 + matrix.d * d1;\n\n\t\tthis.tx = matrix.tx * a1 + matrix.ty * c1 + this.tx;\n\t\tthis.ty = matrix.tx * b1 + matrix.ty * d1 + this.ty;\n\n\t\treturn this;\n\n\t}\n\n\tpublic function setTransform(x:Float, y:Float, pivotX:Float, pivotY:Float, scaleX:Float, scaleY:Float, rotation:Float, skewX:Float, skewY:Float):Matrix {\n\t\tvar a, b, c, d, sr, cr, cy, sy, nsx, cx;\n\n\t\tsr = Math.sin(rotation);\n\t\tcr = Math.cos(rotation);\n\t\tcy = Math.cos(skewY);\n\t\tsy = Math.sin(skewY);\n\t\tnsx = -Math.sin(skewX);\n\t\tcx = Math.cos(skewX);\n\n\t\ta = cr * scaleX;\n\t\tb = sr * scaleX;\n\t\tc = -sr * scaleY;\n\t\td = cr * scaleY;\n\n\t\tthis.a = cy * a + sy * c;\n\t\tthis.b = cy * b + sy * d;\n\t\tthis.c = nsx * a + cx * c;\n\t\tthis.d = nsx * b + cx * d;\n\n\t\tthis.tx = x + ( pivotX * a + pivotY * c );\n\t\tthis.ty = y + ( pivotX * b + pivotY * d );\n\n\t\treturn this;\n\t}\n\n\tpublic function prepend(matrix:Matrix):Matrix {\n\t\tvar tx1 = this.tx;\n\n\t\tif (matrix.a != 1 || matrix.b != 0 || matrix.c != 0 || matrix.d != 1) {\n\t\t\tvar a1 = this.a;\n\t\t\tvar c1 = this.c;\n\t\t\tthis.a = a1 * matrix.a + this.b * matrix.c;\n\t\t\tthis.b = a1 * matrix.b + this.b * matrix.d;\n\t\t\tthis.c = c1 * matrix.a + this.d * matrix.c;\n\t\t\tthis.d = c1 * matrix.b + this.d * matrix.d;\n\t\t}\n\n\t\tthis.tx = tx1 * matrix.a + this.ty * matrix.c + matrix.tx;\n\t\tthis.ty = tx1 * matrix.b + this.ty * matrix.d + matrix.ty;\n\n\t\treturn this;\n\t}\n\n\tpublic function identity():Matrix {\n\t\tthis.a = 1;\n\t\tthis.b = 0;\n\t\tthis.c = 0;\n\t\tthis.d = 1;\n\t\tthis.tx = 0;\n\t\tthis.ty = 0;\n\n\t\treturn this;\n\t}\n\n\tpublic function invert():Matrix {\n\t\tvar a1 = this.a;\n\t\tvar b1 = this.b;\n\t\tvar c1 = this.c;\n\t\tvar d1 = this.d;\n\t\tvar tx1 = this.tx;\n\t\tvar n = a1 * d1 - b1 * c1;\n\n\t\tthis.a = d1 / n;\n\t\tthis.b = -b1 / n;\n\t\tthis.c = -c1 / n;\n\t\tthis.d = a1 / n;\n\t\tthis.tx = (c1 * this.ty - d1 * tx1) / n;\n\t\tthis.ty = -(a1 * this.ty - b1 * tx1) / n;\n\n\t\treturn this;\n\t}\n\n\tpublic function clone():Matrix {\n\t\tvar matrix = new Matrix();\n\t\tmatrix.a = this.a;\n\t\tmatrix.b = this.b;\n\t\tmatrix.c = this.c;\n\t\tmatrix.d = this.d;\n\t\tmatrix.tx = this.tx;\n\t\tmatrix.ty = this.ty;\n\n\t\treturn matrix;\n\t}\n\n\tpublic function copy(matrix:Matrix):Matrix {\n\t\tmatrix.a = this.a;\n\t\tmatrix.b = this.b;\n\t\tmatrix.c = this.c;\n\t\tmatrix.d = this.d;\n\t\tmatrix.tx = this.tx;\n\t\tmatrix.ty = this.ty;\n\n\t\treturn matrix;\n\t}\n}","package fluid.core.math;\n\nclass Point {\n\n\tpublic var x:Float;\n\tpublic var y:Float;\n\n\tpublic function new(?x:Float = 0, ?y:Float = 0) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\n\tpublic function clone():Point {\n\t\treturn new Point(this.x, this.y);\n\t}\n\n\tpublic function copy(p:Point) {\n\t\tthis.set(p.x, p.y);\n\t}\n\n\tpublic function equals(p:Point):Bool {\n\t\treturn (p.x == this.x) && (p.y == this.y);\n\t}\n\n\tpublic function set(?x:Float = 0, ?y:Float):Void {\n\t\tthis.x = x;\n\t\tthis.y = (y != null) ? y : this.x;\n\t}\n}","package fluid.core.math.shapes;\n\nclass Circle {\n\n\tpublic var x:Int;\n\tpublic var y:Int;\n\tpublic var radius:Int;\n\tpublic var type:Int;\n\n\tpublic function new(?x:Int = 0, ?y:Int = 0, ?radius:Int = 0):Void {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.radius = radius;\n\t\tthis.type = Fluid.SHAPES.CIRC;\n\t}\n\n\tpublic function clone():Circle {\n\t\treturn new Circle(this.x, this.y, this.radius);\n\t}\n\n\tpublic function contains(x:Int, y:Int):Bool {\n\t\tif (this.radius <= 0) return false;\n\n\t\tvar dx = (this.x - x);\n\t\tvar dy = (this.y - y);\n\t\tvar r2 = this.radius * this.radius;\n\n\t\tdx *= dx;\n\t\tdy *= dy;\n\n\t\treturn (dx + dy <= r2);\n\t}\n\n\tpublic function getBounds():Rectangle {\n\t\treturn new Rectangle(this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);\n\t}\n}","package fluid.core.math.shapes;\n\nclass Ellipse {\n\n\tpublic var x:Int;\n\tpublic var y:Int;\n\tpublic var width:Int;\n\tpublic var height:Int;\n\tpublic var type:Int;\n\n\tpublic function new(?x:Int = 0, ?y:Int = 0, ?width:Int = 0, ?height:Int = 0):Void {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.type = Fluid.SHAPES.ELIP;\n\t}\n\n\tpublic function clone():Ellipse {\n\t\treturn new Ellipse(this.x, this.y, this.width, this.height);\n\t}\n\n\tpublic function contains(x:Float, y:Float):Bool {\n\t\tif (this.width <= 0 || this.height <= 0) return false;\n\n\t\tvar normx = ((x - this.x) / this.width);\n\t\tvar normy = ((y - this.y) / this.height);\n\n\t\tnormx *= normx;\n\t\tnormy *= normy;\n\n\t\treturn (normx + normy <= 1);\n\t}\n\n\tpublic function getBounds():Rectangle {\n\t\treturn new Rectangle(this.x - this.width, this.y - this.height, this.width, this.height);\n\t}\n}","package fluid.core.math.shapes;\n\nclass Polygon {\n\n\tpublic var points:Array<Float>;\n\tpublic var type:Int;\n\n\tvar _points:Array<Point>;\n\n\tpublic function new(points:Array<Point>):Void {\n\t\t_points = points;\n\t\tvar p = [];\n\t\tfor (i in 0... points.length) {\n\t\t\tp.push(points[i].x);\n\t\t\tp.push(points[i].y);\n\t\t}\n\t\tthis.points = p;\n\t\tthis.type = Fluid.SHAPES.POLY;\n\t}\n\n\tpublic function clone():Polygon {\n\t\treturn new Polygon(this._points);\n\t}\n\n\tpublic function contains(x:Float, y:Float):Bool {\n\t\tvar inside = false;\n\n\t\tvar length = Std.int(this.points.length / 2);\n\t\tvar j = length - 1;\n\t\tfor (i in 0 ... length) {\n\t\t\tvar xi = this.points[i * 2];\n\t\t\tvar yi = this.points[i * 2 + 1];\n\t\t\tvar xj = this.points[j * 2];\n\t\t\tvar yj = this.points[j * 2 + 1];\n\t\t\tvar intersect = ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n\t\t\tif (intersect) inside = !inside;\n\t\t\tj = i;\n\t\t}\n\n\t\treturn inside;\n\t}\n}","package fluid.core.math.shapes;\n\nclass Rectangle {\n\n\tpublic static var EMPTY = new Rectangle(0, 0, 0, 0);\n\n\tpublic var x:Float;\n\tpublic var y:Float;\n\tpublic var width:Float;\n\tpublic var height:Float;\n\tpublic var type:Int;\n\n\tpublic function new(?x:Float = 0, ?y:Float = 0, ?width:Float = 0, ?height:Float = 0):Void {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.type = Fluid.SHAPES.RECT;\n\t}\n\n\tpublic function clone():Rectangle {\n\t\treturn new Rectangle(this.x, this.y, this.width, this.height);\n\t}\n\n\tpublic function contains(x:Float, y:Float):Bool {\n\t\tif (this.width <= 0 || this.height <= 0) return false;\n\t\treturn (x >= this.x && x < this.x + this.width) && (y >= this.y && y < this.y + this.height);\n\t}\n}","package fluid.core.renderers.webgl.managers;\n\nimport js.html.webgl.RenderingContext;\nimport fluid.core.renderers.webgl.WebGLRenderer;\n\nclass WebGLManager {\n\n\tpublic var renderer:WebGLRenderer;\n\n\tpublic function new(renderer:WebGLRenderer) {\n\t\tthis.renderer = renderer;\n\t\tthis.renderer.context.add(_onContextChange);\n\t}\n\n\tfunction _onContextChange(gl:RenderingContext):Void {}\n\n\tpublic function destroy():Void {\n\t\tthis.renderer.context.remove(_onContextChange);\n\t\tthis.renderer = null;\n\t}\n}","package fluid.core.renderers.webgl.managers;\n\nclass BlendModeManager extends WebGLManager {\n\n\tpublic var currentBlendMode:Int;\n\n\tpublic function new(renderer:WebGLRenderer) {\n\t\tsuper(renderer);\n\t\tthis.currentBlendMode = 99999;\n\t}\n\n\tpublic function setBlendMode(blendMode:Int):Bool {\n\t\tif (this.currentBlendMode == blendMode) return false;\n\n\t\tthis.currentBlendMode = blendMode;\n\n\t\tvar mode = this.renderer.blendModes[this.currentBlendMode];\n\t\tthis.renderer.gl.blendFunc(mode[0], mode[1]);\n\n\t\treturn true;\n\t}\n}","package fluid.core.renderers.webgl.managers;\n\nimport fluid.core.sprites.Sprite;\nimport fluid.core.math.Matrix;\nimport fluid.core.renderers.webgl.utils.RenderTarget;\nimport fluid.core.renderers.webgl.utils.Quad;\nimport js.html.webgl.RenderingContext;\nimport fluid.core.math.shapes.Rectangle;\n\nclass FilterManager extends WebGLManager {\n\n\tpublic var filterStack:Array<Dynamic>;\n\tpublic var texturePool:Array<Dynamic>;\n\n\tvar textureSize:Rectangle;\n\tvar currentFrame:Rectangle;\n\tvar quad:Quad;\n\n\tpublic function new(renderer:WebGLRenderer) {\n\t\tsuper(renderer);\n\n\t\tthis.filterStack = [];\n\t\tthis.filterStack.push({\n\t\t\trenderTarget:renderer.currentRenderTarget,\n\t\t\tfilter:[],\n\t\t\tbounds:null\n\t\t});\n\n\t\tthis.texturePool = [];\n\t\tthis.textureSize = new Rectangle(0, 0, renderer.width, renderer.height);\n\t\tthis.currentFrame = null;\n\t}\n\n\toverride function _onContextChange(gl:RenderingContext) {\n\t\tthis.texturePool = [];\n\t\tvar gl = this.renderer.gl;\n\t\tthis.quad = new Quad(this.renderer.gl);\n\t}\n\n\tpublic function setFilterStack(filterStack:Dynamic):Void {\n\t\tthis.filterStack = filterStack;\n\t}\n\n\tpublic function pushFilter(target:Dynamic, filters:Dynamic):Void {\n\t\tuntyped __js__(\"\n\t\t\tvar bounds = target.filterArea ? target.filterArea.clone() : target.getBounds();\n\n\t\t\t//bounds = bounds.clone();\n\n\t\t\t// round off the rectangle to get a nice smoooooooth filter :)\n\t\t\tbounds.x = bounds.x | 0;\n\t\t\tbounds.y = bounds.y | 0;\n\t\t\tbounds.width = bounds.width | 0;\n\t\t\tbounds.height = bounds.height | 0;\n\n\n\t\t\t// padding!\n\t\t\tvar padding = filters[0].padding | 0;\n\t\t\tbounds.x -= padding;\n\t\t\tbounds.y -= padding;\n\t\t\tbounds.width += padding * 2;\n\t\t\tbounds.height += padding * 2;\n\n\n\t\t\tif(this.renderer.currentRenderTarget.transform)\n\t\t\t{\n\t\t\t\t//TODO this will break if the renderTexture transform is anything other than a translation.\n\t\t\t\t//Will need to take the full matrix transform into acount..\n\t\t\t\tvar transform = this.renderer.currentRenderTarget.transform;\n\n\t\t\t\tbounds.x += transform.tx;\n\t\t\t\tbounds.y += transform.ty;\n\n\t\t\t\tthis.capFilterArea( bounds );\n\n\t\t\t\tbounds.x -= transform.tx;\n\t\t\t\tbounds.y -= transform.ty;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t this.capFilterArea( bounds );\n\t\t\t}\n\n\t\t\tif(bounds.width > 0 && bounds.height > 0)\n\t\t\t{\n\t\t\t\tthis.currentFrame = bounds;\n\n\t\t\t\tvar texture = this.getRenderTarget();\n\n\t\t\t\tthis.renderer.setRenderTarget(texture);\n\n\t\t\t\t// clear the texture..\n\t\t\t\ttexture.clear();\n\n\t\t\t\t// TODO get rid of object creation!\n\t\t\t\tthis.filterStack.push({\n\t\t\t\t\trenderTarget: texture,\n\t\t\t\t\tfilter: filters\n\t\t\t\t});\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// push somthing on to the stack that is empty\n\t\t\t\tthis.filterStack.push({\n\t\t\t\t\trenderTarget: null,\n\t\t\t\t\tfilter: filters\n\t\t\t\t});\n\t\t\t}\n\t\t\");\n\t}\n\n\tpublic function popFilter():Dynamic {\n\t\tuntyped __js__(\"\n\t\t\tvar filterData = this.filterStack.pop();\n\t\t\tvar previousFilterData = this.filterStack[this.filterStack.length-1];\n\n\t\t\tvar input = filterData.renderTarget;\n\n\t\t\t// if the renderTarget is null then we don't apply the filter as its offscreen\n\t\t\tif(!filterData.renderTarget)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar output = previousFilterData.renderTarget;\n\n\t\t\t// use program\n\t\t\tvar gl = this.renderer.gl;\n\n\n\t\t\tthis.currentFrame = input.frame;\n\n\t\t\tthis.quad.map(this.textureSize, input.frame);\n\n\n\t\t\t// TODO.. this probably only needs to be done once!\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.quad.vertexBuffer);\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.quad.indexBuffer);\n\n\t\t\tvar filters = filterData.filter;\n\n\t\t\t// assuming all filters follow the correct format??\n\t\t\tgl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aVertexPosition, 2, gl.FLOAT, false, 0, 0);\n\t\t\tgl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aTextureCoord, 2, gl.FLOAT, false, 0, 2 * 4 * 4);\n\t\t\tgl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aColor, 4, gl.FLOAT, false, 0, 4 * 4 * 4);\n\n\t\t\t// restore the normal blendmode!\n\t\t\tthis.renderer.blendModeManager.setBlendMode(CONST.BLEND_MODES.NORMAL);\n\n\t\t\tif (filters.length === 1)\n\t\t\t{\n\t\t\t\t// TODO (cengler) - There has to be a better way then setting this each time?\n\t\t\t\tif (filters[0].uniforms.dimensions)\n\t\t\t\t{\n\t\t\t\t\tfilters[0].uniforms.dimensions.value[0] = this.renderer.width;\n\t\t\t\t\tfilters[0].uniforms.dimensions.value[1] = this.renderer.height;\n\t\t\t\t\tfilters[0].uniforms.dimensions.value[2] = this.quad.vertices[0];\n\t\t\t\t\tfilters[0].uniforms.dimensions.value[3] = this.quad.vertices[5];\n\t\t\t\t}\n\n\t\t\t\tfilters[0].applyFilter( this.renderer, input, output );\n\t\t\t\tthis.returnRenderTarget( input );\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar flipTexture = input;\n\t\t\t\tvar flopTexture = this.getRenderTarget(true);\n\n\t\t\t\tfor (var i = 0; i < filters.length-1; i++)\n\t\t\t\t{\n\t\t\t\t\tvar filter = filters[i];\n\n\t\t\t\t\t// TODO (cengler) - There has to be a better way then setting this each time?\n\t\t\t\t\tif (filter.uniforms.dimensions)\n\t\t\t\t\t{\n\t\t\t\t\t\tfilter.uniforms.dimensions.value[0] = this.renderer.width;\n\t\t\t\t\t\tfilter.uniforms.dimensions.value[1] = this.renderer.height;\n\t\t\t\t\t\tfilter.uniforms.dimensions.value[2] = this.quad.vertices[0];\n\t\t\t\t\t\tfilter.uniforms.dimensions.value[3] = this.quad.vertices[5];\n\t\t\t\t\t}\n\n\t\t\t\t\tfilter.applyFilter( this.renderer, flipTexture, flopTexture );\n\n\t\t\t\t\tvar temp = flipTexture;\n\t\t\t\t\tflipTexture = flopTexture;\n\t\t\t\t\tflopTexture = temp;\n\t\t\t\t}\n\n\t\t\t\tfilters[filters.length-1].applyFilter( this.renderer, flipTexture, output );\n\n\t\t\t\tthis.returnRenderTarget( flipTexture );\n\t\t\t\tthis.returnRenderTarget( flopTexture );\n\t\t\t}\n\n\t\t\treturn filterData.filter;\n\t\t\");\n\t\treturn null;\n\t}\n\n\tpublic function getRenderTarget(?clear:Bool = false):Dynamic {\n\t\tvar renderTarget = this.texturePool.pop();\n\t\tif (renderTarget == null) renderTarget =  new RenderTarget(this.renderer.gl, cast this.textureSize.width, cast this.textureSize.height, Fluid.SCALE_MODES.LINEAR, this.renderer.resolution * Fluid.FILTER_RESOLUTION);\n\t\trenderTarget.frame = this.currentFrame;\n\t\tif (clear) renderTarget.clear(true);\n\t\treturn renderTarget;\n\t}\n\n\tpublic function returnRenderTarget(renderTarget:Dynamic):Void {\n\t\tthis.texturePool.push(renderTarget);\n\t}\n\n\tpublic function applyFilter(shader:Dynamic, inputTarget:Dynamic, outputTarget:Dynamic, ?clear:Bool = false):Void {\n\t\tvar gl = this.renderer.gl;\n\n\t\tthis.renderer.setRenderTarget(outputTarget);\n\n\t\tif (clear) outputTarget.clear();\n\n\t\t// set the shader\n\t\tthis.renderer.shaderManager.setShader(shader);\n\n\t\tshader.uniforms.projectionMatrix.value = this.renderer.currentRenderTarget.projectionMatrix.toArray(true, null);\n\n\t\tshader.syncUniforms();\n\n\t\tgl.activeTexture(RenderingContext.TEXTURE0);\n\t\tgl.bindTexture(RenderingContext.TEXTURE_2D, inputTarget.texture);\n\n\t\tgl.drawElements(RenderingContext.TRIANGLES, 6, RenderingContext.UNSIGNED_SHORT, 0);\n\t\tthis.renderer.drawCount++;\n\t}\n\n\tpublic function calculateMappedMatrix(filterArea:Rectangle, sprite:Sprite, outputMatrix:Matrix):Matrix {\n\t\tvar worldTransform = sprite.worldTransform.copy(Matrix.TEMP_MATRIX),\n\t\ttexture = sprite._texture.baseTexture;\n\n\t\tvar mappedMatrix = outputMatrix.identity();\n\n\t\t// scale..\n\t\tvar ratio = this.textureSize.height / this.textureSize.width;\n\n\t\tmappedMatrix.translate(filterArea.x / this.textureSize.width, filterArea.y / this.textureSize.height);\n\n\t\tmappedMatrix.scale(1, ratio);\n\n\t\tvar translateScaleX = (this.textureSize.width / texture.width);\n\t\tvar translateScaleY = (this.textureSize.height / texture.height);\n\n\t\tworldTransform.tx /= texture.width * translateScaleX;\n\t\tworldTransform.ty /= texture.width * translateScaleX;\n\n\t\tworldTransform.invert();\n\n\t\tmappedMatrix.prepend(worldTransform);\n\n\t\t// apply inverse scale..\n\t\tmappedMatrix.scale(1, 1 / ratio);\n\n\t\tmappedMatrix.scale(translateScaleX, translateScaleY);\n\n\t\tmappedMatrix.translate(sprite.anchor.x, sprite.anchor.y);\n\n\t\treturn mappedMatrix;\n\t}\n\n\tpublic function capFilterArea(filterArea:Rectangle):Void {\n\t\tif (filterArea.x < 0) {\n\t\t\tfilterArea.width += filterArea.x;\n\t\t\tfilterArea.x = 0;\n\t\t}\n\n\t\tif (filterArea.y < 0) {\n\t\t\tfilterArea.height += filterArea.y;\n\t\t\tfilterArea.y = 0;\n\t\t}\n\n\t\tif (filterArea.x + filterArea.width > this.textureSize.width) {\n\t\t\tfilterArea.width = this.textureSize.width - filterArea.x;\n\t\t}\n\n\t\tif (filterArea.y + filterArea.height > this.textureSize.height) {\n\t\t\tfilterArea.height = this.textureSize.height - filterArea.y;\n\t\t}\n\t}\n\n\tpublic function resize(width:Int, height:Int):Void {\n\t\tthis.textureSize.width = width;\n\t\tthis.textureSize.height = height;\n\t\tfor (i in 0 ... this.texturePool.length) this.texturePool[i].resize( width, height );\n\t}\n\n\toverride public function destroy() {\n\t\tthis.quad.destroy();\n\n\t\tsuper.destroy();\n\n\t\tthis.filterStack = null;\n\t\t//this.offsetY = 0;\n\n\t\tfor (i in 0 ... this.texturePool.length) this.texturePool[i].destroy();\n\t\tthis.texturePool = null;\n\t}\n}","package fluid.core.renderers.webgl.managers;\n\nimport fluid.core.renderers.webgl.filters.AbstractFilter;\nimport fluid.core.renderers.webgl.utils.StencilMaskStack;\n\nclass MaskManager extends WebGLManager {\n\n\tpublic var stencilStack:Array<StencilMaskStack>;\n\tpublic var reverse:Bool;\n\tpublic var count:Int;\n\tpublic var alphaMaskPool:Array<Dynamic>;\n\n\tpublic function new(renderer:WebGLRenderer) {\n\t\tsuper(renderer);\n\t\tthis.stencilStack = [];\n\t\tthis.reverse = true;\n\t\tthis.count = 0;\n\t\tthis.alphaMaskPool = [];\n\t}\n\n\tpublic function pushMask(target:Dynamic, maskData:Dynamic):Void {\n\t\tif (maskData.texture != null) this.pushSpriteMask(target, maskData);\n\t\telse this.pushStencilMask(target, maskData);\n\t}\n\n\tpublic function popMask(target:Dynamic, maskData:Dynamic):Void {\n\t\tif (maskData.texture != null) this.popSpriteMask();\n\t\telse this.popStencilMask(target, maskData);\n\t}\n\n\tpublic function pushSpriteMask(target:Dynamic, maskData:Dynamic):Void {\n\t\tvar alphaMaskFilter = this.alphaMaskPool.pop();\n\t\tif (alphaMaskFilter != null) alphaMaskFilter = [new AbstractFilter(maskData)];\n\t\talphaMaskFilter[0].maskSprite = maskData;\n\t\tthis.renderer.filterManager.pushFilter(target, alphaMaskFilter);\n\t}\n\n\tpublic function popSpriteMask():Void {\n\t\tvar filters = this.renderer.filterManager.popFilter();\n\t\tthis.alphaMaskPool.push(filters);\n\t}\n\n\tpublic function pushStencilMask(target:Dynamic, maskData:Dynamic):Void {\n\t\tthis.renderer.stencilManager.pushMask(maskData);\n\t}\n\n\tpublic function popStencilMask(target:Dynamic, maskData:Dynamic):Void {\n\t\tthis.renderer.stencilManager.popMask(maskData);\n\t}\n}","package fluid.core.renderers.webgl.managers;\n\nimport fluid.core.renderers.webgl.shaders.ComplexPrimitiveShader;\nimport fluid.core.renderers.webgl.shaders.PrimitiveShader;\nimport fluid.core.utils.PluginTarget;\nimport fluid.core.renderers.webgl.shaders.TextureShader;\nimport js.html.webgl.RenderingContext;\n\nusing fluid.core.utils.PluginTarget;\n\nclass ShaderManager extends WebGLManager {\n\n\tpublic var maxAttibs:Int;\n\tpublic var attribState:Array<Dynamic>;\n\tpublic var tempAttribState:Array<Dynamic>;\n\tpublic var stack:Array<Dynamic>;\n\n\tvar _currentId:Int;\n\tvar currentShader:Dynamic;\n\n\tpublic var defaultShader:TextureShader;\n\tpublic var primitiveShader:PrimitiveShader;\n\tpublic var complexPrimitiveShader:ComplexPrimitiveShader;\n\n\tpublic function new(renderer:WebGLRenderer) {\n\t\tsuper(renderer);\n\t\tthis.maxAttibs = 10;\n\t\tthis.attribState = [];\n\t\tthis.tempAttribState = [];\n\n\t\tfor (i in 0 ... this.maxAttibs) this.attribState[i] = false;\n\n\t\tthis.stack = [];\n\t\tthis._currentId = -1;\n\t\tthis.currentShader = null;\n\t}\n\n\toverride function _onContextChange(gl:RenderingContext) {\n\t\tthis.maxAttibs = gl.getParameter(RenderingContext.MAX_VERTEX_ATTRIBS);\n\t\tthis.attribState = [];\n\n\t\tfor (i in 0 ... this.maxAttibs) this.attribState[i] = false;\n\n\t\tthis.defaultShader = new TextureShader(this);\n\t\tthis.primitiveShader = new PrimitiveShader(this);\n\t\tthis.complexPrimitiveShader = new ComplexPrimitiveShader(this);\n\t}\n\n\tpublic function setAttribs(attribs:Array<Dynamic>) {\n\t\tvar i;\n\t\tfor (i in 0 ... this.tempAttribState.length) this.tempAttribState[i] = false;\n\t\tfor (a in attribs) this.tempAttribState[attribs[a]] = true;\n\n\t\tvar gl = this.renderer.gl;\n\n\t\tfor (i in 0 ... this.attribState.length) {\n\t\t\tif (this.attribState[i] != this.tempAttribState[i]) {\n\t\t\t\tthis.attribState[i] = this.tempAttribState[i];\n\t\t\t\tif (this.attribState[i]) gl.enableVertexAttribArray(i);\n\t\t\t\telse gl.disableVertexAttribArray(i);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic function setShader(shader:Dynamic):Bool {\n\t\tif (this._currentId == shader.uid) return false;\n\t\tthis._currentId = shader.uid;\n\t\tthis.currentShader = shader;\n\t\tthis.renderer.gl.useProgram(shader.program);\n\t\tthis.setAttribs(shader.attributes);\n\t\treturn true;\n\t}\n\n\toverride public function destroy() {\n\t\tthis.primitiveShader.destroy();\n\t\tthis.complexPrimitiveShader.destroy();\n\t\tsuper.destroy();\n\t\tthis.attribState = null;\n\t\tthis.tempAttribState = null;\n\t}\n}","package fluid.core.renderers.webgl.managers;\n\nimport fluid.core.utils.Utils;\nimport js.html.webgl.RenderingContext;\nimport fluid.core.graphics.Graphics;\nimport fluid.core.renderers.webgl.utils.StencilMaskStack;\n\nclass StencilManager extends WebGLManager {\n\n\tpublic var stencilMaskStack:StencilMaskStack;\n\n\tpublic function new(renderer:WebGLRenderer) {\n\t\tsuper(renderer);\n\t\tthis.stencilMaskStack = null;\n\t}\n\n\tpublic function setMaskStack(stencilMaskStack:StencilMaskStack) {\n\t\tthis.stencilMaskStack = stencilMaskStack;\n\t\tvar gl = this.renderer.gl;\n\n\t\tif (stencilMaskStack.stencilStack.length == 0) gl.disable(RenderingContext.STENCIL_TEST);\n\t\telse gl.enable(RenderingContext.STENCIL_TEST);\n\t}\n\n\tpublic function pushStencil(graphics:Graphics, webGLData:Dynamic) {\n\t\tthis.renderer.currentRenderTarget.attachStencilBuffer();\n\n\t\tvar gl = this.renderer.gl,\n\t\tsms = this.stencilMaskStack;\n\n\t\tthis.bindGraphics(graphics, webGLData);\n\n\t\tif (sms.stencilStack.length == 0) {\n\t\t\tgl.enable(RenderingContext.STENCIL_TEST);\n\t\t\tgl.clear(RenderingContext.STENCIL_BUFFER_BIT);\n\t\t\tsms.reverse = true;\n\t\t\tsms.count = 0;\n\t\t}\n\n\t\tsms.stencilStack.push(webGLData);\n\n\t\tvar level = sms.count;\n\n\t\tgl.colorMask(false, false, false, false);\n\n\t\tgl.stencilFunc(RenderingContext.ALWAYS, 0, 0xFF);\n\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.INVERT);\n\n\t\t// draw the triangle strip!\n\n\t\tif (webGLData.mode == 1) {\n\t\t\tgl.drawElements(RenderingContext.TRIANGLE_FAN, Std.int(webGLData.indices.length - 4), RenderingContext.UNSIGNED_SHORT, 0);\n\n\t\t\tif (sms.reverse) {\n\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, 0xFF - level, 0xFF);\n\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.DECR);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, level, 0xFF);\n\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.INCR);\n\t\t\t}\n\n\t\t\t// draw a quad to increment..\n\t\t\tgl.drawElements(RenderingContext.TRIANGLE_FAN, 4, RenderingContext.UNSIGNED_SHORT, Std.int((webGLData.indices.length - 4 ) * 2));\n\n\t\t\tif (sms.reverse) {\n\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, 0xFF - (level + 1), 0xFF);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, level + 1, 0xFF);\n\t\t\t}\n\n\t\t\tsms.reverse = !sms.reverse;\n\t\t}\n\t\telse {\n\t\t\tif (!sms.reverse) {\n\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, 0xFF - level, 0xFF);\n\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.DECR);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, level, 0xFF);\n\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.INCR);\n\t\t\t}\n\n\t\t\tgl.drawElements(RenderingContext.TRIANGLE_STRIP, webGLData.indices.length, RenderingContext.UNSIGNED_SHORT, 0);\n\n\t\t\tif (!sms.reverse) {\n\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, 0xFF - (level + 1), 0xFF);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, level + 1, 0xFF);\n\t\t\t}\n\t\t}\n\n\t\tgl.colorMask(true, true, true, true);\n\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.KEEP);\n\n\t\tsms.count++;\n\t}\n\n\tpublic function bindGraphics(graphics:Graphics, webGLData:Dynamic) {\n\t\tvar gl = this.renderer.gl;\n\n\t\tvar shader:Dynamic;\n\n\t\tif (webGLData.mode == 1) {\n\t\t\tshader = this.renderer.shaderManager.complexPrimitiveShader;\n\n\t\t\tthis.renderer.shaderManager.setShader(shader);\n\n\t\t\tgl.uniformMatrix3fv(shader.uniforms.translationMatrix._location, false, graphics.worldTransform.toArray(true, null));\n\t\t\tgl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location, false, this.renderer.currentRenderTarget.projectionMatrix.toArray(true, null));\n\n\t\t\tgl.uniform3fv(shader.uniforms.tint._location, Utils.hex2rgb(graphics.tint));\n\t\t\tgl.uniform3fv(shader.uniforms.color._location, webGLData.color);\n\n\t\t\tgl.uniform1f(shader.uniforms.alpha._location, graphics.worldAlpha);\n\n\t\t\tgl.bindBuffer(RenderingContext.ARRAY_BUFFER, webGLData.buffer);\n\n\t\t\tgl.vertexAttribPointer(shader.attributes.aVertexPosition, 2, RenderingContext.FLOAT, false, 4 * 2, 0);\n\n\t\t\t// now do the rest..\n\t\t\t// set the index buffer!\n\t\t\tgl.bindBuffer(RenderingContext.ELEMENT_ARRAY_BUFFER, webGLData.indexBuffer);\n\t\t}\n\t\telse {\n\t\t\t//this.renderer.shaderManager.activatePrimitiveShader();\n\t\t\tshader = this.renderer.shaderManager.primitiveShader;\n\n\t\t\tthis.renderer.shaderManager.setShader(shader);\n\n\t\t\tgl.uniformMatrix3fv(shader.uniforms.translationMatrix._location, false, graphics.worldTransform.toArray(true, null));\n\t\t\tgl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location, false, this.renderer.currentRenderTarget.projectionMatrix.toArray(true, null));\n\n\t\t\tgl.uniform3fv(shader.uniforms.tint._location, Utils.hex2rgb(graphics.tint));\n\n\t\t\tgl.uniform1f(shader.uniforms.alpha._location, graphics.worldAlpha);\n\n\t\t\tgl.bindBuffer(RenderingContext.ARRAY_BUFFER, webGLData.buffer);\n\n\t\t\tgl.vertexAttribPointer(shader.attributes.aVertexPosition, 2, RenderingContext.FLOAT, false, 4 * 6, 0);\n\t\t\tgl.vertexAttribPointer(shader.attributes.aColor, 4, RenderingContext.FLOAT, false, 4 * 6, 2 * 4);\n\n\t\t\t// set the index buffer!\n\t\t\tgl.bindBuffer(RenderingContext.ELEMENT_ARRAY_BUFFER, webGLData.indexBuffer);\n\t\t}\n\t}\n\n\tpublic function popStencil(graphics:Graphics, webGLData:Dynamic) {\n\t\tvar gl = this.renderer.gl,\n\t\tsms = this.stencilMaskStack;\n\t\tsms.stencilStack.pop();\n\t\tsms.count--;\n\n\t\tif (sms.stencilStack.length == 0) gl.disable(RenderingContext.STENCIL_TEST);\n\t\telse {\n\t\t\tvar level = sms.count;\n\t\t\tthis.bindGraphics(graphics, webGLData);\n\t\t\tgl.colorMask(false, false, false, false);\n\n\t\t\tif (webGLData.mode == 1) {\n\t\t\t\tsms.reverse = !sms.reverse;\n\n\t\t\t\tif (sms.reverse) {\n\t\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, 0xFF - (level + 1), 0xFF);\n\t\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.INCR);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, level + 1, 0xFF);\n\t\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.DECR);\n\t\t\t\t}\n\n\t\t\t\t// draw a quad to increment..\n\t\t\t\tgl.drawElements(RenderingContext.TRIANGLE_FAN, 4, RenderingContext.UNSIGNED_SHORT, Std.int((webGLData.indices.length - 4 ) * 2));\n\n\t\t\t\tgl.stencilFunc(RenderingContext.ALWAYS, 0, 0xFF);\n\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.INVERT);\n\n\t\t\t\t// draw the triangle strip!\n\t\t\t\tgl.drawElements(RenderingContext.TRIANGLE_FAN, Std.int(webGLData.indices.length - 4), RenderingContext.UNSIGNED_SHORT, 0);\n\n\t\t\t\tthis.renderer.drawCount += 2;\n\n\t\t\t\tif (!sms.reverse) gl.stencilFunc(RenderingContext.EQUAL, 0xFF - (level), 0xFF);\n\t\t\t\telse gl.stencilFunc(RenderingContext.EQUAL, level, 0xFF);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!sms.reverse) {\n\t\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, 0xFF - (level + 1), 0xFF);\n\t\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.INCR);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, level + 1, 0xFF);\n\t\t\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.DECR);\n\t\t\t\t}\n\n\t\t\t\tgl.drawElements(RenderingContext.TRIANGLE_STRIP, webGLData.indices.length, RenderingContext.UNSIGNED_SHORT, 0);\n\n\t\t\t\tthis.renderer.drawCount++;\n\n\t\t\t\tif (!sms.reverse) {\n\t\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, 0xFF - (level), 0xFF);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tgl.stencilFunc(RenderingContext.EQUAL, level, 0xFF);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tgl.colorMask(true, true, true, true);\n\t\t\tgl.stencilOp(RenderingContext.KEEP, RenderingContext.KEEP, RenderingContext.KEEP);\n\n\t\t}\n\t}\n\n\toverride public function destroy() {\n\t\tsuper.destroy();\n\t\tthis.stencilMaskStack.stencilStack = null;\n\t}\n\n\tpublic function pushMask(maskData:Dynamic) {\n\t\tthis.renderer.setObjectRenderer(this.renderer.plugins.get(\"graphics\"));\n\t\tif (maskData.dirty) {\n\t\t\tthis.renderer.plugins.get(\"graphics\").updateGraphics(maskData, this.renderer.gl);\n\t\t}\n\n\t\tif (!maskData._webGL[Reflect.field(this.renderer.gl, \"id\")].data.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.pushStencil(maskData, maskData._webGL[Reflect.field(this.renderer.gl, \"id\")].data[0]);\n\t}\n\n\tpublic function popMask(maskData:Dynamic) {\n\t\tthis.renderer.setObjectRenderer(this.renderer.plugins.get(\"graphics\"));\n\t\tthis.popStencil(maskData, maskData._webGL[Reflect.field(this.renderer.gl, \"id\")].data[0]);\n\t}\n}","package fluid.core.renderers.webgl.shaders;\n\nimport fluid.core.textures.BaseTexture;\nimport js.Browser;\nimport js.html.webgl.Program;\nimport js.html.webgl.RenderingContext;\nimport fluid.core.utils.Utils;\nimport fluid.core.renderers.webgl.managers.ShaderManager;\nimport js.Error;\n\nclass Shader {\n\n\tpublic var uid:Int;\n\tpublic var gl:RenderingContext;\n\tpublic var shaderManager:ShaderManager;\n\tpublic var program:Program;\n\tpublic var uniforms:Dynamic;\n\tpublic var attributes:Dynamic;\n\tpublic var textureCount:Int;\n\tpublic var vertexSrc:String;\n\tpublic var fragmentSrc:String;\n\n\tpublic function new(shaderManager:ShaderManager, ?vertexSrc:String, ?fragmentSrc:String, ?uniforms:Dynamic, ?attributes:Dynamic) {\n\t\tif (vertexSrc == null && fragmentSrc == null) {\n\t\t\tthrow new Error('Error. Shader requires vertexSrc and fragmentSrc');\n\t\t}\n\n\t\tthis.uid = Utils.uid();\n\t\tthis.gl = shaderManager.renderer.gl;\n\t\tthis.shaderManager = shaderManager;\n\t\tthis.program = null;\n\t\tthis.uniforms = uniforms != null ? uniforms : {};\n\t\tthis.attributes = attributes != null ? attributes : {};\n\t\tthis.textureCount = 1;\n\t\tthis.vertexSrc = vertexSrc;\n\t\tthis.fragmentSrc = fragmentSrc;\n\n\t\tthis.init();\n\t}\n\n\tpublic function init() {\n\t\tuntyped __js__(\"\n\t\t\tthis.compile();\n\t\t\tthis.gl.useProgram(this.program);\n\t\t\tthis.cacheUniformLocations(Object.keys(this.uniforms));\n\t\t\tthis.cacheAttributeLocations(Object.keys(this.attributes));\n\t\t\");\n\t}\n\n\tpublic function cacheUniformLocations(keys) {\n\t\tuntyped __js__(\"\n\t\t\tfor (var i = 0; i < keys.length; ++i) {\n        \t\tthis.uniforms[keys[i]]._location = this.gl.getUniformLocation(this.program, keys[i]);\n    \t\t}\n\t\t\");\n\t}\n\n\tpublic function cacheAttributeLocations(keys) {\n\t\tuntyped __js__(\"\n\t\t\tfor (var i = 0; i < keys.length; ++i) {\n        \t\tthis.attributes[keys[i]] = this.gl.getAttribLocation(this.program, keys[i]);\n    \t\t}\n\t\t\");\n\t}\n\n\tpublic function compile() {\n\t\tuntyped __js__(\"\n\t\t\tvar gl = this.gl;\n\n\t\t\tvar glVertShader = this._glCompile(gl.VERTEX_SHADER, this.vertexSrc);\n\t\t\tvar glFragShader = this._glCompile(gl.FRAGMENT_SHADER, this.fragmentSrc);\n\n\t\t\tvar program = gl.createProgram();\n\n\t\t\tgl.attachShader(program, glVertShader);\n\t\t\tgl.attachShader(program, glFragShader);\n\t\t\tgl.linkProgram(program);\n\n\t\t\t// if linking fails, then log and cleanup\n\t\t\tif (!gl.getProgramParameter(program, gl.LINK_STATUS))\n\t\t\t{\n\t\t\t\tconsole.error('Pixi.js Error: Could not initialize shader.');\n\t\t\t\tconsole.error('gl.VALIDATE_STATUS', gl.getProgramParameter(program, gl.VALIDATE_STATUS));\n\t\t\t\tconsole.error('gl.getError()', gl.getError());\n\n\t\t\t\t// if there is a program info log, log it\n\t\t\t\tif (gl.getProgramInfoLog(program) !== '')\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('Pixi.js Warning: gl.getProgramInfoLog()', gl.getProgramInfoLog(program));\n\t\t\t\t}\n\n\t\t\t\tgl.deleteProgram(program);\n\t\t\t\tprogram = null;\n\t\t\t}\n\n\t\t\t// clean up some shaders\n\t\t\tgl.deleteShader(glVertShader);\n\t\t\tgl.deleteShader(glFragShader);\n\n\t\t\treturn (this.program = program);\n\t\t\");\n\t}\n\n\tpublic function syncUniforms() {\n\t\tuntyped __js__(\"\n\t\t\tthis.textureCount = 1;\n\t\t\tfor (var key in this.uniforms) {\n\t\t\t\tthis.syncUniform(this.uniforms[key]);\n\t\t\t}\n\t\t\");\n\t}\n\n\tpublic function syncUniform(uniform) {\n\t\tuntyped __js__(\"\n\t\t\tvar location = uniform._location,\n\t\t\t\tvalue = uniform.value,\n\t\t\t\tgl = this.gl,\n\t\t\t\ti, il;\n\n\t\t\tswitch (uniform.type)\n\t\t\t{\n\t\t\t\tcase 'b':\n\t\t\t\tcase 'bool':\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tgl.uniform1i(location, value ? 1 : 0);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// single int value\n\t\t\t\tcase 'i':\n\t\t\t\tcase '1i':\n\t\t\t\t\tgl.uniform1i(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// single float value\n\t\t\t\tcase 'f':\n\t\t\t\tcase '1f':\n\t\t\t\t\tgl.uniform1f(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array(2) or JS Arrray\n\t\t\t\tcase '2f':\n\t\t\t\t\tgl.uniform2f(location, value[0], value[1]);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array(3) or JS Arrray\n\t\t\t\tcase '3f':\n\t\t\t\t\tgl.uniform3f(location, value[0], value[1], value[2]);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array(4) or JS Arrray\n\t\t\t\tcase '4f':\n\t\t\t\t\tgl.uniform4f(location, value[0], value[1], value[2], value[3]);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// a 2D Point object\n\t\t\t\tcase 'v2':\n\t\t\t\t\tgl.uniform2f(location, value.x, value.y);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// a 3D Point object\n\t\t\t\tcase 'v3':\n\t\t\t\t\tgl.uniform3f(location, value.x, value.y, value.z);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// a 4D Point object\n\t\t\t\tcase 'v4':\n\t\t\t\t\tgl.uniform4f(location, value.x, value.y, value.z, value.w);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Int32Array or JS Array\n\t\t\t\tcase '1iv':\n\t\t\t\t\tgl.uniform1iv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Int32Array or JS Array\n\t\t\t\tcase '2iv':\n\t\t\t\t\tgl.uniform2iv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Int32Array or JS Array\n\t\t\t\tcase '3iv':\n\t\t\t\t\tgl.uniform3iv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Int32Array or JS Array\n\t\t\t\tcase '4iv':\n\t\t\t\t\tgl.uniform4iv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array or JS Array\n\t\t\t\tcase '1fv':\n\t\t\t\t\tgl.uniform1fv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array or JS Array\n\t\t\t\tcase '2fv':\n\t\t\t\t\tgl.uniform2fv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array or JS Array\n\t\t\t\tcase '3fv':\n\t\t\t\t\tgl.uniform3fv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array or JS Array\n\t\t\t\tcase '4fv':\n\t\t\t\t\tgl.uniform4fv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array or JS Array\n\t\t\t\tcase 'm2':\n\t\t\t\tcase 'mat2':\n\t\t\t\tcase 'Matrix2fv':\n\t\t\t\t\tgl.uniformMatrix2fv(location, uniform.transpose, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array or JS Array\n\t\t\t\tcase 'm3':\n\t\t\t\tcase 'mat3':\n\t\t\t\tcase 'Matrix3fv':\n\n\t\t\t\t\tgl.uniformMatrix3fv(location, uniform.transpose, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Float32Array or JS Array\n\t\t\t\tcase 'm4':\n\t\t\t\tcase 'mat4':\n\t\t\t\tcase 'Matrix4fv':\n\t\t\t\t\tgl.uniformMatrix4fv(location, uniform.transpose, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// a Color Value\n\t\t\t\tcase 'c':\n\t\t\t\t\tif (typeof value === 'number')\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue = utils.hex2rgb(value);\n\t\t\t\t\t}\n\n\t\t\t\t\tgl.uniform3f(location, value[0], value[1], value[2]);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// flat array of integers (JS or typed array)\n\t\t\t\tcase 'iv1':\n\t\t\t\t\tgl.uniform1iv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// flat array of integers with 3 x N size (JS or typed array)\n\t\t\t\tcase 'iv':\n\t\t\t\t\tgl.uniform3iv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// flat array of floats (JS or typed array)\n\t\t\t\tcase 'fv1':\n\t\t\t\t\tgl.uniform1fv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// flat array of floats with 3 x N size (JS or typed array)\n\t\t\t\tcase 'fv':\n\t\t\t\t\tgl.uniform3fv(location, value);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// array of 2D Point objects\n\t\t\t\tcase 'v2v':\n\t\t\t\t\tif (!uniform._array)\n\t\t\t\t\t{\n\t\t\t\t\t\tuniform._array = new Float32Array(2 * value.length);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = 0, il = value.length; i < il; ++i)\n\t\t\t\t\t{\n\t\t\t\t\t\tuniform._array[i * 2]       = value[i].x;\n\t\t\t\t\t\tuniform._array[i * 2 + 1]   = value[i].y;\n\t\t\t\t\t}\n\n\t\t\t\t\tgl.uniform2fv(location, uniform._array);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// array of 3D Point objects\n\t\t\t\tcase 'v3v':\n\t\t\t\t\tif (!uniform._array)\n\t\t\t\t\t{\n\t\t\t\t\t\tuniform._array = new Float32Array(3 * value.length);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = 0, il = value.length; i < il; ++i)\n\t\t\t\t\t{\n\t\t\t\t\t\tuniform._array[i * 3]       = value[i].x;\n\t\t\t\t\t\tuniform._array[i * 3 + 1]   = value[i].y;\n\t\t\t\t\t\tuniform._array[i * 3 + 2]   = value[i].z;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tgl.uniform3fv(location, uniform._array);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// array of 4D Point objects\n\t\t\t\tcase 'v4v':\n\t\t\t\t\tif (!uniform._array)\n\t\t\t\t\t{\n\t\t\t\t\t\tuniform._array = new Float32Array(4 * value.length);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = 0, il = value.length; i < il; ++i)\n\t\t\t\t\t{\n\t\t\t\t\t\tuniform._array[i * 4]       = value[i].x;\n\t\t\t\t\t\tuniform._array[i * 4 + 1]   = value[i].y;\n\t\t\t\t\t\tuniform._array[i * 4 + 2]   = value[i].z;\n\t\t\t\t\t\tuniform._array[i * 4 + 3]   = value[i].w;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tgl.uniform4fv(location, uniform._array);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// PIXI.Texture\n\t\t\t\tcase 't':\n\t\t\t\tcase 'sampler2D':\n\n\t\t\t\t\tif (!uniform.value || !uniform.value.baseTexture.hasLoaded)\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// activate this texture\n\t\t\t\t\tgl.activeTexture(gl['TEXTURE' + this.textureCount]);\n\n\t\t\t\t\tvar texture = uniform.value.baseTexture._glTextures[gl.id];\n\n\t\t\t\t\tif (!texture)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.initSampler2D(uniform);\n\n\t\t\t\t\t\t// set the textur to the newly created one..\n\t\t\t\t\t\ttexture = uniform.value.baseTexture._glTextures[gl.id];\n\t\t\t\t\t}\n\n\t\t\t\t\t// bind the texture\n\t\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\t\t\t\t\t// set uniform to texture index\n\t\t\t\t\tgl.uniform1i(uniform._location, this.textureCount);\n\n\t\t\t\t\t// increment next texture id\n\t\t\t\t\tthis.textureCount++;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn('Pixi.js Shader Warning: Unknown uniform type: ' + uniform.type);\n\t\t\t}\n\t\t\");\n\t}\n\n\tpublic function initSampler2D(uniform:Dynamic) {\n\t\tuntyped __js__(\"\n\t\t\tvar gl = this.gl;\n\n\t\t\tvar texture = uniform.value.baseTexture;\n\n\t\t\tif(!texture.hasLoaded) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (uniform.textureData) {\n\t\t\t\t//TODO move this...\n\t\t\t\tvar data = uniform.textureData;\n\n\t\t\t\ttexture._glTextures[gl.id] = gl.createTexture();\n\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture._glTextures[gl.id]);\n\n\t\t\t\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultipliedAlpha);\n\t\t\t\t// GLTexture = mag linear, min linear_mipmap_linear, wrap repeat + gl.generateMipmap(gl.TEXTURE_2D);\n\t\t\t\t// GLTextureLinear = mag/min linear, wrap clamp\n\t\t\t\t// GLTextureNearestRepeat = mag/min NEAREST, wrap repeat\n\t\t\t\t// GLTextureNearest = mag/min nearest, wrap clamp\n\t\t\t\t// AudioTexture = whatever + luminance + width 512, height 2, border 0\n\t\t\t\t// KeyTexture = whatever + luminance + width 256, height 2, border 0\n\n\t\t\t\t//  magFilter can be: gl.LINEAR, gl.LINEAR_MIPMAP_LINEAR or gl.NEAREST\n\t\t\t\t//  wrapS/T can be: gl.CLAMP_TO_EDGE or gl.REPEAT\n\n\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, data.luminance ? gl.LUMINANCE : gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.source);\n\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, data.magFilter ? data.magFilter : gl.LINEAR );\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, data.wrapS ? data.wrapS : gl.CLAMP_TO_EDGE );\n\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, data.wrapS ? data.wrapS : gl.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, data.wrapT ? data.wrapT : gl.CLAMP_TO_EDGE);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.shaderManager.renderer.updateTexture(texture);\n\t\t\t}\n\t\t\");\n\t}\n\n\tpublic function destroy() {\n\t\tthis.gl.deleteProgram(this.program);\n\t\tthis.gl = null;\n\t\tthis.uniforms = null;\n\t\tthis.attributes = null;\n\t\tthis.vertexSrc = null;\n\t\tthis.fragmentSrc = null;\n\t}\n\n\tfunction _glCompile(t:Int, src:String) {\n\t\tvar shader = this.gl.createShader(t);\n\t\tthis.gl.shaderSource(shader, src);\n\t\tthis.gl.compileShader(shader);\n\n\t\tif (!this.gl.getShaderParameter(shader, RenderingContext.COMPILE_STATUS)) {\n\t\t\tBrowser.console.log(this.gl.getShaderInfoLog(shader));\n\t\t\treturn null;\n\t\t}\n\n\t\treturn shader;\n\t}\n}","package fluid.core.renderers.webgl.shaders;\n\nimport js.html.Float32Array;\nimport fluid.core.renderers.webgl.managers.ShaderManager;\n\nclass ComplexPrimitiveShader extends Shader {\n\n\tpublic function new(shaderManager:ShaderManager) {\n\t\tsuper(shaderManager,\n\t\t[\n\t\t\t'attribute vec2 aVertexPosition;',\n\n\t\t\t'uniform mat3 translationMatrix;',\n\t\t\t'uniform mat3 projectionMatrix;',\n\n\t\t\t'uniform vec3 tint;',\n\t\t\t'uniform float alpha;',\n\t\t\t'uniform vec3 color;',\n\n\t\t\t'varying vec4 vColor;',\n\n\t\t\t'void main(void){',\n\t\t\t'   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);',\n\t\t\t'   vColor = vec4(color * alpha * tint, alpha);',//\" * vec4(tint * alpha, alpha);',\n\t\t\t'}'\n\t\t].join('\\n'),\n\t\t\t// fragment shader\n\t\t[\n\t\t\t'precision mediump float;',\n\n\t\t\t'varying vec4 vColor;',\n\n\t\t\t'void main(void){',\n\t\t\t'   gl_FragColor = vColor;',\n\t\t\t'}'\n\t\t].join('\\n'),\n\t\t\t// custom uniforms\n\t\t{\n\t\t\ttint:   { type: '3f', value: [0, 0, 0] },\n\t\t\talpha:  { type: '1f', value: 0 },\n\t\t\tcolor:  { type: '3f', value: [0,0,0] },\n\t\t\ttranslationMatrix: { type: 'mat3', value: new Float32Array(9) },\n\t\t\tprojectionMatrix: { type: 'mat3', value: new Float32Array(9) }\n\t\t},\n\t\t\t// attributes\n\t\t{\n\t\t\taVertexPosition:0\n\t\t});\n\t}\n}","package fluid.core.renderers.webgl.shaders;\n\nimport js.html.Float32Array;\nimport fluid.core.renderers.webgl.managers.ShaderManager;\n\nclass PrimitiveShader extends Shader {\n\n\tpublic function new(shaderManager:ShaderManager) {\n\t\tsuper(shaderManager, [\n\t\t\t'attribute vec2 aVertexPosition;',\n\t\t\t'attribute vec4 aColor;',\n\n\t\t\t'uniform mat3 translationMatrix;',\n\t\t\t'uniform mat3 projectionMatrix;',\n\n\t\t\t'uniform float alpha;',\n\t\t\t'uniform float flipY;',\n\t\t\t'uniform vec3 tint;',\n\n\t\t\t'varying vec4 vColor;',\n\n\t\t\t'void main(void){',\n\t\t\t'   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);',\n\t\t\t'   vColor = aColor * vec4(tint * alpha, alpha);',\n\t\t\t'}'\n\t\t].join('\\n'),\n\n\t\t[\n\t\t\t'precision mediump float;',\n\n\t\t\t'varying vec4 vColor;',\n\n\t\t\t'void main(void){',\n\t\t\t'   gl_FragColor = vColor;',\n\t\t\t'}'\n\t\t].join('\\n'),\n\n\t\t{\n\t\t\ttint: { type: '3f', value: [0, 0, 0] },\n\t\t\talpha: { type: '1f', value: 0 },\n\t\t\ttranslationMatrix: { type: 'mat3', value: new Float32Array(9) },\n\t\t\tprojectionMatrix: { type: 'mat3', value: new Float32Array(9) }\n\t\t},\n\n\t\t{\n\t\t\taVertexPosition:0,\n\t\t\taColor:0\n\t\t});\n\t}\n}","package fluid.core.renderers.webgl.shaders;\n\nimport js.html.Float32Array;\nimport fluid.core.renderers.webgl.managers.ShaderManager;\n\nclass TextureShader extends Shader {\n\n\tstatic var defaultVertexSrc:String = [\n\t\t'precision lowp float;',\n\t\t'attribute vec2 aVertexPosition;',\n\t\t'attribute vec2 aTextureCoord;',\n\t\t'attribute vec4 aColor;',\n\n\t\t'uniform mat3 projectionMatrix;',\n\n\t\t'varying vec2 vTextureCoord;',\n\t\t'varying vec4 vColor;',\n\n\t\t'void main(void){',\n\t\t'   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);',\n\t\t'   vTextureCoord = aTextureCoord;',\n\t\t'   vColor = vec4(aColor.rgb * aColor.a, aColor.a);',\n\t\t'}'\n\t].join('\\n');\n\n\tstatic var defaultFragmentSrc:String = [\n\t\t'precision lowp float;',\n\n\t\t'varying vec2 vTextureCoord;',\n\t\t'varying vec4 vColor;',\n\n\t\t'uniform sampler2D uSampler;',\n\n\t\t'void main(void){',\n\t\t'   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;',\n\t\t'}'\n\t].join('\\n');\n\n\tpublic function new(shaderManager:ShaderManager, ?vertexSrc:String, ?fragmentSrc:String, ?customUniforms:Dynamic, ?customAttributes:Dynamic) {\n\t\tvar uniforms = {\n\t\t\t\tuSampler:           { type: 'sampler2D', value: 0 },\n\t\t\t\tprojectionMatrix:   { type: 'mat3', value: new Float32Array([1, 0, 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t 0, 1, 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t 0, 0, 1]) }\n\t\t};\n\n\t\tvar attributes = {\n\t\t\taVertexPosition:    0,\n\t\t\taTextureCoord:      0,\n\t\t\taColor:             0\n\t\t};\n\n\n\t\tuntyped __js__(\"\n\t\t\tif (customUniforms) {\n\t\t\t\tfor (var u in customUniforms) {\n\t\t\t\t\tuniforms[u] = customUniforms[u];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (customAttributes) {\n\t\t\t\tfor (var a in customAttributes) {\n\t\t\t\t\tattributes[a] = customAttributes[a];\n\t\t\t\t}\n\t\t\t}\n\t\t\");\n\n\t\tvertexSrc = vertexSrc != null ? vertexSrc : TextureShader.defaultVertexSrc;\n\t\tfragmentSrc = fragmentSrc != null ? fragmentSrc : TextureShader.defaultFragmentSrc;\n\n\t\tsuper(shaderManager, vertexSrc, fragmentSrc, uniforms, attributes);\n\t}\n}","package fluid.core.renderers.webgl.utils;\n\nimport fluid.core.renderers.webgl.managers.WebGLManager;\n\nclass ObjectRenderer extends WebGLManager {\n\n\tpublic function new(renderer:WebGLRenderer) {\n\t\tsuper(renderer);\n\t}\n\n\tpublic function start() {}\n\tpublic function stop() {}\n\tpublic function flush() {}\n\tpublic function render(object) {}\n}","package fluid.core.renderers.webgl.utils;\n\nimport js.html.Uint16Array;\nimport js.html.Float32Array;\nimport fluid.core.math.Matrix;\nimport js.html.ArrayBuffer;\nimport fluid.core.math.shapes.Rectangle;\nimport js.html.webgl.Buffer;\nimport js.html.webgl.RenderingContext;\n\nclass Quad {\n\n\tpublic var gl:RenderingContext;\n\tpublic var vertices:Float32Array;\n\tpublic var uvs:Float32Array;\n\tpublic var colors:Float32Array;\n\tpublic var indices:Uint16Array;\n\n\tpublic var vertexBuffer:Buffer;\n\tpublic var indexBuffer:Buffer;\n\n\tpublic function new(gl:RenderingContext) {\n\n\t\tthis.gl = gl;\n\n\t\tthis.vertices = new Float32Array([\n\t\t\t0,0,\n\t\t\t200,0,\n\t\t\t200,200,\n\t\t\t0,200\n\t\t]);\n\n\t\tthis.uvs = new Float32Array([\n\t\t\t0,0,\n\t\t\t1,0,\n\t\t\t1,1,\n\t\t\t0,1\n\t\t]);\n\n\t\tthis.colors = new Float32Array([\n\t\t\t1,1,1,1,\n\t\t\t1,1,1,1,\n\t\t\t1,1,1,1,\n\t\t\t1,1,1,1\n\t\t]);\n\n\t\tthis.indices = new Uint16Array([\n\t\t\t0, 1, 2, 0, 3, 2\n\t\t]);\n\n\t\tthis.vertexBuffer = gl.createBuffer();\n\t\tthis.indexBuffer = gl.createBuffer();\n\n\t\tgl.bindBuffer(RenderingContext.ARRAY_BUFFER, this.vertexBuffer);\n\t\tgl.bufferData(RenderingContext.ARRAY_BUFFER, (8 + 8 + 16) * 4, RenderingContext.DYNAMIC_DRAW);\n\n\t\tgl.bindBuffer(RenderingContext.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\t\tgl.bufferData(RenderingContext.ELEMENT_ARRAY_BUFFER, this.indices, RenderingContext.STATIC_DRAW);\n\n\t\tthis.upload();\n\t}\n\n\tpublic function map(rect:Rectangle, rect2:Rectangle) {\n\t\tvar x:Float = 0;\n\t\tvar y:Float = 0;\n\n\t\tthis.uvs[0] = x;\n\t\tthis.uvs[1] = y;\n\n\t\tthis.uvs[2] = x + rect2.width / rect.width;\n\t\tthis.uvs[3] = y;\n\n\t\tthis.uvs[4] = x + rect2.width / rect.width;\n\t\tthis.uvs[5] = y + rect2.height / rect.height;\n\n\t\tthis.uvs[6] = x;\n\t\tthis.uvs[7] = y + rect2.height / rect.height;\n\n\t\tx = rect2.x;\n\t\ty = rect2.y;\n\n\t\tthis.vertices[0] = x;\n\t\tthis.vertices[1] = y;\n\n\t\tthis.vertices[2] = x + rect2.width;\n\t\tthis.vertices[3] = y;\n\n\t\tthis.vertices[4] = x + rect2.width;\n\t\tthis.vertices[5] = y + rect2.height;\n\n\t\tthis.vertices[6] = x;\n\t\tthis.vertices[7] = y + rect2.height;\n\n\t\tthis.upload();\n\t}\n\n\tpublic function upload() {\n\t\tvar gl = this.gl;\n\t\tgl.bindBuffer(RenderingContext.ARRAY_BUFFER, this.vertexBuffer);\n\t\tgl.bufferSubData(RenderingContext.ARRAY_BUFFER, 0, this.vertices);\n\t\tgl.bufferSubData(RenderingContext.ARRAY_BUFFER, 8 * 4, this.uvs);\n\t\tgl.bufferSubData(RenderingContext.ARRAY_BUFFER, (8 + 8) * 4, this.colors);\n\t}\n\n\tpublic function destroy() {\n\t\tvar gl = this.gl;\n\t\tgl.deleteBuffer(this.vertexBuffer);\n\t\tgl.deleteBuffer(this.indexBuffer);\n\t}\n}","package fluid.core.renderers.webgl.utils;\n\nimport fluid.core.utils.Utils;\nimport js.html.webgl.Framebuffer;\nimport js.html.webgl.Renderbuffer;\nimport fluid.core.math.Matrix;\nimport fluid.core.math.shapes.Rectangle;\nimport fluid.core.textures.Texture;\nimport js.html.webgl.RenderingContext;\n\nclass RenderTarget {\n\n\tpublic var gl:RenderingContext;\n\tpublic var frameBuffer:Framebuffer;\n\tpublic var texture:Texture;\n\tpublic var size:Rectangle;\n\tpublic var resolution:Float;\n\tpublic var projectionMatrix:Matrix;\n\tpublic var transform:Matrix;\n\tpublic var frame:Rectangle;\n\tpublic var stencilBuffer:Renderbuffer;\n\tpublic var stencilMaskStack:StencilMaskStack;\n\tpublic var filterStack:Dynamic;\n\tpublic var scaleMode:Int;\n\tpublic var root:Bool;\n\n\tpublic function new(gl:RenderingContext, width:Int, height:Int, ?scaleMode:Int = 0, ?resolution:Float = 1, ?root:Bool = false) {\n\t\tthis.gl = gl;\n\t\tthis.frameBuffer = null;\n\t\tthis.texture = null;\n\t\tthis.size = new Rectangle(0, 0, 1, 1);\n\t\tthis.resolution = resolution;\n\t\tthis.projectionMatrix = new Matrix();\n\t\tthis.transform = null;\n\t\tthis.frame = null;\n\t\tthis.stencilBuffer = null;\n\t\tthis.stencilMaskStack = new StencilMaskStack();\n\n\t\tthis.filterStack = [\n\t\t\t{\n\t\t\t\trenderTarget:this,\n\t\t\t\tfilter:[],\n\t\t\t\tbounds:this.size\n\t\t\t}\n\t\t];\n\n\t\tthis.scaleMode = scaleMode;\n\t\tthis.root = root;\n\n\t\tif (!this.root) {\n\t\t\tthis.frameBuffer = gl.createFramebuffer();\n\t\t\tvar texture = gl.createTexture();\n\t\t\tthis.texture = cast texture;\n\n\t\t\tgl.bindTexture(RenderingContext.TEXTURE_2D, texture);\n\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_MAG_FILTER, scaleMode == Fluid.SCALE_MODES.LINEAR ? RenderingContext.LINEAR : RenderingContext.NEAREST);\n\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_MIN_FILTER, scaleMode == Fluid.SCALE_MODES.LINEAR ? RenderingContext.LINEAR : RenderingContext.NEAREST);\n\n\t\t\tvar isPowerOfTwo = Utils.isPowerOfTwo(width, height);\n\n\t\t\tif (!isPowerOfTwo) {\n\t\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_WRAP_S, RenderingContext.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_WRAP_T, RenderingContext.CLAMP_TO_EDGE);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_WRAP_S, RenderingContext.REPEAT);\n\t\t\t\tgl.texParameteri(RenderingContext.TEXTURE_2D, RenderingContext.TEXTURE_WRAP_T, RenderingContext.REPEAT);\n\t\t\t}\n\n\t\t\tgl.bindFramebuffer(RenderingContext.FRAMEBUFFER, this.frameBuffer);\n\t\t\tgl.framebufferTexture2D(RenderingContext.FRAMEBUFFER, RenderingContext.COLOR_ATTACHMENT0, RenderingContext.TEXTURE_2D, texture, 0);\n\t\t}\n\n\t\tthis.resize(width, height);\n\t}\n\n\tpublic function clear(?bind:Bool = false) {\n\t\tvar gl = this.gl;\n\t\tif (bind) gl.bindFramebuffer(RenderingContext.FRAMEBUFFER, this.frameBuffer);\n\t\tgl.clearColor(0, 0, 0, 0);\n\t\tgl.clear(RenderingContext.COLOR_BUFFER_BIT);\n\t}\n\n\tpublic function attachStencilBuffer() {\n\t\tif (this.stencilBuffer != null) return;\n\n\t\tif (!this.root) {\n\t\t\tvar gl = this.gl;\n\t\t\tthis.stencilBuffer = gl.createRenderbuffer();\n\t\t\tgl.bindRenderbuffer(RenderingContext.RENDERBUFFER, this.stencilBuffer);\n\t\t\tgl.framebufferRenderbuffer(RenderingContext.FRAMEBUFFER, RenderingContext.DEPTH_STENCIL_ATTACHMENT, RenderingContext.RENDERBUFFER, this.stencilBuffer);\n\t\t\tgl.renderbufferStorage(RenderingContext.RENDERBUFFER, RenderingContext.DEPTH_STENCIL, Std.int(this.size.width * this.resolution), Std.int(this.size.height * this.resolution));\n\t\t}\n\t}\n\n\tpublic function activate() {\n\t\tvar gl = this.gl;\n\t\tgl.bindFramebuffer(RenderingContext.FRAMEBUFFER, this.frameBuffer);\n\t\tvar projectionFrame:Rectangle = this.frame != null ? this.frame : this.size;\n\t\tthis.calculateProjection(projectionFrame);\n\t\tif (this.transform != null) this.projectionMatrix.append(this.transform);\n\t\tgl.viewport(0, 0, Std.int(projectionFrame.width * this.resolution), Std.int(projectionFrame.height * this.resolution));\n\t}\n\n\tpublic function calculateProjection(projectionFrame:Rectangle) {\n\t\tvar pm = this.projectionMatrix;\n\t\tpm.identity();\n\n\t\tif (!this.root) {\n\t\t\tpm.a = 1 / projectionFrame.width * 2;\n\t\t\tpm.d = 1 / projectionFrame.height * 2;\n\n\t\t\tpm.tx = -1 - projectionFrame.x * pm.a;\n\t\t\tpm.ty = -1 - projectionFrame.y * pm.d;\n\t\t}\n\t\telse {\n\t\t\tpm.a = 1 / projectionFrame.width * 2;\n\t\t\tpm.d = -1 / projectionFrame.height * 2;\n\n\t\t\tpm.tx = -1 - projectionFrame.x * pm.a;\n\t\t\tpm.ty = 1 - projectionFrame.y * pm.d;\n\t\t}\n\t}\n\n\tpublic function resize(?width:Int = 0, ?height:Int = 0) {\n\t\tif (this.size.width == width && this.size.height == height) return;\n\t\tthis.size.width = width;\n\t\tthis.size.height = height;\n\n\t\tif (!this.root) {\n\t\t\tvar gl = this.gl;\n\t\t\tgl.bindTexture(RenderingContext.TEXTURE_2D, cast this.texture);\n\t\t\tgl.texImage2D(RenderingContext.TEXTURE_2D, 0, RenderingContext.RGBA, Std.int(width * this.resolution), Std.int(height * this.resolution), 0, RenderingContext.RGBA, RenderingContext.UNSIGNED_BYTE, null);\n\n\t\t\tif (this.stencilBuffer != null) {\n\t\t\t\tgl.bindRenderbuffer(RenderingContext.RENDERBUFFER, this.stencilBuffer);\n\t\t\t\tgl.renderbufferStorage(RenderingContext.RENDERBUFFER, RenderingContext.DEPTH_STENCIL, Std.int(width * this.resolution), Std.int(height * this.resolution));\n\t\t\t}\n\t\t}\n\t\tvar projectionFrame = this.frame != null ? this.frame : this.size;\n\t\tthis.calculateProjection(projectionFrame);\n\t}\n\n\tpublic function destroy() {\n\t\tvar gl = this.gl;\n\t\tgl.deleteRenderbuffer(this.stencilBuffer);\n\t\tgl.deleteFramebuffer(this.frameBuffer);\n\t\tgl.deleteTexture(cast this.texture);\n\n\t\tthis.frameBuffer = null;\n\t\tthis.texture = null;\n\t}\n}","package fluid.core.renderers.webgl.utils;\n\nclass StencilMaskStack {\n\n\tpublic var stencilStack:Array<Dynamic>;\n\tpublic var reverse:Bool;\n\tpublic var count:Int;\n\n\tpublic function new() {\n\t\tthis.stencilStack = [];\n\t\tthis.reverse = true;\n\t\tthis.count = 0;\n\t}\n}","package fluid.core.sprites;\n\nimport fluid.core.math.shapes.Rectangle;\nimport fluid.core.math.Matrix;\nimport fluid.core.renderers.webgl.WebGLRenderer;\nimport js.Error;\nimport fluid.core.utils.Utils;\nimport fluid.core.math.Point;\nimport fluid.core.textures.Texture;\nimport fluid.core.display.Container;\n\nclass Sprite extends Container {\n\n\tpublic var _texture:Texture;\n\n\tpublic var anchor:Point;\n\tpublic var texture(default, set):Texture;\n\tpublic var tint:Int;\n\tpublic var blendMode:Int;\n\tpublic var shader:Dynamic;\n\n\tpublic var tileScale:Dynamic;\n\n\tvar cachedTint:Int;\n\tvar tempPoint = new Point();\n\n\tpublic function new(texture:Texture) {\n\t\tsuper();\n\n\t\tthis.anchor = new Point();\n\t\tthis._texture = null;\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\t\tthis.tint = 0xFFFFFF;\n\t\tthis.blendMode = Fluid.BLEND_MODES.NORMAL;\n\t\tthis.shader = null;\n\t\tthis.cachedTint = 0xFFFFFF;\n\t\tthis.texture = (texture != null) ? texture : Texture.EMPTY;\n\t}\n\n\toverride function set_width(value:Float):Float {\n\t\tvar sign = Utils.sign(this.scale.x);\n\t\tif (sign == null) sign = 1;\n\t\tthis.scale.x = sign * value / this.texture.frame.width;\n\t\treturn this._width = value;\n\t}\n\n\toverride function get_width():Float {\n\t\treturn Math.abs(this.scale.x) * this.texture.frame.width;\n\t}\n\n\toverride function set_height(value:Float):Float {\n\t\tvar sign = Utils.sign(this.scale.y);\n\t\tif (sign == null) sign = 1;\n\t\tthis.scale.y = sign * value / this.texture.frame.height;\n\t\treturn this._height = value;\n\t}\n\n\toverride function get_height():Float {\n\t\treturn Math.abs(this.scale.y) * this.texture.frame.height;\n\t}\n\n\tfunction set_texture(value:Texture):Texture {\n\t\tif (this.texture == value) return value;\n\t\tthis.cachedTint = 0xFFFFFF;\n\t\tthis.texture = value;\n\n\t\tif (value != null) {\n\t\t\tif (value.baseTexture.hasLoaded) this._onTextureUpdate(value);\n\t\t\telse value.updated.addOnce(this._onTextureUpdate);\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tfunction _onTextureUpdate(txt:Texture) {\n\t\tthis.scale.x = Utils.sign(this.scale.x) * this._width / this.texture.frame.width;\n\t\tthis.scale.y = Utils.sign(this.scale.y) * this._height / this.texture.frame.height;\n\t}\n\n\toverride public function _renderWebGL(renderer:WebGLRenderer):Void {\n\t\trenderer.setObjectRenderer(renderer.plugins.get(\"sprite\"));\n\t\trenderer.plugins.get(\"sprite\").render(this);\n\t}\n\n\toverride public function getBounds(?matrix:Matrix):Rectangle {\n\t\tif (this._currentBounds == null) {\n\t\t\tvar width = this.texture.frame.width;\n\t\t\tvar height = this.texture.frame.height;\n\n\t\t\tvar w0 = width * (1 - this.anchor.x);\n\t\t\tvar w1 = width * -this.anchor.x;\n\n\t\t\tvar h0 = height * (1 - this.anchor.y);\n\t\t\tvar h1 = height * -this.anchor.y;\n\n\t\t\tvar worldTransform = matrix;\n\t\t\tif (worldTransform == null) worldTransform = this.worldTransform;\n\n\t\t\tvar a = worldTransform.a;\n\t\t\tvar b = worldTransform.b;\n\t\t\tvar c = worldTransform.c;\n\t\t\tvar d = worldTransform.d;\n\t\t\tvar tx = worldTransform.tx;\n\t\t\tvar ty = worldTransform.ty;\n\n\t\t\tvar minX,\n\t\t\tmaxX,\n\t\t\tminY,\n\t\t\tmaxY;\n\n\t\t\tvar x1 = a * w1 + c * h1 + tx;\n\t\t\tvar y1 = d * h1 + b * w1 + ty;\n\n\t\t\tvar x2 = a * w0 + c * h1 + tx;\n\t\t\tvar y2 = d * h1 + b * w0 + ty;\n\n\t\t\tvar x3 = a * w0 + c * h0 + tx;\n\t\t\tvar y3 = d * h0 + b * w0 + ty;\n\n\t\t\tvar x4 = a * w1 + c * h0 + tx;\n\t\t\tvar y4 = d * h0 + b * w1 + ty;\n\n\t\t\tminX = x1;\n\t\t\tminX = x2 < minX ? x2 : minX;\n\t\t\tminX = x3 < minX ? x3 : minX;\n\t\t\tminX = x4 < minX ? x4 : minX;\n\n\t\t\tminY = y1;\n\t\t\tminY = y2 < minY ? y2 : minY;\n\t\t\tminY = y3 < minY ? y3 : minY;\n\t\t\tminY = y4 < minY ? y4 : minY;\n\n\t\t\tmaxX = x1;\n\t\t\tmaxX = x2 > maxX ? x2 : maxX;\n\t\t\tmaxX = x3 > maxX ? x3 : maxX;\n\t\t\tmaxX = x4 > maxX ? x4 : maxX;\n\n\t\t\tmaxY = y1;\n\t\t\tmaxY = y2 > maxY ? y2 : maxY;\n\t\t\tmaxY = y3 > maxY ? y3 : maxY;\n\t\t\tmaxY = y4 > maxY ? y4 : maxY;\n\n\t\t\tif (this.children.length > 0) {\n\t\t\t\tvar childBounds = this.containerGetBounds();\n\n\t\t\t\tw0 = childBounds.x;\n\t\t\t\tw1 = childBounds.x + childBounds.width;\n\t\t\t\th0 = childBounds.y;\n\t\t\t\th1 = childBounds.y + childBounds.height;\n\n\t\t\t\tminX = (minX < w0) ? minX : w0;\n\t\t\t\tminY = (minY < h0) ? minY : h0;\n\n\t\t\t\tmaxX = (maxX > w1) ? maxX : w1;\n\t\t\t\tmaxY = (maxY > h1) ? maxY : h1;\n\t\t\t}\n\n\t\t\tvar bounds = this._bounds;\n\n\t\t\tbounds.x = minX;\n\t\t\tbounds.width = maxX - minX;\n\n\t\t\tbounds.y = minY;\n\t\t\tbounds.height = maxY - minY;\n\n\t\t\tthis._currentBounds = bounds;\n\t\t}\n\n\t\treturn this._currentBounds;\n\t}\n\n\toverride public function getLocalBounds():Rectangle {\n\t\tthis._bounds.x = -this.texture.frame.width * this.anchor.x;\n\t\tthis._bounds.y = -this.texture.frame.height * this.anchor.y;\n\t\tthis._bounds.width = this.texture.frame.width;\n\t\tthis._bounds.height = this.texture.frame.height;\n\t\treturn this._bounds;\n\t}\n\n\tpublic function containsPoint(point:Point):Bool {\n\t\tthis.worldTransform.applyInverse(point, tempPoint);\n\n\t\tvar width = this.texture.frame.width;\n\t\tvar height = this.texture.frame.height;\n\t\tvar x1 = -width * this.anchor.x;\n\t\tvar y1;\n\n\t\tif (tempPoint.x > x1 && tempPoint.x < x1 + width) {\n\t\t\ty1 = -height * this.anchor.y;\n\t\t\tif (tempPoint.y > y1 && tempPoint.y < y1 + height) return true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\toverride public function destroy(?destroyTexture:Bool = false, ?destroyBaseTexture:Bool = false) {\n\t\tsuper.destroy();\n\t\tthis.anchor = null;\n\t\tif (destroyTexture) this.texture.destroy(destroyBaseTexture);\n\t\tthis.texture = null;\n\t\tthis.shader = null;\n\t}\n\n\tpublic static function fromFrame(frameId:String):Sprite {\n\t\tvar texture = Utils.TextureCache.get(frameId);\n\t\tif (texture == null) throw new Error('The frameId \"' + frameId + '\" does not exist in the texture cache');\n\t\treturn new Sprite(texture);\n\t}\n\n\tpublic static function fromImage(imageId:String, ?crossorigin:Bool, ?scaleMode:Int):Sprite {\n\t\treturn new Sprite(Texture.fromImage(imageId, crossorigin, scaleMode));\n\t}\n}","package fluid.core.sprites.webgl;\n\nimport fluid.core.textures.BaseTexture;\nimport js.html.webgl.RenderingContext;\nimport js.html.webgl.Buffer;\nimport js.html.Float32Array;\nimport js.html.Uint16Array;\nimport js.html.Uint32Array;\nimport js.html.ArrayBuffer;\nimport fluid.core.renderers.webgl.WebGLRenderer;\nimport fluid.core.renderers.webgl.utils.ObjectRenderer;\n\nclass SpriteRenderer extends ObjectRenderer {\n\n\tpublic var vertSize:Float;\n\tpublic var vertByteSize:Float;\n\tpublic var size:Float;\n\tpublic var vertices:ArrayBuffer;\n\tpublic var positions:Float32Array;\n\tpublic var colors:Uint32Array;\n\tpublic var indices:Uint16Array;\n\n\tpublic var currentBatchSize:Int;\n\tpublic var sprites:Array<Sprite>;\n\tpublic var shader:Dynamic;\n\n\tpublic var vertexBuffer:Buffer;\n\tpublic var indexBuffer:Buffer;\n\n\tpublic var currentBlendMode:Int;\n\n\tpublic function new(renderer:WebGLRenderer) {\n\t\tsuper(renderer);\n\n\t\tthis.vertSize = 5;\n\t\tthis.vertByteSize = this.vertSize * 4;\n\t\tthis.size = Fluid.SPRITE_BATCH_SIZE;\n\t\tvar numVerts = Std.int((this.size * 4) * this.vertByteSize);\n\t\tvar numIndices = Std.int(this.size * 6);\n\t\tthis.vertices = new ArrayBuffer(numVerts);\n\t\tthis.positions = new Float32Array(this.vertices);\n\t\tthis.colors = new Uint32Array(this.vertices);\n\t\tthis.indices = new Uint16Array(numIndices);\n\n\t\tvar j = 0;\n\t\tvar i = 0;\n\t\twhile (i < numIndices) {\n\t\t\tthis.indices[i + 0] = j + 0;\n\t\t\tthis.indices[i + 1] = j + 1;\n\t\t\tthis.indices[i + 2] = j + 2;\n\t\t\tthis.indices[i + 3] = j + 0;\n\t\t\tthis.indices[i + 4] = j + 2;\n\t\t\tthis.indices[i + 5] = j + 3;\n\t\t\ti += 6;\n\t\t\tj += 4;\n\t\t}\n\n\t\tthis.currentBatchSize = 0;\n\t\tthis.sprites = [];\n\t\tthis.shader = null;\n\t}\n\n\toverride function _onContextChange(gl:RenderingContext) {\n\t\tvar gl = this.renderer.gl;\n\n\t\tthis.shader = this.renderer.shaderManager.defaultShader;\n\n\t\tthis.vertexBuffer = gl.createBuffer();\n\t\tthis.indexBuffer = gl.createBuffer();\n\n\t\tgl.bindBuffer(RenderingContext.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\t\tgl.bufferData(RenderingContext.ELEMENT_ARRAY_BUFFER, this.indices, RenderingContext.STATIC_DRAW);\n\n\t\tgl.bindBuffer(RenderingContext.ARRAY_BUFFER, this.vertexBuffer);\n\t\tgl.bufferData(RenderingContext.ARRAY_BUFFER, this.vertices, RenderingContext.DYNAMIC_DRAW);\n\n\t\tthis.currentBlendMode = 99999;\n\t}\n\n\toverride public function render(sprite:Sprite) {\n\t\tvar texture = sprite.texture;\n\t\tif (this.currentBatchSize >= this.size) this.flush();\n\n\t\tvar uvs = texture._uvs;\n\t\tif (uvs == null) return;\n\n\t\tvar aX = sprite.anchor.x;\n\t\tvar aY = sprite.anchor.y;\n\n\t\tvar w0, w1, h0, h1;\n\n\t\tif (texture.trim != null && sprite.tileScale == null) {\n\t\t\tvar trim = texture.trim;\n\n\t\t\tw1 = trim.x - aX * trim.width;\n\t\t\tw0 = w1 + texture.crop.width;\n\n\t\t\th1 = trim.y - aY * trim.height;\n\t\t\th0 = h1 + texture.crop.height;\n\n\t\t}\n\t\telse {\n\t\t\tw0 = (texture.frame.width ) * (1 - aX);\n\t\t\tw1 = (texture.frame.width ) * -aX;\n\n\t\t\th0 = texture.frame.height * (1 - aY);\n\t\t\th1 = texture.frame.height * -aY;\n\t\t}\n\n\t\tvar index:Int = Std.int(this.currentBatchSize * this.vertByteSize);\n\n\t\tvar worldTransform = sprite.worldTransform;\n\n\t\tvar a = worldTransform.a;\n\t\tvar b = worldTransform.b;\n\t\tvar c = worldTransform.c;\n\t\tvar d = worldTransform.d;\n\t\tvar tx = worldTransform.tx;\n\t\tvar ty = worldTransform.ty;\n\n\t\tvar colors = this.colors;\n\t\tvar positions = this.positions;\n\n\t\tif (this.renderer.roundPixels) {\n\t\t\tvar resolution = this.renderer.resolution;\n\t\t\t// xy\n\t\t\t/*positions[index] = (((a * w1 + c * h1 + tx) * resolution) | 0) / resolution;\n\t\t\tpositions[index + 1] = (((d * h1 + b * w1 + ty) * resolution) | 0) / resolution;\n\n\t\t\t// xy\n\t\t\tpositions[index + 5] = (((a * w0 + c * h1 + tx) * resolution) | 0) / resolution;\n\t\t\tpositions[index + 6] = (((d * h1 + b * w0 + ty) * resolution) | 0) / resolution;\n\n\t\t\t// xy\n\t\t\tpositions[index + 10] = (((a * w0 + c * h0 + tx) * resolution) | 0) / resolution;\n\t\t\tpositions[index + 11] = (((d * h0 + b * w0 + ty) * resolution) | 0) / resolution;\n\n\t\t\t// xy\n\t\t\tpositions[index + 15] = (((a * w1 + c * h0 + tx) * resolution) | 0) / resolution;\n\t\t\tpositions[index + 16] = (((d * h0 + b * w1 + ty) * resolution) | 0) / resolution;*/\n\t\t}\n\t\telse {\n\n\t\t\t// xy\n\t\t\tpositions[index] = a * w1 + c * h1 + tx;\n\t\t\tpositions[index + 1] = d * h1 + b * w1 + ty;\n\n\t\t\t// xy\n\t\t\tpositions[index + 5] = a * w0 + c * h1 + tx;\n\t\t\tpositions[index + 6] = d * h1 + b * w0 + ty;\n\n\t\t\t// xy\n\t\t\tpositions[index + 10] = a * w0 + c * h0 + tx;\n\t\t\tpositions[index + 11] = d * h0 + b * w0 + ty;\n\n\t\t\t// xy\n\t\t\tpositions[index + 15] = a * w1 + c * h0 + tx;\n\t\t\tpositions[index + 16] = d * h0 + b * w1 + ty;\n\t\t}\n\n\t\t// uv\n\t\tpositions[index + 2] = uvs.x0;\n\t\tpositions[index + 3] = uvs.y0;\n\n\t\t// uv\n\t\tpositions[index + 7] = uvs.x1;\n\t\tpositions[index + 8] = uvs.y1;\n\n\t\t// uv\n\t\tpositions[index + 12] = uvs.x2;\n\t\tpositions[index + 13] = uvs.y2;\n\n\t\t// uv\n\t\tpositions[index + 17] = uvs.x3;\n\t\tpositions[index + 18] = uvs.y3;\n\n\t\t// color and alpha\n\t\tvar tint = sprite.tint;\n\t\t//colors[index + 4] = colors[index + 9] = colors[index + 14] = colors[index + 19] = (tint >> 16) + (tint & 0xff00) + ((tint & 0xff) << 16) + (sprite.worldAlpha * 255 << 24);\n\n\t\t// increment the batchsize\n\t\tthis.sprites[this.currentBatchSize++] = sprite;\n\t}\n\n\toverride public function flush() {\n\t\tuntyped __js__(\"\n\t\t \tif (this.currentBatchSize === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar gl = this.renderer.gl;\n\t\t\tvar shader;\n\n\t\t\t// upload the verts to the buffer\n\t\t\tif (this.currentBatchSize > ( this.size * 0.5 ) )\n\t\t\t{\n\t\t\t\tgl.bufferSubData(gl.ARRAY_BUFFER, 0, this.vertices);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar view = this.positions.subarray(0, this.currentBatchSize * this.vertByteSize);\n\t\t\t\tgl.bufferSubData(gl.ARRAY_BUFFER, 0, view);\n\t\t\t}\n\n\t\t\tvar nextTexture, nextBlendMode, nextShader;\n\t\t\tvar batchSize = 0;\n\t\t\tvar start = 0;\n\n\t\t\tvar currentBaseTexture = null;\n\t\t\tvar currentBlendMode = this.renderer.blendModeManager.currentBlendMode;\n\t\t\tvar currentShader = null;\n\n\t\t\tvar blendSwap = false;\n\t\t\tvar shaderSwap = false;\n\t\t\tvar sprite;\n\n\t\t\tfor (var i = 0, j = this.currentBatchSize; i < j; i++)\n\t\t\t{\n\n\t\t\t\tsprite = this.sprites[i];\n\n\t\t\t\tnextTexture = sprite.texture.baseTexture;\n\t\t\t\tnextBlendMode = sprite.blendMode;\n\t\t\t\tnextShader = sprite.shader || this.shader;\n\n\t\t\t\tblendSwap = currentBlendMode !== nextBlendMode;\n\t\t\t\tshaderSwap = currentShader !== nextShader; // should I use uidS???\n\n\t\t\t\tif (currentBaseTexture !== nextTexture || blendSwap || shaderSwap)\n\t\t\t\t{\n\t\t\t\t\tthis.renderBatch(currentBaseTexture, batchSize, start);\n\n\t\t\t\t\tstart = i;\n\t\t\t\t\tbatchSize = 0;\n\t\t\t\t\tcurrentBaseTexture = nextTexture;\n\n\t\t\t\t\tif (blendSwap)\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentBlendMode = nextBlendMode;\n\t\t\t\t\t\tthis.renderer.blendModeManager.setBlendMode( currentBlendMode );\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shaderSwap)\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentShader = nextShader;\n\n\n\n\t\t\t\t\t\tshader = currentShader.shaders ? currentShader.shaders[gl.id] : currentShader;\n\n\t\t\t\t\t\tif (!shader)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tshader = currentShader.getShader(this.renderer);\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// set shader function???\n\t\t\t\t\t\tthis.renderer.shaderManager.setShader(shader);\n\n\t\t\t\t\t\t//TODO - i KNOW this can be optimised! Once v3 is stable il look at this next...\n\t\t\t\t\t\tshader.uniforms.projectionMatrix.value = this.renderer.currentRenderTarget.projectionMatrix.toArray(true);\n\t\t\t\t\t\t//Make this a little more dynamic / intelligent!\n\t\t\t\t\t\tshader.syncUniforms();\n\n\t\t\t\t\t\t//TODO investigate some kind of texture state managment??\n\t\t\t\t\t\t// need to make sure this texture is the active one for all the batch swaps..\n\t\t\t\t\t\tgl.activeTexture(gl.TEXTURE0);\n\n\t\t\t\t\t\t// both thease only need to be set if they are changing..\n\t\t\t\t\t\t// set the projection\n\t\t\t\t\t\t//gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location, false, this.renderer.currentRenderTarget.projectionMatrix.toArray(true));\n\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbatchSize++;\n\t\t\t}\n\n\t\t\tthis.renderBatch(currentBaseTexture, batchSize, start);\n\n\t\t\t// then reset the batch!\n\t\t\tthis.currentBatchSize = 0;\n\t\t\");\n\t}\n\n\tpublic function renderBatch(texture:BaseTexture, size:Int, startIndex:Int) {\n\t\tuntyped __js__(\"\n\t\t\tif (size === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar gl = this.renderer.gl;\n\n\t\t\tif (!texture._glTextures[gl.id])\n\t\t\t{\n\t\t\t\tthis.renderer.updateTexture(texture);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// bind the current texture\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture._glTextures[gl.id]);\n\t\t\t}\n\n\t\t\t// now draw those suckas!\n\t\t\tgl.drawElements(gl.TRIANGLES, size * 6, gl.UNSIGNED_SHORT, startIndex * 6 * 2);\n\n\t\t\t// increment the draw count\n\t\t\tthis.renderer.drawCount++;\n\t\t\");\n\t}\n}","package fluid.core.textures;\n\nimport js.html.Image;\nimport msignal.Signal.Signal1;\nimport fluid.core.utils.Utils;\n\nclass BaseTexture {\n\n\tpublic var uid:Int;\n\tpublic var resolution:Float;\n\tpublic var width:Int;\n\tpublic var height:Int;\n\tpublic var realWidth:Int;\n\tpublic var realHeight:Int;\n\tpublic var scaleMode:Int;\n\tpublic var hasLoaded:Bool;\n\tpublic var isLoading:Bool;\n\tpublic var isPowerOfTwo:Bool;\n\tpublic var source:Dynamic;\n\tpublic var premultipliedAlpha:Bool;\n\tpublic var imageUrl:String;\n\tpublic var mipmap:Bool;\n\n\tpublic var _glTextures:Dynamic;\n\n\tpublic var loaded:Signal1<BaseTexture>;\n\tpublic var error:Signal1<BaseTexture>;\n\tpublic var updated:Signal1<BaseTexture>;\n\tpublic var disposed:Signal1<Dynamic>;\n\n\tpublic function new(?source:Dynamic, ?scaleMode:Int = 0, ?resolution:Float = 1) {\n\t\tthis.uid = Utils.uid();\n\t\tthis.resolution = resolution;\n\t\tthis.width = 100;\n\t\tthis.height = 100;\n\t\tthis.realWidth = 100;\n\t\tthis.realHeight = 100;\n\t\tthis.scaleMode = scaleMode;\n\t\tthis.hasLoaded = false;\n\t\tthis.isLoading = false;\n\t\tthis.source = null;\n\t\tthis.premultipliedAlpha = true;\n\t\tthis.imageUrl = null;\n\t\tthis.isPowerOfTwo = false;\n\t\tthis.mipmap = false;\n\t\tthis._glTextures = {};\n\n\t\tloaded = new Signal1(BaseTexture);\n\t\terror = new Signal1(BaseTexture);\n\t\tupdated = new Signal1(BaseTexture);\n\t\tdisposed = new Signal1(BaseTexture);\n\n\t\tif (source != null) this.loadSource(source);\n\t}\n\n\tpublic function update():Void {\n\t\tthis.realWidth = (this.source.naturalWidth != null) ? this.source.naturalWidth : this.source.width;\n\t\tthis.realHeight = (this.source.naturalHeight != null) ? this.source.naturalHeight : this.source.height;\n\n\t\tthis.width = Std.int(this.realWidth / this.resolution);\n\t\tthis.height = Std.int(this.realHeight / this.resolution);\n\n\t\tthis.isPowerOfTwo = Utils.isPowerOfTwo(this.realWidth, this.realHeight);\n\n\t\t//updated.dispatch(this);\n\t}\n\n\tpublic function destroy():Void {\n\t\tif (this.imageUrl != null) {\n\t\t\tUtils.BaseTextureCache.set(this.imageUrl, null);\n\t\t\tUtils.TextureCache.set(this.imageUrl, null);\n\t\t\tthis.imageUrl = null;\n\t\t}\n\t\telse if (this.source && this.source._pixiId) {\n\t\t\tUtils.BaseTextureCache.set(this.source._pixiId, null);\n\t\t}\n\n\t\tthis.source = null;\n\t\tthis.dispose();\n\t}\n\n\tpublic function dispose():Void {\n\t\tdisposed.dispatch(this);\n\t\tthis._glTextures = null;\n\t}\n\n\tpublic function loadSource(source:Dynamic):Void {\n\t\tvar wasLoading = this.isLoading;\n\t\tthis.hasLoaded = false;\n\t\tthis.isLoading = false;\n\n\t\tif (wasLoading && this.source != null) {\n\t\t\tthis.source.onload = null;\n\t\t\tthis.source.onerror = null;\n\t\t}\n\n\t\tthis.source = source;\n\n\t\t// Apply source if loaded. Otherwise setup appropriate loading monitors.\n\t\tif ((this.source.complete != null || this.source.getContext != null) && this.source.width != null && this.source.height != null) {\n\t\t\tthis._sourceLoaded();\n\t\t}\n\t\telse if (source.getContext != null) {\n\t\t\tthis.isLoading = true;\n\t\t\tvar scope = this;\n\n\t\t\tsource.onload = function() {\n\t\t\t\tsource.onload = null;\n\t\t\t\tsource.onerror = null;\n\n\t\t\t\tif (!scope.isLoading) return;\n\n\t\t\t\tscope.isLoading = false;\n\t\t\t\tscope._sourceLoaded();\n\t\t\t\tloaded.dispatch(scope);\n\t\t\t};\n\n\t\t\tsource.onerror = function() {\n\t\t\t\tsource.onload = null;\n\t\t\t\tsource.onerror = null;\n\n\t\t\t\tif (!scope.isLoading) return;\n\n\t\t\t\tscope.isLoading = false;\n\t\t\t\terror.dispatch(scope);\n\t\t\t};\n\n\t\t\tif (source.complete != null && source.src != null) {\n\t\t\t\tthis.isLoading = false;\n\t\t\t\tsource.onload = null;\n\t\t\t\tsource.onerror = null;\n\n\t\t\t\tif (source.width && source.height) {\n\t\t\t\t\tthis._sourceLoaded();\n\t\t\t\t\tif (wasLoading) loaded.dispatch(this);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (wasLoading) error.dispatch(this);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _sourceLoaded() {\n\t\tthis.hasLoaded = true;\n\t\tthis.update();\n\t}\n\n\tpublic function updateSourceImage(newSrc:String) {\n\t\tthis.source.src = newSrc;\n\t\tthis.loadSource(this.source);\n\t}\n\n\tpublic static function fromImage(imageUrl:String, ?crossorigin:Bool, ?scaleMode:Int = 0):BaseTexture {\n\t\tvar baseTexture:BaseTexture = Utils.BaseTextureCache.get(imageUrl);\n\t\tcrossorigin = (crossorigin == null && imageUrl.indexOf('data:') != 0);\n\n\t\tif (baseTexture == null) {\n\t\t\tvar image = new Image();\n\t\t\tif (crossorigin) image.crossOrigin = '';\n\n\t\t\tbaseTexture = new BaseTexture(image, scaleMode);\n\t\t\tbaseTexture.imageUrl = imageUrl;\n\n\t\t\timage.src = imageUrl;\n\n\t\t\tUtils.BaseTextureCache.set(imageUrl, baseTexture);\n\n\t\t\tbaseTexture.resolution = Utils.getResolutionOfUrl(imageUrl);\n\t\t}\n\n\t\treturn baseTexture;\n\t}\n\n\tpublic static function fromCanvas(canvas:Dynamic, ?scaleMode:Int):BaseTexture {\n\t\tif (canvas._pixiId != null) canvas._pixiId = 'canvas_' + Utils.uid();\n\n\t\tvar baseTexture = Utils.BaseTextureCache[canvas._pixiId];\n\t\tif (baseTexture != null) {\n\t\t\tbaseTexture = new BaseTexture(canvas, scaleMode);\n\t\t\tUtils.BaseTextureCache[canvas._pixiId] = baseTexture;\n\t\t}\n\n\t\treturn baseTexture;\n\t}\n}","/*\nCopyright (c) 2012 Massive Interactive\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\npackage msignal;\n\nimport msignal.Slot;\n\n/**\n\tA convenience type describing any kind of signal.\n**/\ntypedef AnySignal = Signal<Dynamic, Dynamic>;\n\n/**\n\tA Signal manages a list of listeners, which are executed when the signal is \n\tdispatched.\n**/\nclass Signal<TSlot:Slot<Dynamic, Dynamic>, TListener>\n{\n\tpublic var valueClasses:Array<Dynamic>;\n\n\t/**\n\t\tThe current number of listeners for the signal.\n\t**/\n\tpublic var numListeners(get_numListeners, null):Int;\n\t\n\tvar slots:SlotList<TSlot, TListener>;\n\tvar priorityBased:Bool;\n\n\tfunction new(?valueClasses:Array<Dynamic>)\n\t{\n\t\tif (valueClasses == null) valueClasses = [];\n\t\tthis.valueClasses = valueClasses;\n\t\tslots = cast SlotList.NIL;\n\t\tpriorityBased = false;\n\t}\n\n\t/**\n\t\tSubscribes a listener for the signal.\n\t\t\n\t\t@param listener A function matching the signature of TListener\n\t\t@return The added listener slot\n\t**/\n\tpublic function add(listener:TListener):TSlot\n\t{\n\t\treturn registerListener(listener);\n\t}\n\n\t/**\n\t\tSubscribes a one-time listener for this signal.\n\t\tThe signal will remove the listener automatically the first time it is called,\n\t\tafter the dispatch to all listeners is complete.\n\t\t\n\t\t@param listener A function matching the signature of TListener\n\t\t@return The added listener slot\n\t**/\n\tpublic function addOnce(listener:TListener):TSlot\n\t{\n\t\treturn registerListener(listener, true);\n\t}\n\n\t/**\n\t\tSubscribes a listener for the signal.\n\t\tAfter you successfully register an event listener,\n\t\tyou cannot change its priority through additional calls to add().\n\t\tTo change a listener's priority, you must first call remove().\n\t\tThen you can register the listener again with the new priority level.\n\t\t\n\t\t@param listener A function matching the signature of TListener\n\t\t@return The added listener slot\n\t**/\n\tpublic function addWithPriority(listener:TListener, ?priority:Int=0):TSlot\n\t{\n\t\treturn registerListener(listener, false, priority);\n\t}\n\n\t/**\n\t\tSubscribes a one-time listener for this signal.\n\t\tThe signal will remove the listener automatically the first time it is \n\t\tcalled, after the dispatch to all listeners is complete.\n\t\t\n\t\t@param listener A function matching the signature of TListener\n\t\t@return The added listener slot\n\t**/\n\tpublic function addOnceWithPriority(listener:TListener, ?priority:Int=0):TSlot\n\t{\n\t\treturn registerListener(listener, true, priority);\n\t}\n\n\t/**\n\t\tUnsubscribes a listener from the signal.\n\t\t\n\t\t@param listener The listener to remove\n\t\t@return The removed listener slot\n\t**/\n\tpublic function remove(listener:TListener):TSlot\n\t{\n\t\tvar slot = slots.find(listener);\n\t\tif (slot == null) return null;\n\t\t\n\t\tslots = slots.filterNot(listener);\n\t\treturn slot;\n\t}\n\n\t/**\n\t\tUnsubscribes all listeners from the signal.\n\t**/\n\tpublic function removeAll():Void\n\t{\n\t\tslots = cast SlotList.NIL;\n\t}\n\n\tfunction registerListener(listener:TListener, once:Bool=false, priority:Int=0):TSlot\n\t{\n\t\tif (registrationPossible(listener, once))\n\t\t{\n\t\t\tvar newSlot = createSlot(listener, once, priority);\n\t\t\t\n\t\t\tif (!priorityBased && priority != 0) priorityBased = true;\n\t\t\tif (!priorityBased && priority == 0) slots = slots.prepend(newSlot);\n\t\t\telse slots = slots.insertWithPriority(newSlot);\n\n\t\t\treturn newSlot;\n\t\t}\n\t\t\n\t\treturn slots.find(listener);\n\t}\n\n\tfunction registrationPossible(listener, once)\n\t{\n\t\tif (!slots.nonEmpty) return true;\n\t\t\n\t\tvar existingSlot = slots.find(listener);\n\t\tif (existingSlot == null) return true;\n\n\t\tif (existingSlot.once != once)\n\t\t{\n\t\t\t// If the listener was previously added, definitely don't add it again.\n\t\t\t// But throw an exception if their once values differ.\n\t\t\tthrow \"You cannot addOnce() then add() the same listener without removing the relationship first.\";\n\t\t}\n\t\t\n\t\treturn false; // Listener was already registered.\n\t}\n\n\t@:IgnoreCover\n\tfunction createSlot(listener:TListener, once:Bool=false, priority:Int=0):TSlot\n\t{\n\t\treturn null;\n\t}\n\n\tfunction get_numListeners()\n\t{\n\t\treturn slots.length;\n\t}\n}\n\n/**\n\tSignal that executes listeners with no arguments.\n**/\nclass Signal0 extends Signal<Slot0, Void -> Void>\n{\n\tpublic function new()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t\tExecutes the signals listeners with no arguements.\n\t**/\n\tpublic function dispatch()\n\t{\n\t\tvar slotsToProcess = slots;\n\t\t\n\t\twhile (slotsToProcess.nonEmpty)\n\t\t{\n\t\t\tslotsToProcess.head.execute();\n\t\t\tslotsToProcess = slotsToProcess.tail;\n\t\t}\n\t}\n\n\toverride function createSlot(listener:Void -> Void, once:Bool=false, priority:Int=0)\n\t{\n\t\treturn new Slot0(this, listener, once, priority);\n\t}\n}\n\n/**\n\tSignal that executes listeners with one arguments.\n**/\nclass Signal1<TValue> extends Signal<Slot1<TValue>, TValue -> Void>\n{\n\tpublic function new(?type:Dynamic=null)\n\t{\n\t\tsuper([type]);\n\t}\n\n\t/**\n\t\tExecutes the signals listeners with one arguement.\n\t**/\n\tpublic function dispatch(value:TValue)\n\t{\n\t\tvar slotsToProcess = slots;\n\t\t\n\t\twhile (slotsToProcess.nonEmpty)\n\t\t{\n\t\t\tslotsToProcess.head.execute(value);\n\t\t\tslotsToProcess = slotsToProcess.tail;\n\t\t}\n\t}\n\n\toverride function createSlot(listener:TValue -> Void, once:Bool=false, priority:Int=0)\n\t{\n\t\treturn new Slot1<TValue>(this, listener, once, priority);\n\t}\n}\n\n/**\n\tSignal that executes listeners with two arguments.\n**/\nclass Signal2<TValue1, TValue2> extends Signal<Slot2<TValue1, TValue2>, TValue1 -> TValue2 -> Void>\n{\n\tpublic function new(?type1:Dynamic=null, ?type2:Dynamic=null)\n\t{\n\t\tsuper([type1, type2]);\n\t}\n\n\t/**\n\t\tExecutes the signals listeners with two arguements.\n\t**/\n\tpublic function dispatch(value1:TValue1, value2:TValue2)\n\t{\n\t\tvar slotsToProcess = slots;\n\t\t\n\t\twhile (slotsToProcess.nonEmpty)\n\t\t{\n\t\t\tslotsToProcess.head.execute(value1, value2);\n\t\t\tslotsToProcess = slotsToProcess.tail;\n\t\t}\n\t}\n\n\toverride function createSlot(listener:TValue1 -> TValue2 -> Void, once:Bool=false, priority:Int=0)\n\t{\n\t\treturn new Slot2<TValue1, TValue2>(this, listener, once, priority);\n\t}\n}\n","/*\nCopyright (c) 2012 Massive Interactive\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\npackage msignal;\n\nclass SlotList<TSlot:Slot<Dynamic, Dynamic>, TListener>\n{\n\t@:IgnoreCover\n\tstatic function __init__() { NIL = new SlotList<Dynamic, Dynamic>(null, null); }\n\t\n\t/**\n\t\tRepresents an empty list. Used as the list terminator.\n\t**/\n\tpublic static var NIL:SlotList<Dynamic, Dynamic>;\n\t\n\tpublic var head:TSlot;\n\tpublic var tail:SlotList<TSlot, TListener>;\n\tpublic var nonEmpty:Bool;\n\t\n\t/**\n\t\tCreates and returns a new SlotList object.\n\n\t\t<p>A user never has to create a SlotList manually. \n\t\tUse the <code>NIL</code> element to represent an empty list. \n\t\t<code>NIL.prepend(value)</code> would create a list containing \n\t\t<code>value</code></p>.\n\n\t\t@param head The first slot in the list.\n\t\t@param tail A list containing all slots except head.\n\t**/\n\tpublic function new(head:TSlot, tail:SlotList<TSlot, TListener>=null)\n\t{\n\t\tnonEmpty = false;\n\t\t\n\t\tif (head == null && tail == null)\n\t\t{\n\t\t\tif (NIL != null)\n\t\t\t{\n\t\t\t\tthrow \"Parameters head and tail are null. Use the NIL element instead.\";\n\t\t\t}\n\t\t\t\n\t\t\t// this is the NIL element as per definition\n\t\t\tnonEmpty = false;\n\t\t}\n\t\telse if (head == null)\n\t\t{\n\t\t\tthrow \"Parameter head cannot be null.\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.head = head;\n\t\t\tthis.tail = (tail == null ? cast NIL : tail);\n\t\t\tnonEmpty = true;\n\t\t}\n\t}\n\t\n\t/**\n\t\tThe number of slots in the list.\n\t**/\n\tpublic var length(get_length, null):Int;\n\tfunction get_length():Int\n\t{\n\t\tif (!nonEmpty) return 0;\n\t\tif (tail == NIL) return 1;\n\t\t\n\t\t// We could cache the length, but it would make methods like filterNot unnecessarily complicated.\n\t\t// Instead we assume that O(n) is okay since the length property is used in rare cases.\n\t\t// We could also cache the length lazy, but that is a waste of another 8b per list node (at least).\n\t\t\n\t\tvar result = 0;\n\t\tvar p = this;\n\t\t\n\t\twhile (p.nonEmpty)\n\t\t{\n\t\t\t++result;\n\t\t\tp = p.tail;\n\t\t}\n\t\t\n\t\treturn result;\n\t}\n\t\n\t/**\n\t\tPrepends a slot to this list.\n\t\t@param\tslot The item to be prepended.\n\t\t@return\tA list consisting of slot followed by all elements of this list.\n\t**/\n\tpublic function prepend(slot:TSlot)\n\t{\n\t\treturn new SlotList<TSlot, TListener>(slot, this);\n\t}\n\t\n\t/**\n\t\tAppends a slot to this list.\n\t\tNote: appending is O(n). Where possible, prepend which is O(1).\n\t\tIn some cases, many list items must be cloned to \n\t\tavoid changing existing lists.\n\t\t@param\tslot The item to be appended.\n\t\t@return\tA list consisting of all elements of this list followed by slot.\n\t**/\n\tpublic function append(slot:TSlot)\n\t{\n\t\tif (slot == null) return this;\n\t\tif (!nonEmpty) return new SlotList<TSlot, TListener>(slot);\n\t\t\n\t\t// Special case: just one slot currently in the list.\n\t\tif (tail == NIL) \n\t\t{\n\t\t\treturn new SlotList<TSlot, TListener>(slot).prepend(head);\n\t\t}\n\t\t\n\t\t// The list already has two or more slots.\n\t\t// We have to build a new list with cloned items because they are immutable.\n\t\tvar wholeClone = new SlotList<TSlot, TListener>(head);\n\t\tvar subClone = wholeClone;\n\t\tvar current = tail;\n\t\t\n\t\twhile (current.nonEmpty)\n\t\t{\n\t\t\tsubClone = subClone.tail = new SlotList<TSlot, TListener>(current.head);\n\t\t\tcurrent = current.tail;\n\t\t}\n\t\t\n\t\t// Append the new slot last.\n\t\tsubClone.tail = new SlotList<TSlot, TListener>(slot);\n\t\treturn wholeClone;\n\t}\t\t\n\t\n\t/**\n\t\tInsert a slot into the list in a position according to its priority.\n\t\tThe higher the priority, the closer the item will be inserted to the \n\t\tlist head.\n\t\t@param slot The item to be inserted.\n\t**/\n\tpublic function insertWithPriority(slot:TSlot)\n\t{\n\t\tif (!nonEmpty) return new SlotList<TSlot, TListener>(slot);\n\t\t\n\t\tvar priority:Int = slot.priority;\n\t\t\n\t\t// Special case: new slot has the highest priority.\n\t\tif (priority >= this.head.priority) return prepend(slot);\n\n\t\tvar wholeClone = new SlotList<TSlot, TListener>(head);\n\t\tvar subClone = wholeClone;\n\t\tvar current = tail;\n\n\t\t// Find a slot with lower priority and go in front of it.\n\t\twhile (current.nonEmpty)\n\t\t{\n\t\t\tif (priority > current.head.priority)\n\t\t\t{\n\t\t\t\tsubClone.tail = current.prepend(slot);\n\t\t\t\treturn wholeClone;\n\t\t\t}\n\t\t\t\n\t\t\tsubClone = subClone.tail = new SlotList<TSlot, TListener>(current.head);\n\t\t\tcurrent = current.tail;\n\t\t}\n\t\t\n\t\t// Slot has lowest priority.\n\t\tsubClone.tail = new SlotList<TSlot, TListener>(slot);\n\t\treturn wholeClone;\n\t}\n\t\n\t/**\n\t\tReturns the slots in this list that do not contain the supplied \n\t\tlistener. Note: assumes the listener is not repeated within the list.\n\t\t@param\tlistener The function to remove.\n\t\t@return A list consisting of all elements of this list that do not \n\t\t\t\thave listener.\n\t**/\n\tpublic function filterNot(listener:TListener)\n\t{\n\t\tif (!nonEmpty || listener == null) return this;\n\t\t\n\t\tif (Reflect.compareMethods(head.listener, listener)) return tail;\n\t\t\n\t\t// The first item wasn't a match so the filtered list will contain it.\n\t\tvar wholeClone = new SlotList<TSlot, TListener>(head);\n\t\tvar subClone = wholeClone;\n\t\tvar current = tail;\n\t\t\n\t\twhile (current.nonEmpty)\n\t\t{\n\t\t\tif (Reflect.compareMethods(current.head.listener, listener))\n\t\t\t{\n\t\t\t\t// Splice out the current head.\n\t\t\t\tsubClone.tail = current.tail;\n\t\t\t\treturn wholeClone;\n\t\t\t}\n\t\t\t\n\t\t\tsubClone = subClone.tail = new SlotList<TSlot, TListener>(current.head);\n\t\t\tcurrent = current.tail;\n\t\t}\n\t\t\n\t\t// The listener was not found so this list is unchanged.\n\t\treturn this;\n\t}\n\t\n\t/**\n\t\tDetermines whether the supplied listener Function is contained \n\t\twithin this list\n\t**/\n\tpublic function contains(listener:TListener):Bool\n\t{\n\t\tif (!nonEmpty) return false;\n\n\t\tvar p = this;\n\t\twhile (p.nonEmpty)\n\t\t{\n\t\t\tif (Reflect.compareMethods(p.head.listener, listener)) return true;\n\t\t\tp = p.tail;\n\t\t}\n\n\t\treturn false;\n\t}\n\t\n\t/**\n\t\tRetrieves the Slot associated with a supplied listener within the SlotList.\n\t\t@param   listener The Function being searched for\n\t\t@return  The ISlot in this list associated with the listener parameter \n\t\t\t\t through the ISlot.listener property. Returns null if no such \n\t\t\t\t ISlot instance exists or the list is empty.  \n\t**/\n\tpublic function find(listener:TListener):TSlot\n\t{\n\t\tif (!nonEmpty) return null;\n\t\t\n\t\tvar p = this;\n\t\twhile (p.nonEmpty)\n\t\t{\n\t\t\tif (Reflect.compareMethods(p.head.listener, listener)) return p.head;\n\t\t\tp = p.tail;\n\t\t}\n\t\t\n\t\treturn null;\n\t}\n}\n","package fluid.core.textures;\n\nimport fluid.core.utils.Utils;\nimport fluid.core.math.Point;\nimport fluid.core.math.shapes.Rectangle;\nimport msignal.Signal.Signal1;\nimport js.html.VideoElement;\nimport js.Error;\n\nclass Texture {\n\n\tpublic static var EMPTY = new Texture(new BaseTexture());\n\n\tpublic var noFrame:Bool;\n\tpublic var baseTexture:BaseTexture;\n\tpublic var trim:Rectangle;\n\tpublic var valid:Bool;\n\tpublic var requiresUpdate:Bool;\n\tpublic var width:Float;\n\tpublic var height:Float;\n\tpublic var crop:Rectangle;\n\tpublic var spritePivot:Point;\n\tpublic var rotate:Bool;\n\tpublic var frame(default, set):Rectangle;\n\n\tpublic var updated:Signal1<Texture>;\n\tpublic var disposed:Signal1<Texture>;\n\tpublic var _uvs:TextureUvs;\n\n\tpublic function new(txt:Dynamic, ?frame:Rectangle, ?crop:Rectangle, ?trim:Rectangle, ?rotate:Bool = false) {\n\t\tthis.noFrame = false;\n\t\tif (frame == null) {\n\t\t\tthis.noFrame = true;\n\t\t\tframe = new Rectangle(0, 0, 1, 1);\n\t\t}\n\n\t\tvar baseTexture = (txt.baseTexture != null) ? txt.baseTexture : txt;\n\n\t\tthis.baseTexture = cast baseTexture;\n\t\tthis.frame = frame;\n\t\tthis.trim = trim;\n\t\tthis.valid = false;\n\t\tthis.requiresUpdate = false;\n\t\tthis._uvs = null;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.crop = (crop != null) ? crop : frame;\n\t\tthis.rotate = rotate;\n\n\t\tif (this.baseTexture.hasLoaded) {\n\t\t\tif (this.noFrame) {\n\t\t\t\tframe = new Rectangle(0, 0, baseTexture.width, baseTexture.height);\n\t\t\t\tthis.baseTexture.updated.add(_onBaseTextureUpdated);\n\t\t\t}\n\t\t\tthis.frame = frame;\n\t\t}\n\t\telse {\n\t\t\tthis.baseTexture.loaded.add(_onBaseTextureLoaded);\n\t\t}\n\n\t\tupdated = new Signal1(Texture);\n\t\tdisposed = new Signal1(Texture);\n\t}\n\n\tfunction set_frame(frame:Rectangle):Rectangle {\n\t\tthis.noFrame = false;\n\n\t\tthis.width = frame.width;\n\t\tthis.height = frame.height;\n\n\t\tif (this.trim != null && this.rotate != null && (frame.x + frame.width > this.baseTexture.width || frame.y + frame.height > this.baseTexture.height)) {\n\t\t\tthrow new Error('Texture Error: frame does not fit inside the base Texture dimensions ' + this);\n\t\t}\n\n\t\tthis.valid = (frame != null && frame.width != null && frame.height != null && this.baseTexture.hasLoaded);\n\n\t\tif (this.trim != null) {\n\t\t\tthis.width = this.trim.width;\n\t\t\tthis.height = this.trim.height;\n\t\t\tthis.frame.width = this.trim.width;\n\t\t\tthis.frame.height = this.trim.height;\n\t\t}\n\t\telse this.crop = frame;\n\n\t\tif (this.valid) this._updateUvs();\n\n\t\treturn this.frame = frame;\n\t}\n\n\tfunction _onBaseTextureLoaded(baseTexture:BaseTexture) {\n\t\tif (this.noFrame) this.frame = new Rectangle(0, 0, baseTexture.width, baseTexture.height);\n\t\t//updated.dispatch(this);\n\t}\n\n\tfunction _onBaseTextureUpdated(baseTexture:BaseTexture) {\n\t\tthis.frame.width = baseTexture.width;\n\t\tthis.frame.height = baseTexture.height;\n\t\t//updated.dispatch(this);\n\t}\n\n\tpublic function destroy(?destroyBase:Bool):Void {\n\t\tif (this.baseTexture != null) {\n\t\t\tif (destroyBase) this.baseTexture.destroy();\n\t\t\tthis.baseTexture.updated.remove(_onBaseTextureUpdated);\n\t\t\tthis.baseTexture.loaded.remove(_onBaseTextureLoaded);\n\t\t\tthis.baseTexture = null;\n\t\t}\n\n\t\tthis.frame = null;\n\t\tthis._uvs = null;\n\t\tthis.trim = null;\n\t\tthis.crop = null;\n\n\t\tthis.valid = false;\n\n\t\tdisposed.removeAll();\n\t\tupdated.removeAll();\n\t}\n\n\tfunction update():Void {\n\t\tthis.baseTexture.update();\n\t}\n\n\tfunction _updateUvs() {\n\t\tif (this._uvs == null) this._uvs = new TextureUvs();\n\t\tthis._uvs.set(this.crop, this.baseTexture, this.rotate);\n\t}\n\n\tpublic static function fromImage(imageUrl:String, ?crossorigin:Bool, ?scaleMode:Int):Texture {\n\t\tvar texture = Utils.TextureCache.get(imageUrl);\n\t\tif (texture == null) {\n\t\t\ttexture = new Texture(BaseTexture.fromImage(imageUrl, crossorigin, scaleMode));\n\t\t\tUtils.TextureCache.set(imageUrl, texture);\n\t\t}\n\t\treturn texture;\n\t}\n\n\tpublic static function fromFrame(frameId:String):Texture {\n\t\tvar texture = Utils.TextureCache.get(frameId);\n\t\tif (texture == null) throw new Error('The frameId \"' + frameId + '\" does not exist in the texture cache');\n\t\treturn texture;\n\t}\n\n\tpublic static function fromCanvas(canvas:Dynamic, ?scaleMode:Int = 0):Texture {\n\t\treturn new Texture(BaseTexture.fromCanvas(canvas, scaleMode));\n\t}\n\n\tpublic static function fromVideo(video:VideoElement, ?scaleMode:Int):Texture {\n\t\treturn new Texture(VideoBaseTexture.fromVideo(video, scaleMode));\n\t}\n\n\tpublic static function fromVideoUrl(videoUrl:String, ?scaleMode:Int):Texture {\n\t\treturn new Texture(VideoBaseTexture.fromUrl(videoUrl, scaleMode));\n\t}\n\n\tpublic static function addTextureToCache(texture:Texture, id:String):Void {\n\t\tUtils.TextureCache.set(id, texture);\n\t}\n\n\tpublic static function removeTextureFromCache(id:String):Texture {\n\t\tvar texture = Utils.TextureCache.get(id);\n\t\tUtils.TextureCache.set(id, null);\n\t\tUtils.BaseTextureCache.set(id, null);\n\t\treturn texture;\n\t}\n}","package fluid.core.textures;\n\nimport fluid.core.math.shapes.Rectangle;\n\nclass TextureUvs {\n\n\tpublic var x0:Float;\n\tpublic var y0:Float;\n\tpublic var x1:Float;\n\tpublic var y1:Float;\n\tpublic var x2:Float;\n\tpublic var y2:Float;\n\tpublic var x3:Float;\n\tpublic var y3:Float;\n\n\tpublic function new() {\n\t\tthis.x0 = 0;\n\t\tthis.y0 = 0;\n\n\t\tthis.x1 = 1;\n\t\tthis.y1 = 0;\n\n\t\tthis.x2 = 1;\n\t\tthis.y2 = 1;\n\n\t\tthis.x3 = 0;\n\t\tthis.y3 = 1;\n\t}\n\n\tpublic function set(frame:Rectangle, baseFrame:BaseTexture, rotate:Bool) {\n\t\tvar tw = baseFrame.width;\n\t\tvar th = baseFrame.height;\n\n\t\tif(rotate) {\n\t\t\tthis.x0 = (frame.x + frame.height) / tw;\n\t\t\tthis.y0 = frame.y / th;\n\n\t\t\tthis.x1 = (frame.x + frame.height) / tw;\n\t\t\tthis.y1 = (frame.y + frame.width) / th;\n\n\t\t\tthis.x2 = frame.x / tw;\n\t\t\tthis.y2 = (frame.y + frame.width) / th;\n\n\t\t\tthis.x3 = frame.x / tw;\n\t\t\tthis.y3 = frame.y / th;\n\t\t}\n\t\telse {\n\t\t\tthis.x0 = frame.x / tw;\n\t\t\tthis.y0 = frame.y / th;\n\n\t\t\tthis.x1 = (frame.x + frame.width) / tw;\n\t\t\tthis.y1 = frame.y / th;\n\n\t\t\tthis.x2 = (frame.x + frame.width) / tw;\n\t\t\tthis.y2 = (frame.y + frame.height) / th;\n\n\t\t\tthis.x3 = frame.x / tw;\n\t\t\tthis.y3 = (frame.y + frame.height) / th;\n\t\t}\n\t}\n}","package fluid.core.utils;\n\nimport fluid.core.renderers.webgl.WebGLRenderer;\n\nclass PluginTarget {\n\n\tpublic function new() {\n\t\ttrace(\"AFASFSAFS\");\n\t}\n\n\tpublic static function registerPlugin(obj:WebGLRenderer, pluginName:String, ctor:Class<Dynamic>) {\n\t\tobj.__plugins.set(pluginName, ctor);\n\t}\n\n\tpublic static function initPlugins(obj:WebGLRenderer) {\n\t\tfor (o in obj.__plugins.keys()) {\n\t\t\tobj.plugins.set(o, Type.createInstance(obj.__plugins.get(o), [obj]));\n\t\t}\n\t}\n\n\tpublic static function destroyPlugins(obj:WebGLRenderer) {\n\t\tfor (o in obj.plugins.keys()) {\n\t\t\tobj.plugins.get(o).destroy();\n\t\t\tobj.plugins.set(o, null);\n\t\t}\n\n\t\tobj.plugins = null;\n\t}\n}","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe;\n\n/**\n\tThe Timer class allows you to create asynchronous timers on platforms that\n\tsupport events.\n\n\tThe intended usage is to create an instance of the Timer class with a given\n\tinterval, set its run() method to a custom function to be invoked and\n\teventually call stop() to stop the Timer.\n\n\tNote that a running Timer may or may not prevent the program to exit\n\tautomatically when main() returns.\n\n\tIt is also possible to extend this class and override its run() method in\n\tthe child class.\n**/\nclass Timer {\n\t#if (flash || js || java || python)\n\n\t#if (flash || js)\n\t\tprivate var id : Null<Int>;\n\t#elseif java\n\t\tprivate var timer : java.util.Timer;\n\t\tprivate var task : java.util.TimerTask;\n\t#end\n\n\t/**\n\t\tCreates a new timer that will run every `time_ms` milliseconds.\n\n\t\tAfter creating the Timer instance, it calls `this].run` repeatedly,\n\t\twith delays of `time_ms` milliseconds, until `this.stop` is called.\n\n\t\tThe first invocation occurs after `time_ms` milliseconds, not\n\t\timmediately.\n\n\t\tThe accuracy of this may be platform-dependent.\n\t**/\n\tpublic function new( time_ms : Int ){\n\t\t#if flash\n\t\t\tvar me = this;\n\t\t\tid = untyped __global__[\"flash.utils.setInterval\"](function() { me.run(); },time_ms);\n\t\t#elseif js\n\t\t\tvar me = this;\n\t\t\tid = untyped setInterval(function() me.run(),time_ms);\n\t\t#elseif java\n\t\t\ttimer = new java.util.Timer();\n\t\t\ttimer.scheduleAtFixedRate(task = new TimerTask(this), haxe.Int64.ofInt(time_ms), haxe.Int64.ofInt(time_ms));\n\t\t#end\n\t}\n\n\t/**\n\t\tStops `this` Timer.\n\n\t\tAfter calling this method, no additional invocations of `this.run`\n\t\twill occur.\n\n\t\tIt is not possible to restart `this` Timer once stopped.\n\t**/\n\tpublic function stop() {\n\t\t#if (flash || js)\n\t\t\tif( id == null )\n\t\t\t\treturn;\n\t\t\t#if flash\n\t\t\t\tuntyped __global__[\"flash.utils.clearInterval\"](id);\n\t\t\t#elseif js\n\t\t\t\tuntyped clearInterval(id);\n\t\t\t#end\n\t\t\tid = null;\n\t\t#elseif java\n\t\t\ttimer.cancel();\n\t\t\ttimer = null;\n\t\t\ttask = null;\n\t\t#end\n\t}\n\n\t/**\n\t\tThis method is invoked repeatedly on `this` Timer.\n\n\t\tIt can be overridden in a subclass, or rebound directly to a custom\n\t\tfunction:\n\t\t\tvar timer = new haxe.Timer(1000); // 1000ms delay\n\t\t\ttimer.run = function() { ... }\n\n\t\tOnce bound, it can still be rebound to different functions until `this`\n\t\tTimer is stopped through a call to `this.stop`.\n\t**/\n\tpublic dynamic function run() {\n\n\t}\n\n\t/**\n\t\tInvokes `f` after `time_ms` milliseconds.\n\n\t\tThis is a convenience function for creating a new Timer instance with\n\t\t`time_ms` as argument, binding its run() method to `f` and then stopping\n\t\t`this` Timer upon the first invocation.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function delay( f : Void -> Void, time_ms : Int ) {\n\t\tvar t = new haxe.Timer(time_ms);\n\t\tt.run = function() {\n\t\t\tt.stop();\n\t\t\tf();\n\t\t};\n\t\treturn t;\n\t}\n\n\t#end\n\n\t/**\n\t\tMeasures the time it takes to execute `f`, in seconds with fractions.\n\n\t\tThis is a convenience function for calculating the difference between\n\t\tTimer.stamp() before and after the invocation of `f`.\n\n\t\tThe difference is passed as argument to Log.trace(), with \"s\" appended\n\t\tto denote the unit. The optional `pos` argument is passed through.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function measure<T>( f : Void -> T, ?pos : PosInfos ) : T {\n\t\tvar t0 = stamp();\n\t\tvar r = f();\n\t\tLog.trace((stamp() - t0) + \"s\", pos);\n\t\treturn r;\n\t}\n\n\t/**\n\t\tReturns a timestamp, in seconds with fractions.\n\n\t\tThe value itself might differ depending on platforms, only differences\n\t\tbetween two values make sense.\n\t**/\n\tpublic static function stamp() : Float {\n\t\t#if flash\n\t\t\treturn flash.Lib.getTimer() / 1000;\n\t\t#elseif (neko || php)\n\t\t\treturn Sys.time();\n\t\t#elseif js\n\t\t\treturn Date.now().getTime() / 1000;\n\t\t#elseif cpp\n\t\t\treturn untyped __global__.__time_stamp();\n\t\t#elseif sys\n\t\t\treturn Sys.time();\n\t\t#else\n\t\t\treturn 0;\n\t\t#end\n\t}\n\n}\n\n#if java\n@:nativeGen\nprivate class TimerTask extends java.util.TimerTask {\n\tvar timer:Timer;\n\tpublic function new(timer:Timer):Void {\n\t\tsuper();\n\t\tthis.timer = timer;\n\t}\n\n\t@:overload override public function run():Void {\n\t\ttimer.run();\n\t}\n}\n#end\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.ds;\n\nprivate class StringMapIterator<T> {\n\tvar map : StringMap<T>;\n\tvar keys : Array<String>;\n\tvar index : Int;\n\tvar count : Int;\n\tpublic inline function new(map:StringMap<T>, keys:Array<String>) {\n\t\tthis.map = map;\n\t\tthis.keys = keys;\n\t\tthis.index = 0;\n\t\tthis.count = keys.length;\n\t}\n\tpublic inline function hasNext() {\n\t\treturn index < count;\n\t}\n\tpublic inline function next() {\n\t\treturn map.get(keys[index++]);\n\t}\n}\n\n@:coreApi class StringMap<T> implements haxe.Constraints.IMap<String,T> {\n\n\tprivate var h : Dynamic;\n\tprivate var rh : Dynamic;\n\n\tpublic inline function new() : Void {\n\t\th = {};\n\t}\n\n\tinline function isReserved(key:String) : Bool {\n\t\treturn untyped __js__(\"__map_reserved\")[key] != null;\n\t}\n\n\tpublic inline function set( key : String, value : T ) : Void {\n\t\tif( isReserved(key) )\n\t\t\tsetReserved(key, value);\n\t\telse\n\t\t\th[cast key] = value;\n\t}\n\n\tpublic inline function get( key : String ) : Null<T> {\n\t\tif( isReserved(key) )\n\t\t\treturn getReserved(key);\n\t\treturn h[cast key];\n\t}\n\n\tpublic inline function exists( key : String ) : Bool {\n\t\tif( isReserved(key) )\n\t\t\treturn existsReserved(key);\n\t\treturn h.hasOwnProperty(key);\n\t}\n\n\tfunction setReserved( key : String, value : T ) : Void {\n\t\tif( rh == null ) rh = {};\n\t\trh[cast \"$\"+key] = value;\n\t}\n\n\tfunction getReserved( key : String ) : Null<T> {\n\t\treturn rh == null ? null : rh[cast \"$\"+key];\n\t}\n\n\tfunction existsReserved( key : String ) : Bool {\n\t\tif( rh == null ) return false;\n\t\treturn untyped rh.hasOwnProperty(\"$\"+key);\n\t}\n\n\tpublic function remove( key : String ) : Bool {\n\t\tif( isReserved(key) ) {\n\t\t\tkey = \"$\" + key;\n\t\t\tif( rh == null || !rh.hasOwnProperty(key) ) return false;\n\t\t\tuntyped __js__(\"delete\")(rh[key]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\tif( !h.hasOwnProperty(key) )\n\t\t\t\treturn false;\n\t\t\tuntyped __js__(\"delete\")(h[key]);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tpublic function keys() : Iterator<String> {\n\t\treturn arrayKeys().iterator();\n\t}\n\t\n\tfunction arrayKeys() : Array<String> {\n\t\tvar out = [];\n\t\tuntyped {\n\t\t\t__js__(\"for( var key in this.h ) {\");\n\t\t\t\tif( h.hasOwnProperty(key) )\n\t\t\t\t\tout.push(key);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\tif( rh != null ) untyped {\n\t\t\t__js__(\"for( var key in this.rh ) {\");\n\t\t\t\tif( key.charCodeAt(0) == \"$\".code )\n\t\t\t\t\tout.push(key.substr(1));\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn out;\n\t}\n\n\tpublic inline function iterator() : Iterator<T> {\n\t\treturn new StringMapIterator(this, arrayKeys());\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar keys = arrayKeys();\n\t\tfor( i in 0...keys.length ) {\n\t\t\tvar k = keys[i];\n\t\t\ts.add(k);\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(k)));\n\t\t\tif( i < keys.length )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n\tstatic function __init__() : Void {\n\t\tuntyped __js__(\"var __map_reserved = {}\");\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage js;\n\nprivate class HaxeError extends js.Error {\n\n\tvar val:Dynamic;\n\n\tpublic function new(val:Dynamic) untyped {\n\t\tsuper();\n\t\tthis.val = __define_feature__(\"js.Boot.HaxeError\", val);\n\t\tthis.message = String(val);\n\t\tif (js.Error.captureStackTrace) js.Error.captureStackTrace(this, HaxeError);\n\t}\n}\n\n@:dox(hide)\nclass Boot {\n\n\tprivate static function __unhtml(s : String) {\n\t\treturn s.split(\"&\").join(\"&amp;\").split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\");\n\t}\n\n\tprivate static function __trace(v,i : haxe.PosInfos) {\n\t\tuntyped {\n\t\t\tvar msg = if( i != null ) i.fileName+\":\"+i.lineNumber+\": \" else \"\";\n\t\t\t#if jsfl\n\t\t\tmsg += __string_rec(v,\"\");\n\t\t\tfl.trace(msg);\n\t\t\t#else\n\t\t\tmsg += __string_rec(v, \"\");\n\t\t\tif( i != null && i.customParams != null )\n\t\t\t\tfor( v in i.customParams )\n\t\t\t\t\tmsg += \",\" + __string_rec(v, \"\");\n\t\t\tvar d;\n\t\t\tif( __js__(\"typeof\")(document) != \"undefined\" && (d = document.getElementById(\"haxe:trace\")) != null )\n\t\t\t\td.innerHTML += __unhtml(msg)+\"<br/>\";\n\t\t\telse if( __js__(\"typeof console\") != \"undefined\" && __js__(\"console\").log != null )\n\t\t\t\t__js__(\"console\").log(msg);\n\t\t\t#end\n\t\t}\n\t}\n\n\tprivate static function __clear_trace() {\n\t\tuntyped {\n\t\t\t#if jsfl\n\t\t\tfl.outputPanel.clear();\n\t\t\t#else\n\t\t\tvar d = document.getElementById(\"haxe:trace\");\n\t\t\tif( d != null )\n\t\t\t\td.innerHTML = \"\";\n\t\t\t#end\n\t\t}\n\t}\n\n\tstatic inline function isClass(o:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isClass\", o.__name__);\n\t}\n\n\tstatic inline function isEnum(e:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isEnum\", e.__ename__);\n\t}\n\n\tstatic function getClass(o:Dynamic) : Dynamic {\n\t\tif (Std.is(o, Array))\n\t\t\treturn Array;\n\t\telse {\n\t\t\tvar cl = untyped __define_feature__(\"js.Boot.getClass\", o.__class__);\n\t\t\tif (cl != null)\n\t\t\t\treturn cl;\n\t\t\tvar name = __nativeClassName(o);\n\t\t\tif (name != null)\n\t\t\t\treturn __resolveNativeClass(name);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t@:ifFeature(\"has_enum\")\n\tprivate static function __string_rec(o,s:String) {\n\t\tuntyped {\n\t\t\tif( o == null )\n\t\t\t    return \"null\";\n\t\t\tif( s.length >= 5 )\n\t\t\t\treturn \"<...>\"; // too much deep recursion\n\t\t\tvar t = __js__(\"typeof(o)\");\n\t\t\tif( t == \"function\" && (isClass(o) || isEnum(o)) )\n\t\t\t\tt = \"object\";\n\t\t\tswitch( t ) {\n\t\t\tcase \"object\":\n\t\t\t\tif( __js__(\"o instanceof Array\") ) {\n\t\t\t\t\tif( o.__enum__ ) {\n\t\t\t\t\t\tif( o.length == 2 )\n\t\t\t\t\t\t\treturn o[0];\n\t\t\t\t\t\tvar str = o[0]+\"(\";\n\t\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\t\tfor( i in 2...o.length ) {\n\t\t\t\t\t\t\tif( i != 2 )\n\t\t\t\t\t\t\t\tstr += \",\" + __string_rec(o[i],s);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tstr += __string_rec(o[i],s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn str + \")\";\n\t\t\t\t\t}\n\t\t\t\t\tvar l = o.length;\n\t\t\t\t\tvar i;\n\t\t\t\t\tvar str = \"[\";\n\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\tfor( i in 0...l )\n\t\t\t\t\t\tstr += (if (i > 0) \",\" else \"\")+__string_rec(o[i],s);\n\t\t\t\t\tstr += \"]\";\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\t\t\t\tvar tostr;\n\t\t\t\ttry {\n\t\t\t\t\ttostr = untyped o.toString;\n\t\t\t\t} catch( e : Dynamic ) {\n\t\t\t\t\t// strange error on IE\n\t\t\t\t\treturn \"???\";\n\t\t\t\t}\n\t\t\t\tif( tostr != null && tostr != __js__(\"Object.toString\") && __typeof__(tostr) == \"function\" ) {\n\t\t\t\t\tvar s2 = o.toString();\n\t\t\t\t\tif( s2 != \"[object Object]\")\n\t\t\t\t\t\treturn s2;\n\t\t\t\t}\n\t\t\t\tvar k : String = null;\n\t\t\t\tvar str = \"{\\n\";\n\t\t\t\ts += \"\\t\";\n\t\t\t\tvar hasp = (o.hasOwnProperty != null);\n\t\t\t\t__js__(\"for( var k in o ) {\");\n\t\t\t\t\tif( hasp && !o.hasOwnProperty(k) )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( k == \"prototype\" || k == \"__class__\" || k == \"__super__\" || k == \"__interfaces__\" || k == \"__properties__\" )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( str.length != 2 )\n\t\t\t\t\t\tstr += \", \\n\";\n\t\t\t\t\tstr += s + k + \" : \"+__string_rec(o[k],s);\n\t\t\t\t__js__(\"}\");\n\t\t\t\ts = s.substring(1);\n\t\t\t\tstr += \"\\n\" + s + \"}\";\n\t\t\t\treturn str;\n\t\t\tcase \"function\":\n\t\t\t\treturn \"<function>\";\n\t\t\tcase \"string\":\n\t\t\t\treturn o;\n\t\t\tdefault:\n\t\t\t\treturn String(o);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static function __interfLoop(cc : Dynamic,cl : Dynamic) {\n\t\tif( cc == null )\n\t\t\treturn false;\n\t\tif( cc == cl )\n\t\t\treturn true;\n\t\tvar intf : Dynamic = cc.__interfaces__;\n\t\tif( intf != null )\n\t\t\tfor( i in 0...intf.length ) {\n\t\t\t\tvar i : Dynamic = intf[i];\n\t\t\t\tif( i == cl || __interfLoop(i,cl) )\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\treturn __interfLoop(cc.__super__,cl);\n\t}\n\n\t@:ifFeature(\"typed_catch\") private static function __instanceof(o : Dynamic,cl : Dynamic) {\n\t\tif( cl == null )\n\t\t\treturn false;\n\t\tswitch( cl ) {\n\t\tcase Int:\n\t\t\treturn (untyped __js__(\"(o|0) === o\"));\n\t\tcase Float:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"number\";\n\t\tcase Bool:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"boolean\";\n\t\tcase String:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"string\";\n\t\tcase Array:\n\t\t\treturn (untyped __js__(\"(o instanceof Array)\")) && o.__enum__ == null;\n\t\tcase Dynamic:\n\t\t\treturn true;\n\t\tdefault:\n\t\t\tif( o != null ) {\n\t\t\t\t// Check if o is an instance of a Haxe class or a native JS object\n\t\t\t\tif( (untyped __js__(\"typeof\"))(cl) == \"function\" ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") )\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tif( __interfLoop(getClass(o),cl) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse if ( (untyped __js__(\"typeof\"))(cl) == \"object\" && __isNativeObj(cl) ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// do not use isClass/isEnum here\n\t\t\tuntyped __feature__(\"Class.*\",if( cl == Class && o.__name__ != null ) return true);\n\t\t\tuntyped __feature__(\"Enum.*\",if( cl == Enum && o.__ename__ != null ) return true);\n\t\t\treturn o.__enum__ == cl;\n\t\t}\n\t}\n\n\t@:ifFeature(\"typed_cast\") private static function __cast(o : Dynamic, t : Dynamic) {\n\t\tif (__instanceof(o, t)) return o;\n\t\telse throw \"Cannot cast \" +Std.string(o) + \" to \" +Std.string(t);\n\t}\n\n\tstatic var __toStr = untyped __js__(\"{}.toString\");\n\t// get native JS [[Class]]\n\tstatic function __nativeClassName(o:Dynamic):String {\n\t\tvar name = untyped __toStr.call(o).slice(8, -1);\n\t\t// exclude general Object and Function\n\t\t// also exclude Math and JSON, because instanceof cannot be called on them\n\t\tif (name == \"Object\" || name == \"Function\" || name == \"Math\" || name == \"JSON\")\n\t\t\treturn null;\n\t\treturn name;\n\t}\n\n\t// check for usable native JS object\n\tstatic function __isNativeObj(o:Dynamic):Bool {\n\t\treturn __nativeClassName(o) != null;\n\t}\n\n\t// resolve native JS class in the global scope:\n\tstatic function __resolveNativeClass(name:String) untyped {\n\t\treturn untyped Function('return typeof $name != \"undefined\" ? $name : null')();\n\t}\n\n}\n","/*\n * Copyright (C)2005-2015 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n// This file is generated from mozilla/HTMLCanvasElement.webidl line 17:0. Do not edit!\n\npackage js.html;\n\n@:native(\"HTMLCanvasElement\")\nextern class CanvasElement extends Element\n{\n\tvar width : Int;\n\tvar height : Int;\n\t\n\t/** @throws DOMError */\n\tfunction getContext( contextId : String, ?contextOptions : Dynamic ) : Dynamic/*MISSING nsISupports*/;\n\t/** @throws DOMError */\n\tfunction toDataURL( ?type : String = \"\", ?encoderOptions : Dynamic ) : String;\n\t/** @throws DOMError */\n\tfunction toBlob( callback : Blob -> Void, ?type : String = \"\", ?encoderOptions : Dynamic ) : Void;\n\t\n\t/** Shorthand for getting a CanvasRenderingContext2D. */\n\tinline function getContext2d( ?attribs : {} ) : CanvasRenderingContext2D {\n\t\treturn cast getContext(\"2d\", attribs);\n\t}\n\t/** Shorthand for getting a js.html.webgl.RenderingContext. */\n\tinline function getContextWebGL( ?attribs : js.html.webgl.ContextAttributes ) : js.html.webgl.RenderingContext {\n\t\treturn CanvasUtil.getContextWebGL(this, attribs);\n\t}\n}\n\nprivate class CanvasUtil {\n\tpublic static function getContextWebGL( canvas :CanvasElement, attribs :{} ) {\n\t\tfor (name in [\"webgl\", \"experimental-webgl\"]) {\n\t\t\tvar ctx = canvas.getContext(name, attribs);\n\t\t\tif (ctx != null) return ctx;\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*\nCopyright (c) 2012 Massive Interactive\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\npackage msignal;\n\nimport msignal.Signal;\n\n/**\n\tA convenience type describing any kind of slot.\n**/\ntypedef AnySlot = Slot<Dynamic, Dynamic>;\n\n/**\n\tDefines the basic properties of a listener associated with a Signal.\n**/\n#if haxe3\nclass Slot<TSignal:msignal.Signal.AnySignal, TListener>\n#else\nclass Slot<TSignal:Signal<Dynamic, TListener>, TListener>\n#end\n{\n\t/**\n\t\tThe listener associated with this slot.\n\t\tNote: for hxcpp 2.10 this requires a getter method to compile\n\t**/\n\t#if cpp\n\t#if haxe3 @:isVar #end\n\tpublic var listener(get_listener, set_listener):TListener;\n\t#else\n\t#if haxe3 @:isVar #end\n\tpublic var listener(default, set_listener):TListener;\n\t#end\n\t\n\n\t/**\n\t\tWhether this slot is automatically removed after it has been used once.\n\t**/\n\tpublic var once(default, null):Bool;\n\n\t/**\n\t\tThe priority of this slot should be given in the execution order.\n\t\tAn Signal will call higher numbers before lower ones.\n\t\tDefaults to 0.\n\t**/\n\tpublic var priority(default, null):Int;\n\n\t/**\n\t\tWhether the listener is called on execution. Defaults to true.\n\t**/\n\tpublic var enabled:Bool;\n\n\tvar signal:TSignal;\n\t\n\tfunction new(signal:TSignal, listener:TListener, once:Bool=false, priority:Int=0)\n\t{\n\t\tthis.signal = signal;\n\t\tthis.listener = listener;\n\t\tthis.once = once;\n\t\tthis.priority = priority;\n\t\tthis.enabled = true;\n\t}\n\n\t/**\n\t\tRemoves the slot from its signal.\n\t**/\n\tpublic function remove()\n\t{\n\t\tsignal.remove(listener);\n\t}\n\n\t#if cpp\n\t/**\n\t\tHxcpp 2.10 requires a getter method for a typed function property in \n\t\torder to compile\n\t**/\n\tfunction get_listener():TListener\n\t{\n\t\treturn listener;\n\t}\n\t#end\n\n\tfunction set_listener(value:TListener):TListener\n\t{\n\t\tif (value == null) throw \"listener cannot be null\";\n\t\treturn listener = value;\n\t}\n}\n\n/**\n\tA slot that executes a listener with no arguments.\n**/\nclass Slot0 extends Slot<Signal0, Void -> Void>\n{\n\tpublic function new(signal:Signal0, listener:Void -> Void, once:Bool=false, priority:Int=0)\n\t{\n\t\tsuper(signal, listener, once, priority);\n\t}\n\n\t/**\n\t\tExecutes a listener with no arguments.\n\t**/\n\tpublic function execute()\n\t{\n\t\tif (!enabled) return;\n\t\tif (once) remove();\n\t\tlistener();\n\t}\n}\n\n/**\n\tA slot that executes a listener with one argument.\n**/\nclass Slot1<TValue> extends Slot<Signal1<TValue>, TValue -> Void>\n{\n\t/**\n\t\tAllows the slot to inject the argument to dispatch.\n\t**/\n\tpublic var param:TValue;\n\n\tpublic function new(signal:Signal1<TValue>, listener:TValue -> Void, once:Bool=false, priority:Int=0)\n\t{\n\t\tsuper(signal, listener, once, priority);\n\t}\n\n\t/**\n\t\tExecutes a listener with one argument.\n\t\tIf <code>param</code> is not null, it overrides the value provided.\n\t**/\n\tpublic function execute(value1:TValue)\n\t{\n\t\tif (!enabled) return;\n\t\tif (once) remove();\n\t\tif (param != null) value1 = param;\n\t\tlistener(value1);\n\t}\n}\n\n/**\n\tA slot that executes a listener with two arguments.\n**/\nclass Slot2<TValue1, TValue2> extends Slot<Signal2<TValue1, TValue2>, TValue1 -> TValue2 -> Void>\n{\n\t/**\n\t\tAllows the slot to inject the first argument to dispatch.\n\t**/\n\tpublic var param1:TValue1;\n\n\t/**\n\t\tAllows the slot to inject the second argument to dispatch.\n\t**/\n\tpublic var param2:TValue2;\n\n\tpublic function new(signal:Signal2<TValue1, TValue2>, listener:TValue1 -> TValue2 -> Void, once:Bool=false, priority:Int=0)\n\t{\n\t\tsuper(signal, listener, once, priority);\n\t}\n\n\t/**\n\t\tExecutes a listener with two arguments.\n\t\tIf <code>param1</code> or <code>param2</code> is set, \n\t\tthey override the values provided.\n\t**/\n\tpublic function execute(value1:TValue1, value2:TValue2)\n\t{\n\t\tif (!enabled) return;\n\t\tif (once) remove();\n\t\t\n\t\tif (param1 != null) value1 = param1;\n\t\tif (param2 != null) value2 = param2;\n\t\t\n\t\tlistener(value1, value2);\n\t}\n}\n"],
"names":[],
"mappings":"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"
}